<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuneScript Guide - Values and Types</title>
    <link rel="stylesheet" href="../style.css">
    <script src="../main.js" defer></script>
</head>

<body>
    <div class="sidebar">
        <h1>LuneScript Guide</h1>
        <ul class="nav-links">
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="index.html">Introduction</a>
                <ul class="submenu">
                    <li><a href="index.html#features">Key Features</a></li>
                    <li><a href="index.html#audience">Target Audience</a></li>
                    <li><a href="index.html#license">License</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="learning.html">Learning Guide</a>
                <ul class="submenu">
                    <li><a href="learning.html#step1">Step 1: Basics</a></li>
                    <li><a href="learning.html#step2">Step 2: Safety Features</a></li>
                    <li><a href="learning.html#step3">Step 3: Modern Features</a></li>
                    <li><a href="learning.html#navigation">Using Documentation</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="tutorial.html">Installation and Hello World</a>
                <ul class="submenu">
                    <li><a href="tutorial.html#install">Installation</a></li>
                    <li><a href="tutorial.html#hello">Hello World</a></li>
                    <li><a href="tutorial.html#options">lnsc Command</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="syntax.html">Basic Syntax</a>
                <ul class="submenu">
                    <li><a href="syntax.html#comments">Comments</a></li>
                    <li><a href="syntax.html#vars">Variable Declarations</a></li>
                    <li><a href="syntax.html#flow">Initialization by Flow Analysis</a></li>
                    <li><a href="syntax.html#scope">Scope Blocks</a></li>
                    <li><a href="syntax.html#attr">Attributes</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="value.html">Values and Types</a>
                <ul class="submenu">
                    <li><a href="value.html#primitive">Primitive Types</a></li>
                    <li><a href="value.html#collection">Collections</a></li>
                    <li><a href="value.html#list">&nbsp;&nbsp;List</a></li>
                    <li><a href="value.html#map">&nbsp;&nbsp;Map</a></li>
                    <li><a href="value.html#set">&nbsp;&nbsp;Set</a></li>
                    <li><a href="value.html#nilable">Nilable Types</a></li>
                    <li><a href="value.html#cast">Casting</a></li>
                    <li><a href="value.html#alge">Algebraic Data Types</a></li>
                    <li><a href="value.html#enum">Enum</a></li>
                    <li><a href="value.html#tuple">Tuple</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="control.html">Control Flow</a>
                <ul class="submenu">
                    <li><a href="control.html#if">if statement</a></li>
                    <li><a href="control.html#switch">switch statement</a></li>
                    <li><a href="control.html#while">while statement</a></li>
                    <li><a href="control.html#repeat">repeat statement</a></li>
                    <li><a href="control.html#for">for statement</a></li>
                    <li><a href="control.html#foreach">foreach statement</a></li>
                    <li><a href="control.html#apply">apply statement</a></li>
                    <li><a href="control.html#match">match statement</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="error.html">Error Handling</a>
                <ul class="submenu">
                    <li><a href="error.html#ret">__Ret Type</a></li>
                    <li><a href="error.html#delegation">Error Delegation</a></li>
                    <li><a href="error.html#best_practice">Types and Best Practices</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="function.html">Functions</a>
                <ul class="submenu">
                    <li><a href="function.html#def">Definition</a></li>
                    <li><a href="function.html#multi_ret">Multiple Returns</a></li>
                    <li><a href="function.html#closure">Closures</a></li>
                    <li><a href="function.html#form">Form (Function Type)</a></li>
                    <li><a href="function.html#varargs">Variable Arguments</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="class.html">Classes</a>
                <ul class="submenu">
                    <li><a href="class.html#def">Definition and Instantiation</a></li>
                    <li><a href="class.html#inherit">Inheritance and Overriding</a></li>
                    <li><a href="class.html#abstract">Abstract Classes</a></li>
                    <li><a href="class.html#interface">Interfaces</a></li>
                    <li><a href="class.html#advertise">Advertise</a></li>
                    <li><a href="class.html#mapping">Mapping</a></li>
                    <li><a href="class.html#proto">Prototype Declarations</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="generics.html">Generics</a>
                <ul class="submenu">
                    <li><a href="generics.html#func">Function Generics</a></li>
                    <li><a href="generics.html#class">Class Generics</a></li>
                    <li><a href="generics.html#constraint">Type Parameter Constraints</a></li>
                    <li><a href="generics.html#method">Method Generics</a></li>
                    <li><a href="generics.html#mut">Generics and Mutability</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="macro.html">Macros</a>
                <ul class="submenu">
                    <li><a href="macro.html#def">Definition</a></li>
                    <li><a href="macro.html#arg">Arguments</a></li>
                    <li><a href="macro.html#quote">Quoting</a></li>
                    <li><a href="macro.html#statement">Macro Statement</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="advanced.html">Advanced Features</a>
                <ul class="submenu">
                    <li><a href="advanced.html#match">Pattern Matching</a></li>
                    <li><a href="advanced.html#async">Asynchronous Processing</a></li>
                    <li><a href="advanced.html#glue">Glue Code</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="module.html">Modules and Projects</a>
                <ul class="submenu">
                    <li><a href="module.html#module">Module System</a></li>
                    <li><a href="module.html#project">Project Settings</a></li>
                    <li><a href="module.html#provide">Provide</a></li>
                    <li><a href="module.html#require">Require</a></li>
                    <li><a href="module.html#subfile">Subfile</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="standard.html">Standard Library</a>
                <ul class="submenu">
                    <li><a href="standard.html#builtin">Built-in Functions</a></li>
                    <li><a href="standard.html#lua">Lua Standard Library</a></li>
                    <li><a href="standard.html#io">IO</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="tutorial_macro.html">Practical: Macro Usage</a>
                <ul class="submenu">
                    <li><a href="tutorial_macro.html#step1">Step 1: Debug Print</a></li>
                    <li><a href="tutorial_macro.html#step2">Step 2: Assertion</a></li>
                    <li><a href="tutorial_macro.html#step3">Step 3: Measurement</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="tutorial_parser.html">Practical: Expression Parser</a>
                <ul class="submenu">
                    <li><a href="tutorial_parser.html#goal">Goal</a></li>
                    <li><a href="tutorial_parser.html#token">Step 1: Token Definition</a></li>
                    <li><a href="tutorial_parser.html#lexer">Step 2: Lexical Analysis</a></li>
                    <li><a href="tutorial_parser.html#ast">Step 3: Abstract Syntax Tree (AST)</a></li>
                    <li><a href="tutorial_parser.html#parser">Step 4: Parsing</a></li>
                    <li><a href="tutorial_parser.html#eval">Step 5: Evaluation and Execution</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="keyword.html">Keywords List</a>
                <ul class="submenu">
                    <li><a href="keyword.html#a">A-G</a></li>
                    <li><a href="keyword.html#h">H-N</a></li>
                    <li><a href="keyword.html#o">O-U</a></li>
                    <li><a href="keyword.html#v">V-Z</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="troubleshooting.html">Troubleshooting</a>
                <ul class="submenu">
                    <li><a href="troubleshooting.html#char">Character Literals</a></li>
                    <li><a href="troubleshooting.html#mut">Mutable Methods</a></li>
                    <li><a href="troubleshooting.html#match">Pattern Matching</a></li>
                    <li><a href="troubleshooting.html#unwrap">Nilable Operations</a></li>
                    <li><a href="troubleshooting.html#macro">Macro Syntax Errors</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="evaluation.html">Discussion and Evaluation</a>
                <ul class="submenu">
                    <li><a href="evaluation.html#quality">Language Quality</a></li>
                    <li><a href="evaluation.html#vs-lua">Comparison with Lua</a></li>
                    <li><a href="evaluation.html#vs-teal">Comparison with Teal</a></li>
                    <li><a href="evaluation.html#issues">Issues and Proposals</a></li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="main-content">
        <div class="header-nav">
            <a href="../ja/value.html" class="lang-link">日本語</a>
        </div>
        <h1>Values and Types</h1>
        <p>This section explains the values and types handled in LuneScript in detail.</p>

        <h2 id="primitive">Primitive Types</h2>
        <table class="simple-table">
            <thead>
                <tr>
                    <th>Type Name</th>
                    <th>Description</th>
                    <th>Example</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>int</code></td>
                    <td>Integer</td>
                    <td><code>1</code>, <code>-10</code>, <code>0x10</code></td>
                </tr>
                <tr>
                    <td><code>real</code></td>
                    <td>Real number (floating point)</td>
                    <td><code>1.0</code>, <code>3.14</code></td>
                </tr>
                <tr>
                    <td><code>bool</code></td>
                    <td>Boolean</td>
                    <td><code>true</code>, <code>false</code></td>
                </tr>
                <tr>
                    <td><code>str</code></td>
                    <td>String (immutable)</td>
                    <td><code>"hello"</code>, <code>'world'</code></td>
                </tr>
                <tr>
                    <td><code>stem</code></td>
                    <td>All types except nil</td>
                    <td>(Any non-nil value)</td>
                </tr>
            </tbody>
        </table>
        <p><code>stem</code> is the base type for all types, but it cannot hold <code>nil</code>. To allow
            <code>nil</code>, use <code>stem!</code>.
        </p>

        <h2 id="collection">Collections</h2>

        <h3 id="list">List&lt;T&gt; (List)</h3>
        <p>A dynamic array where elements can be added or removed.</p>
        <pre><code class="language-lns"><span class="keyword">let</span> <span class="keyword">mut</span> list: <span class="type">List</span>&lt;<span class="type">int</span>&gt; = [ <span class="number">10</span>, <span class="number">20</span> ]; <span class="comment">// Initialization</span>
list.insert( <span class="number">30</span> );  <span class="comment">// Add: [ 10, 20, 30 ]</span>
list.remove();      <span class="comment">// Remove from end: [ 10, 20 ]</span>
print( list[ <span class="number">1</span> ] ); <span class="comment">// Access (1-based index): 10</span>
print( #list );     <span class="comment">// Get size: 2</span>
</code></pre>
        <div class="note">
            LuneScript (and Lua) list indices <strong>start from 1</strong>. Be careful, as out-of-bounds access results
            in undefined behavior.
        </div>


        <h3 id="map">Map&lt;K,V&gt; (Associative Array)</h3>
        <p>Holds key-value pairs. JSON-like literals can be used.</p>
        <pre><code class="language-lns"><span class="keyword">let</span> <span class="keyword">mut</span> map: <span class="type">Map</span>&lt;<span class="type">str</span>,<span class="type">int</span>&gt; = {
    <span class="string">"a"</span>: <span class="number">1</span>,
    <span class="string">"b"</span>: <span class="number">2</span>
};
<span class="comment">// Access</span>
print( map[ <span class="string">"a"</span> ] ); <span class="comment">// 1</span>
print( map.b );      <span class="comment">// Can also access via dot notation if the key is a string</span>

<span class="comment">// Delete (by assigning nil)</span>
map.a = <span class="keyword">nil</span>;
</code></pre>
        <div class="note">
            The result of Map access is always <strong>Nilable (T!)</strong>, because <code>nil</code> is returned if
            the value corresponding to the key does not exist.
        </div>

        <h3 id="set">Set&lt;T&gt; (Set)</h3>
        <p>Manages a collection of unique values. The literal is <code>(@ ... )</code>.</p>
        <pre><code class="language-lns"><span class="keyword">let</span> <span class="keyword">mut</span> set = (@ <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> );
set.add( <span class="number">4</span> );       <span class="comment">// Add</span>
set.del( <span class="number">1</span> );       <span class="comment">// Delete</span>
print( set.has( <span class="number">2</span> ) );  <span class="comment">// Check existence: true</span>
print( set.len() );     <span class="comment">// Number of elements: 3</span>
</code></pre>
        <p>Set operations <code>or</code> (union), <code>and</code> (intersection), and <code>sub</code> (difference)
            are also supported.</p>

        <h2 id="nilable">Nilable Types (Null Safety)</h2>
        <p>Appending <code>!</code> to a type name makes it a type that can hold <code>nil</code>.</p>
        <pre><code class="language-lns"><span class="keyword">let</span> val1: <span class="type">int</span> = <span class="number">1</span>;   <span class="comment">// Non-nilable</span>
<span class="keyword">let</span> val2: <span class="type">int</span>! = <span class="keyword">nil</span>; <span class="comment">// Nilable (int or nil)</span>
</code></pre>
        <p>Nilable types cannot be used in calculations as is (for safety). They must be <strong>Unwrapped
                (Non-Nilated)</strong>.</p>

        <h3 id="keyword_unwrap">unwrap</h3>
        <p>Forcibly removes nil. If the value is nil, a runtime error occurs.</p>
        <pre><code class="language-lns"><span class="keyword">let</span> a: <span class="type">int</span>! = <span class="number">10</span>;
<span class="keyword">let</span> b: <span class="type">int</span> = <span class="keyword">unwrap</span> a;
</code></pre>
        <p>You can specify a <code>default</code> value for safe unwrapping.</p>
        <pre><code class="language-lns"><span class="keyword">let</span> a: <span class="type">int</span>! = <span class="keyword">nil</span>;
<span class="keyword">let</span> c: <span class="type">int</span> = <span class="keyword">unwrap</span> a <span class="keyword">default</span> <span class="number">0</span>; <span class="comment">// Becomes 0 if nil</span>
</code></pre>

        <h3 id="keyword_if_let">if! let / when!</h3>
        <p>Syntax for executing a block only if a variable is not nil.</p>
        <pre><code class="language-lns">fn funcReturnsNilable(): int! { return 1; }
<span class="keyword">if</span>! <span class="keyword">let</span> x = funcReturnsNilable() {
    <span class="comment">// x can be treated as non-nil (int) here</span>
    print( x + <span class="number">1</span> );
} <span class="keyword">else</span> {
    print( <span class="string">"x was nil"</span> );
}
</code></pre>
        <p><code>when!</code> checks if an existing variable is nil.</p>
        <pre><code class="language-lns"><span class="keyword">let</span> val: <span class="type">int</span>! = <span class="keyword">nil</span>;
<span class="keyword">when</span>! val {
    <span class="comment">// Inside this block, val is of type int (immutable)</span>
}
</code></pre>

        <h3 id="keyword_let_bang">let! .. then ..</h3>
        <p>A style that describes the "processing when the variable is nil" first (similar to a guard clause).</p>
        <pre><code class="language-lns">fn funcReturnsNilable(): int! { return nil; }
<span class="keyword">let</span>! x = funcReturnsNilable() {
    <span class="comment">// Executed if x is nil</span>
    <span class="keyword">return</span>;
}
<span class="comment">// x is non-nil here</span>
print( x + 1 );
</code></pre>

        <h3 id="nil_conditional">Nil Conditional Operator ($)</h3>
        <p>Performs member access or function calls on a nilable value only if it is not nil. If the value is nil, it
            returns <code>nil</code>. The evaluation result is always a Nilable type.</p>
        <ul>
            <li><strong>Member Access:</strong> <code>obj$.member</code></li>
            <li><strong>Index Access:</strong> <code>obj$[index]</code></li>
            <li><strong>Function Call:</strong> <code>func$(args)</code></li>
        </ul>
        <pre><code class="language-lns"><span class="keyword">class</span> Test {
    <span class="keyword">pub</span> <span class="keyword">let</span> val: <span class="type">List</span>&lt;<span class="type">int</span>&gt;;
    <span class="keyword">pub</span> <span class="keyword">fn</span> func(): <span class="type">int</span> { <span class="keyword">return</span> <span class="number">100</span>; }
}

<span class="keyword">fn</span> sub( test: Test! ) {
    <span class="comment">// If test is nil, everything becomes nil</span>
    print( test$.val$[<span class="number">1</span>], test$.func$() );
}

sub( <span class="keyword">new</span> Test( [ <span class="number">1</span>, <span class="number">2</span> ] ) ); <span class="comment">// 1 100</span>
sub( <span class="keyword">nil</span> );                   <span class="comment">// nil nil</span>
</code></pre>


        <h2 id="cast">Casting</h2>
        <p>There are two types of type conversion: <code>@@</code> (forced) and <code>@@@</code> (safe).</p>

        <h3>Forced Casting (@@)</h3>
        <pre><code class="language-lns"><span class="keyword">let</span> val: <span class="type">stem</span> = <span class="number">10</span>;
<span class="keyword">let</span> i = val@@<span class="type">int</span>; <span class="comment">// Conversion without checking. Behavior on failure is undefined or an error.</span>
</code></pre>

        <h3>Safe Casting (@@@)</h3>
        <pre><code class="language-lns"><span class="keyword">let</span> val: <span class="type">stem</span> = <span class="string">"test"</span>;
<span class="keyword">if</span>! <span class="keyword">let</span> i = val@@@<span class="type">int</span> {
    print( <span class="string">"Integer!"</span> );
} <span class="keyword">else</span> {
    print( <span class="string">"Not an integer"</span> );
}
</code></pre>
        <p>Returns <code>nil</code> if conversion fails.</p>

        <h2 id="alge" id="keyword_alge">Algebraic Data Types</h2>
        <p><code>alge</code> is a type of enumeration, but each value (constructor) can have parameters. It is a tagged
            union.</p>
        <pre><code class="language-lns"><span class="keyword">alge</span> Shape {
    Rect( <span class="type">real</span>, <span class="type">real</span> ),
    Circle( <span class="type">real</span> ),
}

<span class="keyword">let</span> s = Shape.Rect( <span class="number">10.0</span>, <span class="number">20.0</span> );

<span class="keyword">match</span> s {
    <span class="keyword">case</span> .Rect( w, h ) { print( <span class="string">"Rect:"</span>, w * h ); }
    <span class="keyword">case</span> .Circle( r ) { print( <span class="string">"Circle:"</span>, r * r * <span class="number">3.14</span> ); }
}
</code></pre>

        <h2 id="enum" id="keyword_enum">Enum</h2>
        <p>A simple enumeration of values. Integers, real numbers, and strings can be assigned.</p>
        <pre><code class="language-lns"><span class="keyword">enum</span> Color {
    Red = <span class="number">0</span>,
    Green, <span class="comment">// 1 (Auto-incrementing)</span>
    Blue,  <span class="comment">// 2</span>
}
print( Color.Red ); <span class="comment">// 0</span>
print( Color.Red.$_txt ); <span class="comment">// "Color.Red" (String representation)</span>
</code></pre>
        <p>Use <code>_from</code> to convert a raw value to an Enum.</p>
        <pre><code class="language-lns"><span class="keyword">enum</span> Color { Green=1 }
<span class="keyword">let</span> c = <span class="keyword">unwrap</span> Color._from( <span class="number">1</span> ); <span class="comment">// Color.Green (Needs unwrap because it is nilable)</span>
</code></pre>

        <h2 id="tuple">Tuple</h2>
        <p>Handles multiple values together.</p>
        <pre><code class="language-lns"><span class="keyword">let</span> t: (<span class="type">int</span>, <span class="type">str</span>) = (= <span class="number">1</span>, <span class="string">"ok"</span> );
</code></pre>
        <p>Use <code>...</code> to expand it, for example, when passing arguments to a function.</p>
        <pre><code class="language-lns"><span class="keyword">fn</span> func( i: <span class="type">int</span>, s: <span class="type">str</span> ) { print( i, s ); }
<span class="keyword">let</span> t: (<span class="type">int</span>, <span class="type">str</span>) = (= <span class="number">1</span>, <span class="string">"ok"</span> );
func( t... );
</code></pre>

    </div>
</body>

</html>