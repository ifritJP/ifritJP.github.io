<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuneScript Guide - Modules and Projects</title>
    <link rel="stylesheet" href="../style.css">
    <script src="../main.js" defer></script>
</head>

<body>
    <div class="sidebar">
        <h1>LuneScript Guide</h1>
        <ul class="nav-links">
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="index.html">Introduction</a>
                <ul class="submenu">
                    <li><a href="index.html#features">Key Features</a></li>
                    <li><a href="index.html#audience">Target Audience</a></li>
                    <li><a href="index.html#license">License</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="learning.html">Learning Guide</a>
                <ul class="submenu">
                    <li><a href="learning.html#step1">Step 1: Basics</a></li>
                    <li><a href="learning.html#step2">Step 2: Safety Features</a></li>
                    <li><a href="learning.html#step3">Step 3: Modern Features</a></li>
                    <li><a href="learning.html#navigation">Using Documentation</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="tutorial.html">Installation and Hello World</a>
                <ul class="submenu">
                    <li><a href="tutorial.html#install">Installation</a></li>
                    <li><a href="tutorial.html#hello">Hello World</a></li>
                    <li><a href="tutorial.html#options">lnsc Command</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="syntax.html">Basic Syntax</a>
                <ul class="submenu">
                    <li><a href="syntax.html#comments">Comments</a></li>
                    <li><a href="syntax.html#vars">Variable Declarations</a></li>
                    <li><a href="syntax.html#flow">Initialization by Flow Analysis</a></li>
                    <li><a href="syntax.html#scope">Scope Blocks</a></li>
                    <li><a href="syntax.html#attr">Attributes</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="value.html">Values and Types</a>
                <ul class="submenu">
                    <li><a href="value.html#primitive">Primitive Types</a></li>
                    <li><a href="value.html#collection">Collections</a></li>
                    <li><a href="value.html#list">&nbsp;&nbsp;List</a></li>
                    <li><a href="value.html#map">&nbsp;&nbsp;Map</a></li>
                    <li><a href="value.html#set">&nbsp;&nbsp;Set</a></li>
                    <li><a href="value.html#nilable">Nilable Types</a></li>
                    <li><a href="value.html#cast">Casting</a></li>
                    <li><a href="value.html#alge">Algebraic Data Types</a></li>
                    <li><a href="value.html#enum">Enum</a></li>
                    <li><a href="value.html#tuple">Tuple</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="control.html">Control Flow</a>
                <ul class="submenu">
                    <li><a href="control.html#if">if statement</a></li>
                    <li><a href="control.html#switch">switch statement</a></li>
                    <li><a href="control.html#while">while statement</a></li>
                    <li><a href="control.html#repeat">repeat statement</a></li>
                    <li><a href="control.html#for">for statement</a></li>
                    <li><a href="control.html#foreach">foreach statement</a></li>
                    <li><a href="control.html#apply">apply statement</a></li>
                    <li><a href="control.html#match">match statement</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="error.html">Error Handling</a>
                <ul class="submenu">
                    <li><a href="error.html#ret">__Ret Type</a></li>
                    <li><a href="error.html#delegation">Error Delegation</a></li>
                    <li><a href="error.html#best_practice">Types and Best Practices</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="function.html">Functions</a>
                <ul class="submenu">
                    <li><a href="function.html#def">Definition</a></li>
                    <li><a href="function.html#multi_ret">Multiple Returns</a></li>
                    <li><a href="function.html#closure">Closures</a></li>
                    <li><a href="function.html#form">Form (Function Type)</a></li>
                    <li><a href="function.html#varargs">Variable Arguments</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="class.html">Classes</a>
                <ul class="submenu">
                    <li><a href="class.html#def">Definition and Instantiation</a></li>
                    <li><a href="class.html#inherit">Inheritance and Overriding</a></li>
                    <li><a href="class.html#abstract">Abstract Classes</a></li>
                    <li><a href="class.html#interface">Interfaces</a></li>
                    <li><a href="class.html#advertise">Advertise</a></li>
                    <li><a href="class.html#mapping">Mapping</a></li>
                    <li><a href="class.html#proto">Prototype Declarations</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="generics.html">Generics</a>
                <ul class="submenu">
                    <li><a href="generics.html#func">Function Generics</a></li>
                    <li><a href="generics.html#class">Class Generics</a></li>
                    <li><a href="generics.html#constraint">Type Parameter Constraints</a></li>
                    <li><a href="generics.html#method">Method Generics</a></li>
                    <li><a href="generics.html#mut">Generics and Mutability</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="macro.html">Macros</a>
                <ul class="submenu">
                    <li><a href="macro.html#def">Definition</a></li>
                    <li><a href="macro.html#arg">Arguments</a></li>
                    <li><a href="macro.html#quote">Quoting</a></li>
                    <li><a href="macro.html#statement">Macro Statement</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="advanced.html">Advanced Features</a>
                <ul class="submenu">
                    <li><a href="advanced.html#match">Pattern Matching</a></li>
                    <li><a href="advanced.html#async">Asynchronous Processing</a></li>
                    <li><a href="advanced.html#glue">Glue Code</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="module.html">Modules and Projects</a>
                <ul class="submenu">
                    <li><a href="module.html#module">Module System</a></li>
                    <li><a href="module.html#project">Project Settings</a></li>
                    <li><a href="module.html#provide">Provide</a></li>
                    <li><a href="module.html#require">Require</a></li>
                    <li><a href="module.html#subfile">Subfile</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="standard.html">Standard Library</a>
                <ul class="submenu">
                    <li><a href="standard.html#builtin">Built-in Functions</a></li>
                    <li><a href="standard.html#lua">Lua Standard Library</a></li>
                    <li><a href="standard.html#io">IO</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="tutorial_macro.html">Practical: Macro Usage</a>
                <ul class="submenu">
                    <li><a href="tutorial_macro.html#step1">Step 1: Debug Print</a></li>
                    <li><a href="tutorial_macro.html#step2">Step 2: Assertion</a></li>
                    <li><a href="tutorial_macro.html#step3">Step 3: Measurement</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="tutorial_parser.html">Practical: Expression Parser</a>
                <ul class="submenu">
                    <li><a href="tutorial_parser.html#goal">Goal</a></li>
                    <li><a href="tutorial_parser.html#token">Step 1: Token Definition</a></li>
                    <li><a href="tutorial_parser.html#lexer">Step 2: Lexical Analysis</a></li>
                    <li><a href="tutorial_parser.html#ast">Step 3: Abstract Syntax Tree (AST)</a></li>
                    <li><a href="tutorial_parser.html#parser">Step 4: Parsing</a></li>
                    <li><a href="tutorial_parser.html#eval">Step 5: Evaluation and Execution</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="keyword.html">Keywords List</a>
                <ul class="submenu">
                    <li><a href="keyword.html#a">A-G</a></li>
                    <li><a href="keyword.html#h">H-N</a></li>
                    <li><a href="keyword.html#o">O-U</a></li>
                    <li><a href="keyword.html#v">V-Z</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="troubleshooting.html">Troubleshooting</a>
                <ul class="submenu">
                    <li><a href="troubleshooting.html#char">Character Literals</a></li>
                    <li><a href="troubleshooting.html#mut">Mutable Methods</a></li>
                    <li><a href="troubleshooting.html#match">Pattern Matching</a></li>
                    <li><a href="troubleshooting.html#unwrap">Nilable Operations</a></li>
                    <li><a href="troubleshooting.html#macro">Macro Syntax Errors</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="evaluation.html">Discussion and Evaluation</a>
                <ul class="submenu">
                    <li><a href="evaluation.html#quality">Language Quality</a></li>
                    <li><a href="evaluation.html#vs-lua">Comparison with Lua</a></li>
                    <li><a href="evaluation.html#vs-teal">Comparison with Teal</a></li>
                    <li><a href="evaluation.html#issues">Issues and Proposals</a></li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="main-content">
    <div class="header-nav">
        <a href="../ja/module.html" class="lang-link">日本語</a>
    </div>
        <h1>Modules and Projects</h1>

        <h2 id="module">Module System</h2>
        <p>In LuneScript, one <code>.lns</code> file corresponds to one module.<br>
            Folder hierarchies are represented by dot <code>.</code> delimiters (e.g., <code>foo/bar.lns</code> →
            <code>foo.bar</code>).</p>
        <pre><code class="language-lns"><span class="comment">// foo/bar.lns</span>
<span class="keyword">pub</span> <span class="keyword">fn</span> func() { print(<span class="string">"foo.bar"</span>); }
</code></pre>

        <h3 id="project">Project Settings (lune.js)</h3>
        <p>A LuneScript project is recognized with the directory containing a file named <code>lune.js</code> (or
            <code>lune.lua</code>) as its root.<br>
            This file is written in JSON format.</p>
        <pre><code class="language-js">{
    "cmd_option": [ "--valid-luaval" ]
}
</code></pre>
        <p>Even a single empty JSON <code>{}</code> works, but by specifying <code>cmd_option</code>, you can manage
            compilation options applicable to the entire project.</p>
        <div class="note">
            The directory where <code>lune.js</code> is located becomes the starting point of the module path.<br>
            If <code>foo/lune.js</code> exists, <code>foo/bar/mod.lns</code> is treated as <code>bar.mod</code>.
        </div>

        <h3 id="import">Import</h3>
        <p>To use other modules, use <code>import</code>.</p>
        <pre><code class="language-lns"><span class="keyword">import</span> foo.bar;
foo.bar.func();

<span class="keyword">import</span> foo.bar <span class="keyword">as</span> baz;
baz.func();
</code></pre>

        <h2 id="require">Using External Lua Modules</h2>
        <p>When using existing Lua modules, perform type definition using the <code>module</code> keyword.</p>
        <pre><code class="language-lns"><span class="keyword">module</span> Math <span class="keyword">require</span> <span class="string">"math"</span> {
    <span class="keyword">pub</span> <span class="keyword">static</span> <span class="keyword">let</span> pi: <span class="type">real</span>;
    <span class="keyword">pub</span> <span class="keyword">static</span> <span class="keyword">fn</span> sin( x:<span class="type">real</span> ): <span class="type">real</span>;
}
print( Math.sin( Math.pi / <span class="number">2.0</span> ) );
</code></pre>

        <h3 id="glue">Glue Code Generation</h3>
        <p>There is a feature that automatically generates Glue code for interconnecting with Lua (C language)
            modules.<br>
            Specify the <code>glue</code> keyword and a prefix in the <code>module</code> definition.
        </p>
        <pre><code class="language-lns"><span class="keyword">module</span> External <span class="keyword">require</span> <span class="string">"test.ext"</span> <span class="keyword">glue</span> <span class="string">"hoge_"</span> {
    <span class="keyword">pub</span> <span class="keyword">static</span> <span class="keyword">fn</span> test(): <span class="type">int</span>;
}
</code></pre>
        <p>This generates C-language header and source files with <code>hoge_</code> as a prefix, allowing for smooth
            interconnection with the C-side implementation.</p>

        <h2 id="provide">Provide</h2>
        <p>Used to expose a specific symbol as the module's return value for compatibility with Lua.</p>
        <pre><code class="language-lns"><span class="keyword">pub</span> <span class="keyword">fn</span> func(): <span class="type">int</span> { <span class="keyword">return</span> <span class="number">10</span>; }
<span class="keyword">provide</span> func;
</code></pre>
        <p>This results in the function <code>func</code> being returned directly instead of a table when
            <code>require("this_mod")</code> is called from Lua.</p>

        <h2 id="subfile">Subfile (File Splitting)</h2>
        <p>A feature that splits one module into multiple files. It makes large modules easier to manage.</p>

        <h3>Main File</h3>
        <pre><code class="language-lns"><span class="comment">// @lnsFront: skip</span>
<span class="comment">// main.lns</span>
<span class="keyword">subfile</span> <span class="keyword">use</span> sub1;
<span class="keyword">subfile</span> <span class="keyword">use</span> sub2;
<span class="keyword">pub</span> <span class="keyword">let</span> val = <span class="number">100</span>;
</code></pre>

        <h3>Sub File</h3>
        <pre><code class="language-lns"><span class="comment">// @lnsFront: skip</span>
<span class="comment">// sub1.lns</span>
<span class="keyword">subfile</span> <span class="keyword">owner</span> main;
<span class="keyword">pub</span> <span class="keyword">fn</span> func() {
    print( val ); <span class="comment">// Can access members of main</span>
}
</code></pre>
        <p>Files specified with <code>subfile use</code> are combined and compiled as if they were part of the
            <code>main</code> file.</p>

    </div>
</body>

</html>