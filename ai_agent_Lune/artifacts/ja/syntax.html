<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuneScript 入門 - 基本構文</title>
    <link rel="stylesheet" href="../style.css">
    <script src="../main.js" defer></script>
</head>

<body>
    <div class="sidebar">
        <h1>LuneScript Guide</h1>
        <ul class="nav-links">
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="index.html">はじめに</a>
                <ul class="submenu">
                    <li><a href="index.html#features">主な特徴</a></li>
                    <li><a href="index.html#audience">対象読者</a></li>
                    <li><a href="index.html#license">ライセンス</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="learning.html">学習ガイド</a>
                <ul class="submenu">
                    <li><a href="learning.html#step1">ステップ1: 基礎</a></li>
                    <li><a href="learning.html#step2">ステップ2: 安全機能</a></li>
                    <li><a href="learning.html#step3">ステップ3: モダン機能</a></li>
                    <li><a href="learning.html#navigation">ドキュメント活用</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="tutorial.html">導入とHello World</a>
                <ul class="submenu">
                    <li><a href="tutorial.html#install">導入</a></li>
                    <li><a href="tutorial.html#hello">Hello World</a></li>
                    <li><a href="tutorial.html#options">lnsc コマンド</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="syntax.html">基本構文</a>
                <ul class="submenu">
                    <li><a href="syntax.html#comments">コメント</a></li>
                    <li><a href="syntax.html#vars">変数宣言</a></li>
                    <li><a href="syntax.html#flow">フロー解析による初期化</a></li>
                    <li><a href="syntax.html#scope">スコープブロック</a></li>
                    <li><a href="syntax.html#attr">属性</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="value.html">値と型</a>
                <ul class="submenu">
                    <li><a href="value.html#primitive">プリミティブ型</a></li>
                    <li><a href="value.html#collection">コレクション</a></li>
                    <li><a href="value.html#list">&nbsp;&nbsp;List</a></li>
                    <li><a href="value.html#map">&nbsp;&nbsp;Map</a></li>
                    <li><a href="value.html#set">&nbsp;&nbsp;Set</a></li>
                    <li><a href="value.html#nilable">Nilable 型</a></li>
                    <li><a href="value.html#cast">キャスト</a></li>
                    <li><a href="value.html#alge">Algebric Data Type</a></li>
                    <li><a href="value.html#enum">Enum</a></li>
                    <li><a href="value.html#tuple">Tuple</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="control.html">制御構文</a>
                <ul class="submenu">
                    <li><a href="control.html#if">if 文</a></li>
                    <li><a href="control.html#switch">switch 文</a></li>
                    <li><a href="control.html#while">while 文</a></li>
                    <li><a href="control.html#repeat">repeat 文</a></li>
                    <li><a href="control.html#for">for 文</a></li>
                    <li><a href="control.html#foreach">foreach 文</a></li>
                    <li><a href="control.html#apply">apply 文</a></li>
                    <li><a href="control.html#match">match 文</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="error.html">エラーハンドリング</a>
                <ul class="submenu">
                    <li><a href="error.html#ret">__Ret 型</a></li>
                    <li><a href="error.html#delegation">エラーの委譲</a></li>
                    <li><a href="error.html#best_practice">型と使い分け</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="function.html">関数</a>
                <ul class="submenu">
                    <li><a href="function.html#def">定義</a></li>
                    <li><a href="function.html#multi_ret">多値返却</a></li>
                    <li><a href="function.html#closure">クロージャ</a></li>
                    <li><a href="function.html#form">Form (関数型)</a></li>
                    <li><a href="function.html#varargs">可変長引数</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="class.html">クラス</a>
                <ul class="submenu">
                    <li><a href="class.html#def">定義とインスタンス化</a></li>
                    <li><a href="class.html#inherit">継承とオーバーライド</a></li>
                    <li><a href="class.html#abstract">抽象クラス</a></li>
                    <li><a href="class.html#interface">インタフェース</a></li>
                    <li><a href="class.html#advertise">Advertise</a></li>
                    <li><a href="class.html#mapping">Mapping</a></li>
                    <li><a href="class.html#proto">プロトタイプ宣言</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="generics.html">Generics</a>
                <ul class="submenu">
                    <li><a href="generics.html#func">関数の Generics</a></li>
                    <li><a href="generics.html#class">クラスの Generics</a></li>
                    <li><a href="generics.html#constraint">型パラメータの制約</a></li>
                    <li><a href="generics.html#method">メソッドの Generics</a></li>
                    <li><a href="generics.html#mut">Generics と Mutability</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="macro.html">マクロ</a>
                <ul class="submenu">
                    <li><a href="macro.html#def">定義</a></li>
                    <li><a href="macro.html#arg">引数</a></li>
                    <li><a href="macro.html#quote">Quoting</a></li>
                    <li><a href="macro.html#statement">Macro Statement</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="advanced.html">高度な機能</a>
                <ul class="submenu">
                    <li><a href="advanced.html#match">パターンマッチ</a></li>
                    <li><a href="advanced.html#async">非同期処理</a></li>
                    <li><a href="advanced.html#glue">Glue コード</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="module.html">モジュールとプロジェクト</a>
                <ul class="submenu">
                    <li><a href="module.html#module">モジュールシステム</a></li>
                    <li><a href="module.html#project">プロジェクト設定</a></li>
                    <li><a href="module.html#provide">Provide</a></li>
                    <li><a href="module.html#require">Require</a></li>
                    <li><a href="module.html#subfile">Subfile</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="standard.html">標準ライブラリ</a>
                <ul class="submenu">
                    <li><a href="standard.html#builtin">ビルトイン関数</a></li>
                    <li><a href="standard.html#lua">Lua 標準ライブラリ</a></li>
                    <li><a href="standard.html#io">IO</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="tutorial_macro.html">実践: マクロ活用</a>
                <ul class="submenu">
                    <li><a href="tutorial_macro.html#step1">Step 1: デバッグプリント</a></li>
                    <li><a href="tutorial_macro.html#step2">Step 2: アサーション</a></li>
                    <li><a href="tutorial_macro.html#step3">Step 3: 計測</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="tutorial_parser.html">実践: 数式パーサ</a>
                <ul class="submenu">
                    <li><a href="tutorial_parser.html#goal">目標</a></li>
                    <li><a href="tutorial_parser.html#token">Step 1: トークン定義</a></li>
                    <li><a href="tutorial_parser.html#lexer">Step 2: 字句解析</a></li>
                    <li><a href="tutorial_parser.html#ast">Step 3: 構文木 (AST)</a></li>
                    <li><a href="tutorial_parser.html#parser">Step 4: 構文解析</a></li>
                    <li><a href="tutorial_parser.html#eval">Step 5: 評価と実行</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="keyword.html">キーワード一覧</a>
                <ul class="submenu">
                    <li><a href="keyword.html#a">A-G</a></li>
                    <li><a href="keyword.html#h">H-N</a></li>
                    <li><a href="keyword.html#o">O-U</a></li>
                    <li><a href="keyword.html#v">V-Z</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="troubleshooting.html">トラブルシューティング</a>
                <ul class="submenu">
                    <li><a href="troubleshooting.html#char">文字リテラル</a></li>
                    <li><a href="troubleshooting.html#mut">ミュータブルなメソッド</a></li>
                    <li><a href="troubleshooting.html#match">パターンマッチ</a></li>
                    <li><a href="troubleshooting.html#unwrap">Nilable 型の操作</a></li>
                    <li><a href="troubleshooting.html#macro">マクロの構文エラー</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="evaluation.html">考察と評価</a>
                <ul class="submenu">
                    <li><a href="evaluation.html#quality">言語の出来</a></li>
                    <li><a href="evaluation.html#vs-lua">Luaとの比較</a></li>
                    <li><a href="evaluation.html#vs-teal">Tealとの比較</a></li>
                    <li><a href="evaluation.html#issues">課題と提案</a></li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="main-content">
    <div class="header-nav">
        <a href="../en/syntax.html" class="lang-link">English</a>
    </div>
        <h1>基本構文</h1>
        <p>LuneScript の基本的な構文について説明します。Lua の文法をベースにしつつ、静的型付けによる安全性を高めるための拡張が行われています。</p>

        <h2 id="comments">コメント</h2>
        <p>LuneScript では C++ スタイルのコメントが使用できます。</p>
        <ul>
            <li><code>//</code> : 行末までのコメント (1行コメント)</li>
            <li><code>/* ... */</code> : 複数行コメント</li>
        </ul>
        <pre><code class="language-lns"><span class="comment">// これは1行コメントです</span>
<span class="keyword">let</span> val = <span class="number">1</span>; <span class="comment">// 行の途中からでも書けます</span>

<span class="comment">/*
  これは
  複数行の
  コメントです
*/</span>
</code></pre>
        <div class="note">
            Lua 5.3 の <code>//</code> (切り捨て除算) は、LuneScript ではコメントとして扱われます。
            切り捨て除算を行いたい場合は、<code>int</code> 同士の除算を行うか、明示的なキャストや関数を使用してください。
        </div>

        <h2 id="vars">変数宣言</h2>
        <p id="keyword_let">変数は <code>let</code> キーワードを使用して宣言します。LuneScript は静的型付け言語であるため、変数は型を持ちます。</p>

        <h3>基本的な宣言</h3>
        <pre><code class="language-lns"><span class="keyword">let</span> val: <span class="type">int</span> = <span class="number">1</span>;
</code></pre>
        <p>変数名の後に <code>:型名</code> を記述します。宣言と同時に初期化を行うことが一般的です。</p>
        <p>初期値の型が宣言された型と異なる場合、コンパイルエラーとなります。</p>
        <pre><code class="language-lns"><span class="comment">// Error: int 型の変数に real 型の値は代入できません</span>
<span class="keyword">let</span> param: <span class="type">int</span> = <span class="number">1.5</span>; 
</code></pre>

        <h3>型推論</h3>
        <p>初期値が与えられている場合、型宣言を省略することができます。コンパイラが右辺の値から型を推論します。</p>
        <pre><code class="language-lns"><span class="keyword">let</span> val1 = <span class="number">10</span>;      <span class="comment">// int として推論</span>
<span class="keyword">let</span> val2 = <span class="number">1.5</span>;     <span class="comment">// real として推論</span>
<span class="keyword">let</span> val3 = <span class="string">"test"</span>;  <span class="comment">// str として推論</span>
<span class="keyword">let</span> val4 = <span class="keyword">true</span>;    <span class="comment">// bool として推論</span>
</code></pre>
        <p>型を明示する必要があるのは、主に以下のようなケースです。</p>
        <ul>
            <li><code>nilable</code> 型 (T!) の変数に <code>nil</code> を初期値として与える場合: <code>let val: int! = nil;</code></li>
            <li>空のリストやマップを定義する場合: <code>let list: List&lt;int&gt; = [];</code></li>
            <li>スーパークラスの型で変数を受けたい場合: <code>let obj: SuperClass = new SubClass();</code></li>
        </ul>

        <h3 id="keyword_mut">可変 (Mutable) と 不変 (Immutable)</h3>
        <p><code>let</code> で宣言された変数は、デフォルトで <strong>不変 (Immutable)</strong> です。再代入はできません。</p>
        <p>再代入可能な変数を宣言するには、<code>mut</code> キーワードを使用します。</p>
        <pre><code class="language-lns"><span class="keyword">let</span> <span class="keyword">mut</span> count = <span class="number">0</span>;
count = count + <span class="number">1</span>; <span class="comment">// OK</span>

<span class="keyword">let</span> fixed = <span class="number">10</span>;
<span class="comment">// fixed = 20; // Error: Immutable variable cannot be modified</span>
</code></pre>

        <h2 id="flow">フロー解析による初期化 (変数初期化漏れ検知)</h2>
        <p>LuneScript では、変数の宣言時に初期化を行わなくても構いませんが、変数を参照する前には必ず初期化されている必要があります。</p>
        <p>コンパイラは<strong>フロー解析</strong>を行い、すべての実行パスで変数が初期化されているかをチェックします（<strong>変数初期化漏れ検知</strong>）。</p>
        <pre><code class="language-lns"><span class="keyword">fn</span> check( flag: <span class="type">bool</span> ) {
    <span class="keyword">let</span> val: <span class="type">int</span>;

    <span class="keyword">if</span> flag {
        val = <span class="number">10</span>;
    } <span class="keyword">else</span> {
        val = <span class="number">20</span>;
    }
    
    <span class="comment">// すべてのパスで初期化されているため OK</span>
    print( val ); 
}
</code></pre>
        <p>もし初期化されていないパスが存在する場合、コンパイルエラーとなります。</p>
        <pre><code class="language-lns"><span class="keyword">fn</span> errorCase( flag: <span class="type">bool</span> ) {
    <span class="keyword">let</span> val: <span class="type">int</span>;
    <span class="keyword">if</span> flag {
        val = <span class="number">10</span>;
    }
    <span class="comment">// else 節がないため、flag が false の場合に初期化されない</span>
    <span class="comment">// print( val ); // Error: variable 'val' may be uninitialized</span>
}
</code></pre>
        <p>このフロー解析による初期化は「遅延初期化」であり、<code>mut</code> 宣言は不要です（一度だけ代入されるため）。</p>

        <h2 id="scope">スコープブロック</h2>
        <p>波括弧 <code>{ ... }</code> で囲まれた部分はスコープブロックとなります。ブロック内で宣言された変数は、そのブロックの外からはアクセスできません。</p>
        <pre><code class="language-lns"><span class="keyword">let</span> outer = <span class="number">1</span>;
{
    <span class="keyword">let</span> inner = <span class="number">2</span>;
    print( outer, inner ); <span class="comment">// 1 2</span>
}
<span class="comment">// print( inner ); // Error: 'inner' is undefined</span>
</code></pre>
        <div class="note">
            <strong>シャドーイングの禁止:</strong><br>
            LuneScript では、外側のスコープで既に定義されている変数と<strong>同名の変数を内側のスコープで定義すること（シャドーイング）はできません。</strong><br>
            意図しない変数の参照ミスを防ぐための制約です。
        </div>
        <pre><code class="language-lns"><span class="keyword">let</span> val = <span class="number">1</span>;
{
    <span class="comment">// Error: shadowing symbol of val</span>
    <span class="comment">// let val = 2; </span>
}
</code></pre>

    </div>
</body>

</html>