<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuneScript 入門 - 制御構文</title>
    <link rel="stylesheet" href="../style.css">
    <script src="../main.js" defer></script>
</head>

<body>
    <div class="sidebar">
        <h1>LuneScript Guide</h1>
        <ul class="nav-links">
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="index.html">はじめに</a>
                <ul class="submenu">
                    <li><a href="index.html#features">主な特徴</a></li>
                    <li><a href="index.html#audience">対象読者</a></li>
                    <li><a href="index.html#license">ライセンス</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="learning.html">学習ガイド</a>
                <ul class="submenu">
                    <li><a href="learning.html#step1">ステップ1: 基礎</a></li>
                    <li><a href="learning.html#step2">ステップ2: 安全機能</a></li>
                    <li><a href="learning.html#step3">ステップ3: モダン機能</a></li>
                    <li><a href="learning.html#navigation">ドキュメント活用</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="tutorial.html">導入とHello World</a>
                <ul class="submenu">
                    <li><a href="tutorial.html#install">導入</a></li>
                    <li><a href="tutorial.html#hello">Hello World</a></li>
                    <li><a href="tutorial.html#options">lnsc コマンド</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="syntax.html">基本構文</a>
                <ul class="submenu">
                    <li><a href="syntax.html#comments">コメント</a></li>
                    <li><a href="syntax.html#vars">変数宣言</a></li>
                    <li><a href="syntax.html#flow">フロー解析による初期化</a></li>
                    <li><a href="syntax.html#scope">スコープブロック</a></li>
                    <li><a href="syntax.html#attr">属性</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="value.html">値と型</a>
                <ul class="submenu">
                    <li><a href="value.html#primitive">プリミティブ型</a></li>
                    <li><a href="value.html#collection">コレクション</a></li>
                    <li><a href="value.html#list">&nbsp;&nbsp;List</a></li>
                    <li><a href="value.html#map">&nbsp;&nbsp;Map</a></li>
                    <li><a href="value.html#set">&nbsp;&nbsp;Set</a></li>
                    <li><a href="value.html#nilable">Nilable 型</a></li>
                    <li><a href="value.html#cast">キャスト</a></li>
                    <li><a href="value.html#alge">Algebric Data Type</a></li>
                    <li><a href="value.html#enum">Enum</a></li>
                    <li><a href="value.html#tuple">Tuple</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="control.html">制御構文</a>
                <ul class="submenu">
                    <li><a href="control.html#if">if 文</a></li>
                    <li><a href="control.html#switch">switch 文</a></li>
                    <li><a href="control.html#while">while 文</a></li>
                    <li><a href="control.html#repeat">repeat 文</a></li>
                    <li><a href="control.html#for">for 文</a></li>
                    <li><a href="control.html#foreach">foreach 文</a></li>
                    <li><a href="control.html#apply">apply 文</a></li>
                    <li><a href="control.html#match">match 文</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="error.html">エラーハンドリング</a>
                <ul class="submenu">
                    <li><a href="error.html#ret">__Ret 型</a></li>
                    <li><a href="error.html#delegation">エラーの委譲</a></li>
                    <li><a href="error.html#best_practice">型と使い分け</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="function.html">関数</a>
                <ul class="submenu">
                    <li><a href="function.html#def">定義</a></li>
                    <li><a href="function.html#multi_ret">多値返却</a></li>
                    <li><a href="function.html#closure">クロージャ</a></li>
                    <li><a href="function.html#form">Form (関数型)</a></li>
                    <li><a href="function.html#varargs">可変長引数</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="class.html">クラス</a>
                <ul class="submenu">
                    <li><a href="class.html#def">定義とインスタンス化</a></li>
                    <li><a href="class.html#inherit">継承とオーバーライド</a></li>
                    <li><a href="class.html#abstract">抽象クラス</a></li>
                    <li><a href="class.html#interface">インタフェース</a></li>
                    <li><a href="class.html#advertise">Advertise</a></li>
                    <li><a href="class.html#mapping">Mapping</a></li>
                    <li><a href="class.html#proto">プロトタイプ宣言</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="generics.html">Generics</a>
                <ul class="submenu">
                    <li><a href="generics.html#func">関数の Generics</a></li>
                    <li><a href="generics.html#class">クラスの Generics</a></li>
                    <li><a href="generics.html#constraint">型パラメータの制約</a></li>
                    <li><a href="generics.html#method">メソッドの Generics</a></li>
                    <li><a href="generics.html#mut">Generics と Mutability</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="macro.html">マクロ</a>
                <ul class="submenu">
                    <li><a href="macro.html#def">定義</a></li>
                    <li><a href="macro.html#arg">引数</a></li>
                    <li><a href="macro.html#quote">Quoting</a></li>
                    <li><a href="macro.html#statement">Macro Statement</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="advanced.html">高度な機能</a>
                <ul class="submenu">
                    <li><a href="advanced.html#match">パターンマッチ</a></li>
                    <li><a href="advanced.html#async">非同期処理</a></li>
                    <li><a href="advanced.html#glue">Glue コード</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="module.html">モジュールとプロジェクト</a>
                <ul class="submenu">
                    <li><a href="module.html#module">モジュールシステム</a></li>
                    <li><a href="module.html#project">プロジェクト設定</a></li>
                    <li><a href="module.html#provide">Provide</a></li>
                    <li><a href="module.html#require">Require</a></li>
                    <li><a href="module.html#subfile">Subfile</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="standard.html">標準ライブラリ</a>
                <ul class="submenu">
                    <li><a href="standard.html#builtin">ビルトイン関数</a></li>
                    <li><a href="standard.html#lua">Lua 標準ライブラリ</a></li>
                    <li><a href="standard.html#io">IO</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="tutorial_macro.html">実践: マクロ活用</a>
                <ul class="submenu">
                    <li><a href="tutorial_macro.html#step1">Step 1: デバッグプリント</a></li>
                    <li><a href="tutorial_macro.html#step2">Step 2: アサーション</a></li>
                    <li><a href="tutorial_macro.html#step3">Step 3: 計測</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="tutorial_parser.html">実践: 数式パーサ</a>
                <ul class="submenu">
                    <li><a href="tutorial_parser.html#goal">目標</a></li>
                    <li><a href="tutorial_parser.html#token">Step 1: トークン定義</a></li>
                    <li><a href="tutorial_parser.html#lexer">Step 2: 字句解析</a></li>
                    <li><a href="tutorial_parser.html#ast">Step 3: 構文木 (AST)</a></li>
                    <li><a href="tutorial_parser.html#parser">Step 4: 構文解析</a></li>
                    <li><a href="tutorial_parser.html#eval">Step 5: 評価と実行</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="keyword.html">キーワード一覧</a>
                <ul class="submenu">
                    <li><a href="keyword.html#a">A-G</a></li>
                    <li><a href="keyword.html#h">H-N</a></li>
                    <li><a href="keyword.html#o">O-U</a></li>
                    <li><a href="keyword.html#v">V-Z</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="troubleshooting.html">トラブルシューティング</a>
                <ul class="submenu">
                    <li><a href="troubleshooting.html#char">文字リテラル</a></li>
                    <li><a href="troubleshooting.html#mut">ミュータブルなメソッド</a></li>
                    <li><a href="troubleshooting.html#match">パターンマッチ</a></li>
                    <li><a href="troubleshooting.html#unwrap">Nilable 型の操作</a></li>
                    <li><a href="troubleshooting.html#macro">マクロの構文エラー</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="evaluation.html">考察と評価</a>
                <ul class="submenu">
                    <li><a href="evaluation.html#quality">言語の出来</a></li>
                    <li><a href="evaluation.html#vs-lua">Luaとの比較</a></li>
                    <li><a href="evaluation.html#vs-teal">Tealとの比較</a></li>
                    <li><a href="evaluation.html#issues">課題と提案</a></li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="main-content">
    <div class="header-nav">
        <a href="../en/control.html" class="lang-link">English</a>
    </div>
        <h1>制御構文</h1>
        <p>LuneScript のプログラム制御フローを記述するための構文について説明します。</p>

        <h2 id="if" id="keyword_if">if 文</h2>
        <p>条件分岐を行います。<code>elseif</code> や <code>else</code> ブロックを続けることができます。</p>
        <pre><code class="language-lns"><span class="keyword">let</span> val = <span class="number">10</span>;
<span class="keyword">if</span> val == <span class="number">1</span> {
    print( <span class="string">"val is 1"</span> );
} <span class="keyword">elseif</span> val == <span class="number">10</span> {
    print( <span class="string">"val is 10"</span> );
} <span class="keyword">else</span> {
    print( <span class="string">"other"</span> );
}
</code></pre>
        <p>LuneScript では、式の結果が <code>nil</code> または <code>false</code> の場合に「不成立」とみなされます。それ以外はすべて「成立」です。</p>
        <div class="warn">
            <code>bool</code> 値に対して <code>== true</code> や <code>== false</code> で比較することは推奨されません。
            <code>if exp</code> や <code>if not exp</code> のように記述してください。
        </div>

        <h2 id="switch" id="keyword_switch">switch 文</h2>
        <p>値による分岐を行います。Lua にはない構文ですが、LuneScript ではサポートされています。</p>
        <pre><code class="language-lns"><span class="keyword">let</span> val = <span class="number">1</span>;
<span class="keyword">switch</span> val {
    <span class="keyword">case</span> <span class="number">1</span> {
        print( <span class="string">"One"</span> );
    }
    <span class="keyword">case</span> <span class="number">2</span>, <span class="number">3</span> { <span class="comment">// 複数の値を指定可能</span>
        print( <span class="string">"Two or Three"</span> );
    }
    <span class="keyword">default</span> {
        print( <span class="string">"Other"</span> );
    }
}
</code></pre>
        <ul>
            <li><code>case</code> には複数の値をカンマ区切りで指定できます。</li>
            <li><code>break</code> は不要です（自動的にブロックを抜けます）。</li>
            <li><code>default</code> 節ですべてのケースを網羅していない場合の動作を記述します。</li>
        </ul>
        <p><strong>Enum との連携:</strong> 条件式が Enum
            値の場合、コンパイラはすべてのケースが網羅されているかチェックします。すべてのケースが記述されている場合、<code>default</code>
            は到達不能とみなされ、記述すると警告になります（フェイルセーフとして記述したい場合は <code>_default</code> を使用します）。</p>

        <h2 id="match" id="keyword_match">match 文</h2>
        <p><code>alge</code> 型の値に対してパターンマッチを行い、値を取り出して分岐処理を行います。</p>
        <pre><code class="language-lns"><span class="keyword">alge</span> Result {
    Val( <span class="type">int</span> ),
    Err( <span class="type">str</span> ),
}
<span class="keyword">fn</span> check( res: Result ) {
    <span class="keyword">match</span> res {
        <span class="keyword">case</span> .Val( val ) {
            print( <span class="string">"Success:"</span>, val );
        }
        <span class="keyword">case</span> .Err( msg ) {
            print( <span class="string">"Error:"</span>, msg );
        }
    }
}
</code></pre>
        <p><code>alge</code> 型についての詳細は <a href="value.html#alge">値と型</a> の章を参照してください。</p>

        <h2 id="while" id="keyword_while">while 文</h2>
        <p>条件が成立している間、ループを繰り返します。</p>
        <pre><code class="language-lns"><span class="keyword">let</span> <span class="keyword">mut</span> val = <span class="number">0</span>;
<span class="keyword">while</span> val < <span class="number">5</span> {
    print( val );
    val = val + <span class="number">1</span>;
}
</code></pre>
        <p>無限ループを作成する場合は、<code>while true { ... }</code> を使用します。この <code>true</code> はリテラルである必要があります（定数変数などは不可）。</p>

        <h2 id="repeat" id="keyword_repeat">repeat 文</h2>
        <p>条件が成立するまで（不成立の間）、ループを繰り返します。ブロックの実行後に条件判定が行われます。</p>
        <pre><code class="language-lns"><span class="keyword">let</span> <span class="keyword">mut</span> val = <span class="number">0</span>;
<span class="keyword">repeat</span> {
    val = val + <span class="number">1</span>;
} val >= <span class="number">5</span>;
</code></pre>
        <p>ブロック内で宣言された変数を、終了条件式で使用することができます。</p>
        <p>※ <code>repeat</code> は将来的に廃止される可能性があります。</p>

        <h2 id="for" id="keyword_for">for 文</h2>
        <p>数値範囲でのループを行います。</p>
        <pre><code class="language-lns"><span class="comment">// 1 から 10 まで 1 ずつ増加</span>
<span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">10</span> {
    print( i );
}

<span class="comment">// 10 から 1 まで -1 ずつ増加（減少）</span>
<span class="keyword">for</span> i = <span class="number">10</span>, <span class="number">1</span>, -<span class="number">1</span> {
    print( i );
}
</code></pre>
        <p>形式は <code>for 変数 = 開始値, 終了値 [, ステップ] { ... }</code> です。ステップを省略した場合は 1 になります。</p>

        <h2 id="foreach" id="keyword_foreach">foreach 文</h2>
        <p>コレクション (List, Map, Set) の要素を反復処理します。</p>
        <pre><code class="language-lns"><span class="keyword">let</span> list = [ <span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span> ];
<span class="keyword">foreach</span> val, index <span class="keyword">in</span> list {
    print( index, val ); <span class="comment">// 1 10, 2 20, 3 30</span>
}

<span class="keyword">let</span> map = { <span class="string">"a"</span>: <span class="number">1</span>, <span class="string">"b"</span>: <span class="number">2</span> };
<span class="keyword">foreach</span> val, key <span class="keyword">in</span> map {
    print( key, val );
}
</code></pre>
        <ul>
            <li><code>List</code>: <code>val, index</code> の順で受け取ります。</li>
            <li><code>Map</code>: <code>val, key</code> の順で受け取ります。</li>
            <li><code>Set</code>: <code>val</code> のみ受け取ります。</li>
            <li>インデックスやキーが不要な場合は省略可能です: <code>foreach val in list { ... }</code></li>
            <li>Map や Set の列挙順序は不定です。順序を保証したい場合は <code>forsort</code> を使用します。</li>
        </ul>

        <h2 id="apply" id="keyword_apply">apply 文</h2>
        <p>Lua のイテレータ関数を使用する場合に使います（Lua の <code>for in</code> 相当）。</p>
        <pre><code class="language-lns"><span class="keyword">apply</span> txt <span class="keyword">of</span> string.gmatch( <span class="string">"a.b.c"</span>, <span class="string">"[^%.]+"</span> ) {
    print( txt );
}
</code></pre>

    </div>
</body>
</html>
