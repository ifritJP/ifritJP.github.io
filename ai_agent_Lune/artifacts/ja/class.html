<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuneScript 入門 - クラス</title>
    <link rel="stylesheet" href="../style.css">
    <script src="../main.js" defer></script>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4708B8S6ES"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-4708B8S6ES');
</script>
</head>

<body>
    <div class="sidebar">
        <h1>LuneScript Guide</h1>
        <ul class="nav-links">
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="index.html">はじめに</a>
                <ul class="submenu">
                    <li><a href="index.html#features">主な特徴</a></li>
                    <li><a href="index.html#audience">対象読者</a></li>
                    <li><a href="index.html#license">ライセンス</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="learning.html">学習ガイド</a>
                <ul class="submenu">
                    <li><a href="learning.html#step1">ステップ1: 基礎</a></li>
                    <li><a href="learning.html#step2">ステップ2: 安全機能</a></li>
                    <li><a href="learning.html#step3">ステップ3: モダン機能</a></li>
                    <li><a href="learning.html#navigation">ドキュメント活用</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="tutorial.html">導入とHello World</a>
                <ul class="submenu">
                    <li><a href="tutorial.html#install">導入</a></li>
                    <li><a href="tutorial.html#hello">Hello World</a></li>
                    <li><a href="tutorial.html#options">lnsc コマンド</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="syntax.html">基本構文</a>
                <ul class="submenu">
                    <li><a href="syntax.html#comments">コメント</a></li>
                    <li><a href="syntax.html#vars">変数宣言</a></li>
                    <li><a href="syntax.html#flow">フロー解析による初期化</a></li>
                    <li><a href="syntax.html#scope">スコープブロック</a></li>
                    <li><a href="syntax.html#attr">属性</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="value.html">値と型</a>
                <ul class="submenu">
                    <li><a href="value.html#primitive">プリミティブ型</a></li>
                    <li><a href="value.html#collection">コレクション</a></li>
                    <li><a href="value.html#list">&nbsp;&nbsp;List</a></li>
                    <li><a href="value.html#map">&nbsp;&nbsp;Map</a></li>
                    <li><a href="value.html#set">&nbsp;&nbsp;Set</a></li>
                    <li><a href="value.html#nilable">Nilable 型</a></li>
                    <li><a href="value.html#cast">キャスト</a></li>
                    <li><a href="value.html#alge">Algebric Data Type</a></li>
                    <li><a href="value.html#enum">Enum</a></li>
                    <li><a href="value.html#tuple">Tuple</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="control.html">制御構文</a>
                <ul class="submenu">
                    <li><a href="control.html#if">if 文</a></li>
                    <li><a href="control.html#switch">switch 文</a></li>
                    <li><a href="control.html#while">while 文</a></li>
                    <li><a href="control.html#repeat">repeat 文</a></li>
                    <li><a href="control.html#for">for 文</a></li>
                    <li><a href="control.html#foreach">foreach 文</a></li>
                    <li><a href="control.html#apply">apply 文</a></li>
                    <li><a href="control.html#match">match 文</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="error.html">エラーハンドリング</a>
                <ul class="submenu">
                    <li><a href="error.html#ret">__Ret 型</a></li>
                    <li><a href="error.html#delegation">エラーの委譲</a></li>
                    <li><a href="error.html#best_practice">型と使い分け</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="function.html">関数</a>
                <ul class="submenu">
                    <li><a href="function.html#def">定義</a></li>
                    <li><a href="function.html#multi_ret">多値返却</a></li>
                    <li><a href="function.html#closure">クロージャ</a></li>
                    <li><a href="function.html#form">Form (関数型)</a></li>
                    <li><a href="function.html#varargs">可変長引数</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="class.html">クラス</a>
                <ul class="submenu">
                    <li><a href="class.html#def">定義とインスタンス化</a></li>
                    <li><a href="class.html#inherit">継承とオーバーライド</a></li>
                    <li><a href="class.html#abstract">抽象クラス</a></li>
                    <li><a href="class.html#interface">インタフェース</a></li>
                    <li><a href="class.html#advertise">Advertise</a></li>
                    <li><a href="class.html#mapping">Mapping</a></li>
                    <li><a href="class.html#proto">プロトタイプ宣言</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="generics.html">Generics</a>
                <ul class="submenu">
                    <li><a href="generics.html#func">関数の Generics</a></li>
                    <li><a href="generics.html#class">クラスの Generics</a></li>
                    <li><a href="generics.html#constraint">型パラメータの制約</a></li>
                    <li><a href="generics.html#method">メソッドの Generics</a></li>
                    <li><a href="generics.html#mut">Generics と Mutability</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="macro.html">マクロ</a>
                <ul class="submenu">
                    <li><a href="macro.html#def">定義</a></li>
                    <li><a href="macro.html#arg">引数</a></li>
                    <li><a href="macro.html#quote">Quoting</a></li>
                    <li><a href="macro.html#statement">Macro Statement</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="advanced.html">高度な機能</a>
                <ul class="submenu">
                    <li><a href="advanced.html#match">パターンマッチ</a></li>
                    <li><a href="advanced.html#async">非同期処理</a></li>
                    <li><a href="advanced.html#glue">Glue コード</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="module.html">モジュールとプロジェクト</a>
                <ul class="submenu">
                    <li><a href="module.html#module">モジュールシステム</a></li>
                    <li><a href="module.html#project">プロジェクト設定</a></li>
                    <li><a href="module.html#provide">Provide</a></li>
                    <li><a href="module.html#require">Require</a></li>
                    <li><a href="module.html#subfile">Subfile</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="standard.html">標準ライブラリ</a>
                <ul class="submenu">
                    <li><a href="standard.html#builtin">ビルトイン関数</a></li>
                    <li><a href="standard.html#lua">Lua 標準ライブラリ</a></li>
                    <li><a href="standard.html#io">IO</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="tutorial_macro.html">実践: マクロ活用</a>
                <ul class="submenu">
                    <li><a href="tutorial_macro.html#step1">Step 1: デバッグプリント</a></li>
                    <li><a href="tutorial_macro.html#step2">Step 2: アサーション</a></li>
                    <li><a href="tutorial_macro.html#step3">Step 3: 計測</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="tutorial_parser.html">実践: 数式パーサ</a>
                <ul class="submenu">
                    <li><a href="tutorial_parser.html#goal">目標</a></li>
                    <li><a href="tutorial_parser.html#token">Step 1: トークン定義</a></li>
                    <li><a href="tutorial_parser.html#lexer">Step 2: 字句解析</a></li>
                    <li><a href="tutorial_parser.html#ast">Step 3: 構文木 (AST)</a></li>
                    <li><a href="tutorial_parser.html#parser">Step 4: 構文解析</a></li>
                    <li><a href="tutorial_parser.html#eval">Step 5: 評価と実行</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="keyword.html">キーワード一覧</a>
                <ul class="submenu">
                    <li><a href="keyword.html#a">A-G</a></li>
                    <li><a href="keyword.html#h">H-N</a></li>
                    <li><a href="keyword.html#o">O-U</a></li>
                    <li><a href="keyword.html#v">V-Z</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="troubleshooting.html">トラブルシューティング</a>
                <ul class="submenu">
                    <li><a href="troubleshooting.html#char">文字リテラル</a></li>
                    <li><a href="troubleshooting.html#mut">ミュータブルなメソッド</a></li>
                    <li><a href="troubleshooting.html#match">パターンマッチ</a></li>
                    <li><a href="troubleshooting.html#unwrap">Nilable 型の操作</a></li>
                    <li><a href="troubleshooting.html#macro">マクロの構文エラー</a></li>
                </ul>
            </li>
            <li class="nav-item">
                <button class="toggle-btn">▶</button>
                <a href="evaluation.html">考察と評価</a>
                <ul class="submenu">
                    <li><a href="evaluation.html#quality">言語の出来</a></li>
                    <li><a href="evaluation.html#vs-lua">Luaとの比較</a></li>
                    <li><a href="evaluation.html#vs-teal">Tealとの比較</a></li>
                    <li><a href="evaluation.html#issues">課題と提案</a></li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="main-content">
        <div class="header-nav">
            <a href="../en/class.html" class="lang-link">English</a>
        </div>
        <h1>クラス</h1>
        <p>LuneScript はクラスベースのオブジェクト指向プログラミングをサポートしています。</p>

        <h2 id="def" id="keyword_class">定義とインスタンス化</h2>
        <p><code>class</code> キーワードで定義し、<code>new</code> でインスタンス化します。</p>
        <pre><code class="language-lns"><span class="keyword">class</span> MyClass {
    <span class="keyword">pri</span> <span class="keyword">let</span> val: <span class="type">int</span>;
    
    <span class="comment">// コンストラクタ</span>
    <span class="keyword">pub</span> <span class="keyword">fn</span> __init( val: <span class="type">int</span> ) {
        <span class="keyword">self</span>.val = val;
    }
    
    <span class="comment">// メソッド</span>
    <span class="keyword">pub</span> <span class="keyword">fn</span> func(): <span class="type">int</span> {
        <span class="keyword">return</span> <span class="keyword">self</span>.val;
    }
}

<span class="keyword">let</span> obj = <span class="keyword">new</span> MyClass( <span class="number">10</span> );
print( obj.func() ); <span class="comment">// 10</span>
</code></pre>
        <ul>
            <li><strong>コンストラクタ:</strong> <code>__init</code> という名前で定義します。すべてのメンバ変数はここで初期化される必要があります。</li>
            <li><strong>self:</strong> 自分自身（インスタンス）への参照は <code>self</code> を使います。</li>
            <li><strong>アクセス制御:</strong> <code>pub</code> (公開), <code>pro</code> (保護 - サブクラスまで), <code>pri</code> (非公開),
                <code>local</code> (モジュール内) があります。デフォルトは <code>pri</code> です。
            </li>
        </ul>

        <h3 id="accessor">アクセサ</h3>
        <p>メンバ定義時に <code>{getter, setter}</code> の形式でアクセサを自動生成できます。</p>
        <pre><code class="language-lns"><span class="keyword">class</span> Data {
    <span class="keyword">pri</span> <span class="keyword">let</span> <span class="keyword">mut</span> val: <span class="type">int</span> {<span class="keyword">pub</span>, <span class="keyword">pub</span>}; <span class="comment">// getter=pub, setter=pub</span>
    <span class="keyword">pub</span> <span class="keyword">fn</span> __init( val: <span class="type">int</span> ) { <span class="keyword">self</span>.val = val; }
}
<span class="keyword">let</span> <span class="keyword">mut</span> d = <span class="keyword">new</span> Data( <span class="number">1</span> );
</code></pre>

        <h4>$ 演算子</h4>
        <p>自動生成された getter にアクセスするには、メンバ名の前に <code>$</code> を付けます。これは内部的には <code>get_メンバ名()</code>
            メソッドの呼び出しに変換される<strong>シンタックスシュガー</strong>です。<br>
            setter は <code>set_メンバ名</code> というメソッドが生成されます。</p>
        <div class="note">
            <p><strong>なぜ「プロパティ」ではないのか？</strong><br>
                一部の言語にあるような「プロパティ（直接アクセスしているように見えて内部でメソッドが呼ばれる形式）」をあえて採用していません。これにより、単なるデータの代入・参照なのか、副作用のあるメソッド呼び出しなのかがソースコード上で明確に判別できるようになっています。
            </p>
        </div>
        <pre><code class="language-lns"><span class="keyword">class</span> Data {
    <span class="keyword">pri</span> <span class="keyword">let</span> <span class="keyword">mut</span> val: <span class="type">int</span> {<span class="keyword">pub</span>, <span class="keyword">pub</span>};
    <span class="keyword">pub</span> <span class="keyword">fn</span> __init( val: <span class="type">int</span> ) { <span class="keyword">self</span>.val = val; }
}
<span class="keyword">let</span> <span class="keyword">mut</span> d = <span class="keyword">new</span> Data( <span class="number">1</span> );
print( d.$val ); <span class="comment">// getter 呼び出し ($記号)</span>
d.set_val( <span class="number">20</span> ); <span class="comment">// setter 呼び出し (set_メンバ名)</span>
print( d.$val );
</code></pre>

        <h4>アクセス制御の省略</h4>
        <p>setter が不要な場合は、2つ目の指定を省略または <code>non</code> を指定します。</p>
        <pre><code class="language-lns"><span class="keyword">class</span> AccessorTest {
    <span class="keyword">pri</span> <span class="keyword">let</span> val1: <span class="type">int</span> {<span class="keyword">pub</span>};       <span class="comment">// getterのみ (setterなし)</span>
    <span class="keyword">pri</span> <span class="keyword">let</span> val2: <span class="type">int</span> {<span class="keyword">pub</span>, <span class="keyword">non</span>}; <span class="comment">// 同上</span>
}
</code></pre>

        <h4>Immutable な戻り値</h4>
        <p>getter の戻り値を Immutable にしたい場合は、<code>&</code> を付けます。</p>
        <pre><code class="language-lns"><span class="keyword">class</span> ListWrapper {
    <span class="keyword">pri</span> <span class="keyword">let</span> <span class="keyword">mut</span> list: <span class="type">List</span>&lt;<span class="type">int</span>&gt; {<span class="keyword">pub</span>&, <span class="keyword">pub</span>};
}
<span class="comment">// $list は &List&lt;int&gt; (read-only) を返すので、変更できない</span>
</code></pre>

        <h2 id="inherit" id="keyword_extend">継承とオーバーライド</h2>
        <p><code>extend</code> で単一継承が可能です。メソッドのオーバーライドには <code>override</code> キーワードが必須です。</p>
        <pre><code class="language-lns"><span class="keyword">class</span> Base {
    <span class="keyword">pub</span> <span class="keyword">fn</span> func() { print( <span class="string">"Base"</span> ); }
}

<span class="keyword">class</span> Sub <span class="keyword">extend</span> Base {
    <span class="keyword">pub</span> <span class="keyword">override</span> <span class="keyword">fn</span> func() {
        <span class="keyword">super</span>(); <span class="comment">// 親クラス呼び出し</span>
        print( <span class="string">"Sub"</span> );
    }
}
</code></pre>
        <p>サブクラスのコンストラクタでは、<strong>先頭で <code>super()</code> を呼び出す必要があります。</strong></p>

        <h2 id="abstract" id="keyword_abstract">抽象クラス</h2>
        <p>実装を持たないメソッド (<code>abstract fn</code>) を持つクラスは、<code>abstract class</code> として定義する必要があります。</p>
        <pre><code class="language-lns"><span class="keyword">abstract</span> <span class="keyword">class</span> Animal {
    <span class="keyword">pub</span> <span class="keyword">abstract</span> <span class="keyword">fn</span> cry();
}
</code></pre>

        <h2 id="interface" id="keyword_interface">インタフェース</h2>
        <p>多重継承の代わりにインタフェースを使用できます。インタフェースは実装を持ちません。</p>
        <pre><code class="language-lns"><span class="keyword">interface</span> Runner {
    <span class="keyword">pub</span> <span class="keyword">fn</span> run();
}

<span class="keyword">class</span> Dog <span class="keyword">extend</span> (Runner) {
    <span class="keyword">pub</span> <span class="keyword">fn</span> run() { print( <span class="string">"Run!"</span> ); }
}
</code></pre>
        <p>複数のインタフェースを実装する場合は <code>extend (IF1, IF2)</code> のように記述します。</p>

        <h2 id="advertise" id="keyword_advertise">Advertise (委譲)</h2>
        <p>コンポジション（包含）したオブジェクトのメソッドを、あたかも自分のメソッドのように公開（委譲）する機能です。</p>
        <pre><code class="language-lns"><span class="keyword">class</span> Inner {
    <span class="keyword">pub</span> <span class="keyword">fn</span> foo() { print(<span class="string">"Inner.foo"</span>); }
}
<span class="keyword">class</span> Wrapper {
    <span class="keyword">pri</span> <span class="keyword">let</span> inner: Inner;
    <span class="keyword">advertise</span> inner; <span class="comment">// inner の public メソッドを Wrapper のメソッドとして公開</span>
}
</code></pre>

        <h2 id="mapping" id="keyword_mapping">Mapping</h2>
        <p><code>extend (Mapping)</code> を宣言することで、Map (JSON的なオブジェクト) と相互変換が可能になります。</p>
        <pre><code class="language-lns"><span class="keyword">class</span> User <span class="keyword">extend</span> (Mapping) {
    <span class="keyword">let</span> name: <span class="type">str</span> {<span class="keyword">pub</span>};
    <span class="keyword">let</span> age: <span class="type">int</span> {<span class="keyword">pub</span>};
}

<span class="comment">// JSON (Map) から生成</span>
<span class="keyword">let</span> user = <span class="keyword">unwrap</span> User._fromMap( { <span class="string">"name"</span>: <span class="string">"John"</span>, <span class="string">"age"</span>: <span class="number">20</span> } );
<span class="comment">// Map へ変換</span>
<span class="keyword">let</span> map = user._toMap();
</code></pre>

        <h2 id="proto">プロトタイプ宣言</h2>
        <p>メソッドの実装を後で記述（または別ファイルに記述）する場合に使用します。相互参照が必要な場合に便利です。</p>
        <pre><code class="language-lns"><span class="keyword">class</span> Test {
    <span class="keyword">pub</span> <span class="keyword">fn</span> func(); <span class="comment">// 宣言のみ</span>
}
<span class="comment">// 実装</span>
<span class="keyword">pub</span> <span class="keyword">fn</span> Test.func() {
    print( <span class="string">"impl"</span> );
}
</code></pre>

    </div>
</body>

</html>