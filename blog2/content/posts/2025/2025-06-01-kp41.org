#+TITLE: (KP41病) 新しく PC を組んだら頻繁に画面フリーズと BSOD が発生→原因は CPU  
#+DATE: 2025-05-25
# -*- coding:utf-8 -*-
#+LAYOUT: post
#+AUTHOR: ifritJP
#+OPTIONS: ^:{}
#+STARTUP: nofold

このところ、 新しく PC を組んだことに関連するネタばかり書いているが、
多分今回で最後になる。

* 状況

新しく組んだ PC は、直後から非常に不安定だった。
現象としては以下が発生する。

- 不定期に画面の更新が止まり、ブラックアウト、あるいは、ホワイトアウトし、
  2秒程度経過すると元の画面に戻る
- 不定期に OS が BSOD (ブルースクリーンでリブート)になる

なお、次の画像はその BSOD のイベントログ表示画面のスクショを切り取った画像だが、
見ると分かるように 27 日,29 日,31 日に使用している中で 12 回も発生している。
はっきり言って使い物にならない状況だった。

[[../kp41.png]]


今回のこの現象を調べていくうちに、
この現象に KP41 という名前が付けられていることが分かった。

KP41 の由来は、上記画像を見てもらうと、
上部のヘッダに「ソース」と「イベント」と書かれている。
そこの Kernel-Power と 41 を合せたもののようだ。

* ハードウェア構成

今回の PC を組むにあたって、以下のパーツを新しくしている。

- CPU
- マザー
- DRAM
- NVMe (ただし1台は流用で、もう 1 台は新規)
- GPU (新しいと言っても CPU 内蔵の iGPU を使用している)
- 電源 850W

上記の通り、
電源は 850W であり、 GPU は iGPU を使っているので、
電源が足りなくて不安定になっている、という線はほとんどない。

以上から、原因は CPU/マザー/DRAM/NVMe に絞られる。 


* 調査

この不安定になる原因を探るため以下を行なった

** DDU によるディスプレイドライバ削除

今回の PC を新しく組んだとは言え、
全てが新規なのではなく、
幾つかのパーツと OS イメージは流用している。

特に OS イメージを流用しているので、
ドライバは以前の PC の状態を引き継いで、
その上から今回の PC 用のドライバを入れている状態になっている。

そして、不具合の症状として画面のブラックアウト、ホワイトアウトがあったので、
ディスプレイドライバの影響が大きいと考えた。

特に、以前の PC では NVIDIA で今回は AMD だったので、
余計にその影響が大きいと感じた。

そこで、ディスプレイドライバ削除ツールの DDU を使ってみたが、効果はなかった。

** マザーボードの BIOS (UEFI)

次に疑ったのは BIOS のバージョンである。
今回の PC を組むにあたって、最新にアップデートしてあるのだが、
もしかしたらその最新アップデートに原因があるのかもしれない。

特に、最新バージョンのリリース時期と、
今回私が更新した時期がほぼ同じで、
まだネットでの不具合報告がないだけで実は不安定なバージョンな可能性もある。

そこで、最新バージョンから、使用している CPU をサポートしたバージョンまでを、
2分探索法でバージョンを下げつつ動作を確認した。
しかし、結局現象が発生するのは変わらずだった。

ちなみに、 BIOS の設定はデフォルトである。

** iGPU の設定変更

BIOS で iGPU の設定で VRAM サイズを振ってみたが、それでも変わらず。

** VRAM のクロック変更

VRAM は DRR5-5600 だが、4800 まで下げてみた。
しかし、それも不発。


** M.2 NVMe のファーム更新

この原因を調査していると、以下の情報がヒットした。

<https://support-en.sandisk.com/app/answers/detailweb/a_id/51469>

これによると、特定のNVMeが原因で Win11 24H2 で BSOD が発生することがあるらしい。

自分が使っている 2 台の NVMe の内の 1 つが、ここに挙げられている型番だった。

そこで、 NVMe のファームアップを実施してみるものの、
現象は変わらずだった。

まぁそもそも、この NVMe は以前の PC 環境で使っていて、
そこでは発生していなかったので、
これが原因だという可能性は低かったのだが。

** 不要なアプリのアンインストール

他のアプリによる影響をできるだけ除外するために、
不要なアプリを見直してアンインストールした。

しかし、これも不発。

** MemTest86+ による DRAM テスト

メモリが正常かどうかを確認するため MemTest86+ を実行してみるも、
テストは正常にパス。

** ベンチマークによる負荷テスト

次のベンチマークを実行してみたが、ベンチマークは正常に終了。

- CineBench 2024
- Street Fighter 6 ベンチマーク

** クリーンインストール

ここまで来ると、後は OS のクリーンインストールくらいしかない。

ということでクリーンインストールしてみたが、やはりダメ。

** CPU ?

ということで、後はもう CPU の不具合くらいだろう。

ちなみにネットで検索すると、
BSOD のダンプログを解析する方法が紹介されていた。
それを参考にエラー元のモジュールを確認すると amdppm.sys であることが分かった。

amdppm.sys について調べると、
BSOD の原因が amdppm.sys の場合は CPU の不具合であることが多いらしい。

以下を見ると、一応暫定の回避策もあるようだが、
根本対応は CPU 交換になる。

<https://capasoute.blogspot.com/2022/04/ryzenbsodkp41.html>

この段階では、
不具合の原因が CPU ではなく、マザーの可能性も完全には否定できないが、
それならベンチマークや MemTest86+ が正常に動作するのは、ちょっと考えにくい。

また、今回のような現象の原因に心当たりがある。


ということで、 CPU の初期不良として販売店に連絡し対応を依頼した。

------


なお、既に CPU を交換しているが、
CPU 交換後の PC は非常に調子が良い。
つまり、 CPU の初期不良だったことが確定した。

* まとめ

今回の対応で、なんやかんや検証した時間トータルで 2, 3 日は掛っている。
非効率で、非生産的だ。

これなら PC 自作ではなく、BTO した方がよほどコスパが良いだろう。

とはいえ、BTO で初期不良がないのか？と言えば、全くそんなことはない。

今回は自作用に CPU 単体で買った AMD Ryzen の初期不良だったが、
実は 2 年前に Intel 13 世代 CPU でも CPU 初期不良を引き当てたことがある。
ただ、もしかしたらそちらは初期不良ではなく、
例の 13, 14 世代 CPU のマイクロコード不具合による CPU 破損の可能性も否定できない。

この Intel 13 世代 CPU の初期不良の際は、自作 PC ではなく BTO PC だった。
なので、BTO PC (カスタム出来ないメーカーPC 含む) でも今回のような初期不良は発生する可能性がある。

特に今回のような(発生タイミングが不定期で且つベンチマークなどの高負荷テストだと発生しない)不具合だと、
メーカーでの出荷前検査では検出できない可能性が高いだろう。

よって、これはもはや運でしかない。

ただ、パーツ単位で買うよりは、メーカーで PC 一式買う方が良いだろう。
その方が、
相性問題等を疑われることがないのと、
保証もしっかりしているケースが多い。
よって、特に理由がない限りはメーカーで PC 一式を買うことをオススメする。

ただ、自分は次に PC を更新する場合も自作を選択するような気はする。

なお、今回 CPU の初期不良だと判断できたのは、
Intel 13 世代 CPU の初期不良を引き当てた実績があったからなので、
あんな経験でも役立ったとも言える。

それにしても、2年で 2 回も CPU の初期不良を引き当てるなんて、
なかなかの確率だと思う。
もちろん、CPU をちょくちょく入れ替えているような好事家なら
そういう人もいるかもしれない。
