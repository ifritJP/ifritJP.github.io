#+TITLE: マネーフォワードの SBI 証券連携の話
#+DATE: 2025-09-16
# -*- coding:utf-8 -*-
#+LAYOUT: post
#+AUTHOR: ifritJP
#+OPTIONS: ^:{}
#+STARTUP: nofold


SBI 証券をマネーフォワードに連携させているユーザなら気付いているかもしれないが、
この週末にマネーフォワードで確認できる SBI 証券投資信託銘柄の推移グラフが異常になった。

* 現状の問題

以下は、その異常についてのマネーフォワード公式の通知である。

[[https://support.me.moneyforward.com/hc/ja/articles/50678716949913-SBI%E8%A8%BC%E5%88%B8%E3%81%AE%E6%8A%95%E8%B3%87%E4%BF%A1%E8%A8%97%E3%81%AE%E6%8E%A8%E7%A7%BB%E3%82%B0%E3%83%A9%E3%83%95%E8%A1%A8%E7%A4%BA%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6-2025%E5%B9%B49%E6%9C%8814%E6%97%A516%E6%99%8240%E5%88%86%E6%9B%B4%E6%96%B0][<公式通知>]]

要は、投資信託銘柄の情報は名前で管理しているから、
その名前が変ってしまうと別銘柄として扱ってしまい推移が見れなくなる、ということ。

どうしてこのようなことが起るかと言えば、以下の通り。

- SBI 証券はオープンAPI 等の参照用の REST API を用意していない
- APIが使えないので、マネーフォワードはスクレイピングで Web ページから資産情報を取得している
- SBI 証券のポートフォリオページにおいて、個別株には銘柄コードの情報があるが、
  投資信託には銘柄コードはなくファンド名しかない
- つまりマネーフォワードは、 SBI の投資信託の ID としてファンド名を使うしかない
- よってSBI 証券のファンド名が変わると、マネーフォワードは新しい ID の別資産として扱う

なお、 SBI 証券の内部では投資信託にも何らかの ID が振られているはず。
実際 SBI のポートフォリオの HTML を見ると、ID らしき文字列を見つけることができる。
とはいえ、これが本当に ID なのかどうかは不明ではある。

なお、金融庁は銀行に対しては、 *オープン API* という仕組みを整備するように働き掛け、
既に銀行は対応済みのはずだ。

<https://www.fsa.go.jp/singi/kessai_kanmin/siryou/20190624/05.pdf>


*しかし上記の取り組みは銀行が対象であり、証券会社は対象になっていない。*

そして、SBI 証券は未だに REST API を用意してない *放置状態* である。

なお、スクレイピングで情報を取得しているということは、
それ以外の Web 操作も可能ということであり *セキュリティリスクが高い。*
そもそも、ID/PASS そのものをマネーフォワード側に登録する必要があるので、
*パスワード漏洩のリスク* もある。
もちろん、 SBI 証券のログイン ID/PASS だけでは実際の取引は出来ないが、
それでもリスクがあるのは間違いない。


*こんな状況になっている原因は誰なのか？と言えば、SBI 証券であり、金融庁である。*


と、まぁ、そんな訳で自分も以下のような感じで推移グラフ(右の赤枠部分)が変な状態になった。

[[../moneybw_before.png]]

なお、グラフが異常になっていることに今回気が付いた訳だが、
実はちょっと前にもこの現象が発生していたようだ。

具体的には以下の日興証券の銘柄である。

[[../moneybw_gold.png]]

日興證券の社名がアモーヴァになったことで、投資信託名が変更になっていた。
そして、今回の件で更に変更になっている。

まとめると以下の通りに変っている。

1. (〜8/30)日興○○
2. (8/30〜)アモーヴァ○○
3. (9/16〜)○○


そんな訳で、上記のままだと不便なので今回はその対応を行なう。

* 修正

なお、自分の資産管理は自前のツールで行なっている。

上記はそのツールの画面である(マネーフォワードの画面ではない)。

分散している資産情報をマネーフォワードで収集し、その収集結果を自前ツールに取り込むという形で運用している。

: 各ウェブサイト ===> マネーフォワード ===> 自前ツール

なので、今回はその自前ツールを修正する形になる。

修正内容としては、以下の通り。

- 「変更前の銘柄名」 と 「変更後の銘柄名」 を指定
- 指定された銘柄の推移の情報をマージして「変更後の銘柄名」 に置き換える

上記を対応し、以下のような形で変更前後のペアを設定した (実際には上記だけでなく、他にもいくつか設定している)。

[[../moneybw_switch.png]]


そして、設定後のグラフが以下の通り。

[[../moneybw_after.png]]

これで推移がすっきり。

マネーフォワードもこれくらいの対応すれば良いのに。

* まとめ

大事なことなので2回言うが、
*今回の件の原因は、*
*マネーフォワードであり、SBI 証券であり、さらに辿ると金融庁である。*

特に SBI 証券と金融庁は仕事しろ。セキュリティを軽視しすぎ。

ユーザに責任を押し付けんな。
