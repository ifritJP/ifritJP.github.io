<!DOCTYPE html>
<html lang="ja-jp">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>28. shebang and command line arguments - tech</title>
<meta name="generator" content="Hugo 0.68.3" />
<link href="https://ifritjp.github.io/documentsindex.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://ifritjp.github.io/documents/en/lunescript/shebang_main/">
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/theme.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/custom.css">
<script src="https://ifritjp.github.io/documents/js/bundle.js"></script>
<script src="https://ifritjp.github.io/documents/js/lnsSrcRun.js"></script>
<script src="https://ifritjp.github.io/documents/js/highlight_lns.js"></script>
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/highlight_lns.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120218599-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-120218599-2');
</script>
<style>
:root {}
</style>
<meta property="og:title" content="28. shebang and command line arguments" />
<meta property="og:description" content="LuneScript supports shebang. Shebang compatible   Shebang is a function that executes the specified interpreter when the script file is executed by specifying the interpreter to be used in the comment on the first line of the script file that is often seen in shell scripts. For example, in bash, specify as follows. #! /bin/bash   In LuneScript, specify: #! /usr/bin/lnsc -shebang   Here, /usr/bin/lnsc needs to be specified according to the environment." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ifritjp.github.io/documents/en/lunescript/shebang_main/" />
<meta property="og:site_name" content="tech" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="28. shebang and command line arguments"/>
<meta name="twitter:description" content="LuneScript supports shebang. Shebang compatible   Shebang is a function that executes the specified interpreter when the script file is executed by specifying the interpreter to be used in the comment on the first line of the script file that is often seen in shell scripts. For example, in bash, specify as follows. #! /bin/bash   In LuneScript, specify: #! /usr/bin/lnsc -shebang   Here, /usr/bin/lnsc needs to be specified according to the environment."/>
<meta itemprop="name" content="28. shebang and command line arguments">
<meta itemprop="description" content="LuneScript supports shebang. Shebang compatible   Shebang is a function that executes the specified interpreter when the script file is executed by specifying the interpreter to be used in the comment on the first line of the script file that is often seen in shell scripts. For example, in bash, specify as follows. #! /bin/bash   In LuneScript, specify: #! /usr/bin/lnsc -shebang   Here, /usr/bin/lnsc needs to be specified according to the environment.">

<meta itemprop="wordCount" content="618">



<meta itemprop="keywords" content="" /></head>
<body><div class="container"><header>
<h1>tech</h1>


[<a href="https://ifritjp.github.io/documents/en/">English</a>]

[<a href="https://ifritjp.github.io/documents/">Japanese</a>]

</header>
<div class="global-menu">
<nav>
<ul>
<li><a href="/documents/">Home</a></li>
<li><a href="https://ifritjp.github.io/blog2/public/">blog</a></li>
<li><a href="https://ifritjp.github.io/LuneScript-webFront/contents/">LuneScript on Web</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1>28. shebang and command line arguments</h1>

<p>
LuneScript supports shebang.
</p>
<h2 id="headline-1">
Shebang compatible
</h2>
<p>
Shebang is a function that executes the specified interpreter when the script file is executed by specifying the interpreter to be used in the comment on the first line of the script file that is often seen in shell scripts. For example, in bash, specify as follows.
</p>
<div class="src src-sh">
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1">#! /bin/bash</span></code></pre></div>
</div>
<p>
In LuneScript, specify:
</p>
<div class="src src-sh">
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="c1">#! /usr/bin/lnsc -shebang</span></code></pre></div>
</div>
<p>
Here, <code class="verbatim">/usr/bin/lnsc</code> needs to be specified according to the environment.
</p>
<p>
This allows the LuneScript file containing <code class="verbatim">#!</code> to be executed as is.
</p>
<p>
For example, if you have the following file hello.lns,
</p>
<div class="src src-sh">
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="cp">#! /usr/bin/lnsc -shebang
</span><span class="cp"></span>print<span class="o">(</span> <span class="s2">&#34;hello world&#34;</span> <span class="o">)</span><span class="p">;</span></code></pre></div>
</div>
<p>
You can run this hello.lns directly.
</p>
<div class="src src-txt">
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">$ hello.lns
hello world</code></pre></div>
</div>
<p>
<del>At this time, there are the following restrictions.</del>
</p>
<ul>
<li>
<p>
<del>In the go version of lnsc, the .lua that corresponds to the .lns file you are importing++Must be generated in advance.</del>
</p>
</li>
</ul>
<h2 id="headline-2">
Command line arguments
</h2>
<p>
There are cases where you want to handle command line arguments, such as when launched by shebang or transcompiled to go.
</p>
<p>
To handle this command line argument, define the following __main function to handle the command line arguments passed to this function&#39;s arguments.
</p>
<div class="src src-lns">
<pre><code class="language-lns" data-lang="lns">// @lnsFront: skip   
pub fn __main( argList:&amp;List&lt;str&gt; ):int</code></pre>
</div>
<p>
The type of the __main function must be declared with the above type except for the argument name argList.
</p>
<h3 id="headline-3">
Execution order of __main
</h3>
<p>
The execution order of this __main function is performed after the top scope processing is completed. That is, for the following script
</p>
<div class="src src-lns">
<pre><code class="language-lns" data-lang="lns">#! /usr/bin/lnsc -shebang
// @lnsFront: skip   
print( &#34;hello world&#34; );

pub fn __main( argList:&amp;List&lt;str&gt; ):int {
   print( &#34;hoge&#34; );
   return 0;
}</code></pre>
</div>
<p>
The output result is as follows.
</p>
<div class="src src-txt">
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">$ ./mini.lns 
hello world
hoge</code></pre></div>
</div>
<h3 id="headline-4">
__main argument
</h3>
<p>
The argument for <code class="verbatim">__main</code> is <code class="verbatim">&amp;List&lt;str&gt;</code>.
</p>
<p>
This list contains the script path first, followed by command line arguments.
</p>
<div class="src src-lns">
<pre><code class="language-lns" data-lang="lns">#! /usr/bin/lnsc -shebang
// @lnsFront: skip   
pub fn __main( argList:&amp;List&lt;str&gt; ):int {
   foreach arg in argList {
      print( arg );
   }
   return 0;
}</code></pre>
</div>
<h2 id="headline-5">
Behavior of __main () function when transcompiled to lua
</h2>
<p>
The following LuneScript code outputs command line options.
</p>
<div class="src src-lns">
<pre><code class="language-lns" data-lang="lns">pub fn __main( argList:&amp;List&lt;str&gt; ) : int {
   foreach arg, index in argList {
      print( index, arg );
   }
   return 0;
}</code></pre>
</div>
<p>
The following is a sample execution result.
</p>
<div class="src src-txt">
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">$ lnsc -shebang mini.lns a b c 
1	mini.lns
2	a
3	b
4	c</code></pre></div>
</div>
<p>
To transcompile this code, run the following command:
</p>
<pre class="example">
lnsc mini.lns save
</pre>
<p>
This will output a mini.lua.
</p>
<p>
When I run this mini.lua, it looks like this:
</p>
<div class="src src-txt">
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">$ lua5.3 mini.lua a b c</code></pre></div>
</div>
<p>
<strong>What this means is that the __main () function has not been called.</strong>
</p>
<p>
If you run lnsc with the -shebang option, it runs the __main () function defined in the .lns file. On the other hand, the transcompiled lua code does not output the code that executes __main (), so this is the behavior.
</p>
<p>
To run __main () in transcompiled lua code, you need one of the following:
</p>
<ul>
<li>
<p>
Create your own code to execute __main ()
</p>
</li>
<li>
<p>
Specify <code class="verbatim">--main</code> option when transcompiling
</p>
</li>
</ul>
<h3 id="headline-6">
<code class="verbatim">--main</code> option
</h3>
<p>
By specifying the <code class="verbatim">--main</code> option when transcompiling, the process to execute the <code class="verbatim">__main()</code> function is output to the specified module.
</p>
<p>
The following is a sample of the <code class="verbatim">--main</code> options.
</p>
<pre class="example">
$ lnsc mini.lns save --main mini
</pre>
<p>
Where <code class="verbatim">--main mini</code>&#39;s mini is the module name that contains __main () to run.
</p>
<p>
This will output code to execute __main () in mini.lua.
</p>
<p>
The following is the execution result of mini.lua generated by specifying <code class="verbatim">--main mini</code>.
</p>
<div class="src src-txt">
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">$ lua5.3 mini.lua a b c
1	mini.lua
2	a
3	b
4	c</code></pre></div>
</div>
<p>
<strong>It should be noted here that the first argument of argList when executed with shebang of lnsc contains the path of .lns, while the first argument of argList after transcompiling to lua is the path of .lua. There is a difference that is included.</strong>
</p>
<div class="edit-meta">

<br></div><nav class="pagination"><a class="nav nav-prev-2" href="https://ifritjp.github.io/documents/en/lunescript/lazyloading/" title="27. Delayed loading"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - 27. Delayed loading</a>
<a class="nav nav-next-2" href="https://ifritjp.github.io/documents/en/lunescript/dir/" title="29. Recommended directory structure for projects that use LuneScript">Next - 29. Recommended directory structure for projects that use LuneScript <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://themes.gohugo.io/hugo-theme-techdoc/">TechDoc</a>. Designed by <a href="https://github.com/thingsym/hugo-theme-techdoc">Thingsym</a>.</p>
</footer>
</main><div class="sidebar">

<nav class="slide-menu">
<ul>
<li class=""><a href="https://ifritjp.github.io/documents">Home</a></li>

<li class="parent has-sub-menu"><a href="https://ifritjp.github.io/documents/en/lunescript/">Making Lua easier with the transcompiler LuneScript !!<span class="mark opened">-</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/tutorial2.setup/"></a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/tutorial3.hello/">02. Hello world</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/crosscompile/">03. Cross-compiling between Lua versions</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/value/">04. Value</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/set/">04.2. Set</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/enum/">05. enum edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/match/">06. match edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/variable/">07. Variables</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/branch/">08. General branch syntax</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/loop/">09. Repeated syntax</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/func/">10. Functions</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/multipleretval/">10.2. Multi-valued return value</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/defaultarg/">10.3. Omission of arguments</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/arg/">10.4. Variadic argument, return value</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/closure/">10.5. Closure</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/nilable/">11. nilable edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/class1/">12. Class Basics</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/class2accessor/">13. accessor edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classinherit/">14. Class inheritance</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classadvertise/">15. Class advertise</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classoverride/">16. Class override</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/interface/">17. Interface</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classmapping/">18. mapping</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/generics/">19. generics edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/nilcond/">20. nil conditional operator edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/import/">21. import / provide</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/require/">22. require / module edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/glue/">22.1. Semi-automatic generation of glue code</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lua/">22.2. Cooperation with Lua</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/make/">23. Build</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/macro/">24. Macro edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/cast/">25. Cast edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/subfile/">26. subfile edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lazyloading/">27. Delayed loading</a></li>
<li class="active"><a href="https://ifritjp.github.io/documents/en/lunescript/shebang_main/">28. shebang and command line arguments</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/dir/">29. Recommended directory structure for projects that use LuneScript</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/go/">@ .1 Transcompile to Go language</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lua_runtime/">@ .1.3 Lua runtime when transcompiled to Go</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/async/">@ .2 Safe asynchronous processing</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/async_old/">@ .2.1 Asynchronous processing O (past information)</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/go_package/">@ 1.2 Package when transcompiling to Go language</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/luago/">@ 3. Collaboration with Lua</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/completion/">A. Let&#39;s have more fun in an exciting development environment</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/onweb/">A. LuneScript running on a web browser</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lnstags/">A. Tag jump by lnstags (source code tag system)</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/recommend/">A. Transcompiler development recommendations</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/reason/">A. Why Lua&#39;s transcompiler LuneScript was developed</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/box/">Box edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/go_study/">Transcompile to Z. Go language (under consideration)</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/test/">X. Importance of self-hosting and test design in quality control of language development</a></li>
</ul>
  
</li>
</ul>
</nav>



<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
