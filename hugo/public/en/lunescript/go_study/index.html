<!DOCTYPE html>
<html lang="ja-jp">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Z. Transcompile to Go language (exploratory stage) - tech</title>
<meta name="generator" content="Hugo 0.109.0">
<link href="https://ifritjp.github.io/documentsindex.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://ifritjp.github.io/documents/en/lunescript/go_study/">
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/theme.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/custom.css">
<script src="https://ifritjp.github.io/documents/js/bundle.js"></script>
<script src="https://ifritjp.github.io/documents/js/lnsSrcRun.js"></script>
<script src="https://ifritjp.github.io/documents/js/highlight_lns.js"></script>
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/highlight_lns.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script><style>
:root {}
</style>
<meta property="og:title" content="Z. Transcompile to Go language (exploratory stage)" />
<meta property="og:description" content="For information on transcompiling to Go language, please refer to the following article. ../go The information here is old, but I&#39;ll keep it for reference. Considering transcompiling from LuneScript to Go language. This is where you record what you are discussing. aim The goals of transcompiling from LuneScript to Go language are as follows. Speeding up LuneScript LuneScript supports the code completion function, but it becomes heavy and inconvenient for" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ifritjp.github.io/documents/en/lunescript/go_study/" /><meta property="article:section" content="LuneScript" />

<meta property="og:site_name" content="tech" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Z. Transcompile to Go language (exploratory stage)"/>
<meta name="twitter:description" content="For information on transcompiling to Go language, please refer to the following article. ../go The information here is old, but I&#39;ll keep it for reference. Considering transcompiling from LuneScript to Go language. This is where you record what you are discussing. aim The goals of transcompiling from LuneScript to Go language are as follows. Speeding up LuneScript LuneScript supports the code completion function, but it becomes heavy and inconvenient for"/>
<meta itemprop="name" content="Z. Transcompile to Go language (exploratory stage)">
<meta itemprop="description" content="For information on transcompiling to Go language, please refer to the following article. ../go The information here is old, but I&#39;ll keep it for reference. Considering transcompiling from LuneScript to Go language. This is where you record what you are discussing. aim The goals of transcompiling from LuneScript to Go language are as follows. Speeding up LuneScript LuneScript supports the code completion function, but it becomes heavy and inconvenient for">

<meta itemprop="wordCount" content="2681">
<meta itemprop="keywords" content="" />
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4708B8S6ES"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4708B8S6ES');
</script>
</head>
<body><div class="container"><header>
<h1>tech</h1>


[<a href="https://ifritjp.github.io/documents/en/">English</a>]

[<a href="https://ifritjp.github.io/documents/">Japanese</a>]

</header>
<div class="global-menu">
<nav>
<ul>
<li><a href="/documents/">Home</a></li>
<li><a href="https://ifritjp.github.io/blog2/public/">blog</a></li>
<li><a href="https://ifritjp.github.io/LuneScript-webFront/lnsc_web_frontend/for_wasm/">LuneScript on Web</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1>Z. Transcompile to Go language (exploratory stage)</h1>

<p>
For information on transcompiling to Go language, please refer to the following article.</p>
<p>
<a href="../go">../go</a></p>
<p>
<strong>The information here is old, but I&#39;ll keep it for reference.</strong></p>
<p>
Considering transcompiling from LuneScript to Go language.</p>
<p>
This is where you record what you are discussing.</p>
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
aim
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>
The goals of transcompiling from LuneScript to Go language are as follows.</p>
<ul>
<li>
<p>Speeding up LuneScript</p>
<ul>
<li>LuneScript supports the code completion function, but it becomes heavy and inconvenient for large-scale code.</li>
<li>Improve the usability of LuneScript&#39;s code completion feature by speeding it up.</li>
</ul>
</li>
<li>
<p>Improved efficiency of LuneScript version upgrade work by speeding up</p>
<ul>
<li>LuneScript&#39;s self-hosted build/test time currently takes less than 2 minutes.</li>
<li>It takes 2 minutes for each change, so I try to speed it up with Go.</li>
<li>We were working on transcompiling to C language, but the implementation of GC in C language did not proceed as expected, so Go, which supports GC at the language level, will be supported first.</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
value
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<table>
<thead>
<tr>
<th>Types in LuneScript</th>
<th>Go types</th>
<th>type in Lns Random for Go</th>
<th class="align-right"></th>
</tr>
</thead>
<tbody>
<tr>
<td>nil, null</td>
<td>interface{}</td>
<td>nil</td>
<td class="align-right"></td>
</tr>
<tr>
<td>int</td>
<td>int</td>
<td>LnsInt (alias)</td>
<td class="align-right"></td>
</tr>
<tr>
<td>real</td>
<td>float64</td>
<td>LnsReal(alias)</td>
<td class="align-right"></td>
</tr>
<tr>
<td>str</td>
<td>string</td>
<td>LnsStr (alias)</td>
<td class="align-right"></td>
</tr>
<tr>
<td>bool</td>
<td>bool</td>
<td>LnsBool(alias)</td>
<td class="align-right"></td>
</tr>
<tr>
<td>List</td>
<td>unique structure</td>
<td>LnsList</td>
<td class="align-right"></td>
</tr>
<tr>
<td>Array</td>
<td>arrangement</td>
<td>LnsArray</td>
<td class="align-right"></td>
</tr>
<tr>
<td>Map</td>
<td>map</td>
<td>LnsMap</td>
<td class="align-right"></td>
</tr>
<tr>
<td>Set</td>
<td>map (put item in key)</td>
<td>LnsSet</td>
<td class="align-right"></td>
</tr>
<tr>
<td>class</td>
<td>Structure</td>
<td></td>
<td class="align-right"></td>
</tr>
<tr>
<td>interface</td>
<td>interface</td>
<td></td>
<td class="align-right"></td>
</tr>
<tr>
<td>form</td>
<td>func</td>
<td>LnsForm</td>
<td class="align-right"></td>
</tr>
<tr>
<td>enum</td>
<td>int/float64/string</td>
<td>LnsEnum</td>
<td class="align-right"></td>
</tr>
<tr>
<td>stem</td>
<td>interface{}</td>
<td>LnsStem</td>
<td class="align-right"></td>
</tr>
<tr>
<td>nilable</td>
<td>interface{}</td>
<td></td>
<td class="align-right"></td>
</tr>
</tbody>
</table>
<div id="outline-container-headline-3" class="outline-3">
<h3 id="headline-3">
Handling int/real
</h3>
<div id="outline-text-headline-3" class="outline-text-3">
<p>
LuneScript int/real is defined using go&#39;s type alias as follows:</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">LnsInt</span> <span class="p">=</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">LnsReal</span> <span class="p">=</span> <span class="kt">float64</span></span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-4" class="outline-3">
<h3 id="headline-4">
Handling nilables
</h3>
<div id="outline-text-headline-4" class="outline-text-3">
<p>
LuneScript&#39;s nilable cannot be treated as the original value as is. However, you can still check for equality. This is the same as go and LuneScript.</p>
</div>
</div>
<div id="outline-container-headline-5" class="outline-3">
<h3 id="headline-5">
Dealing with boolean values
</h3>
<div id="outline-text-headline-5" class="outline-text-3">
<p>
LuneScript is false for nil and false and true otherwise. Since go requires judgment by true/false, prepare a condition conversion function for LuneScript.</p>
</div>
</div>
<div id="outline-container-headline-6" class="outline-3">
<h3 id="headline-6">
Handling and/or
</h3>
<div id="outline-text-headline-6" class="outline-text-3">
<p>
LuneScript&#39;s and/or is not a logical operation, it controls the evaluation of expressions, and the evaluation result is not bool. go evaluates to bool.</p>
</div>
</div>
<div id="outline-container-headline-7" class="outline-3">
<h3 id="headline-7">
Handling of generics
</h3>
<div id="outline-text-headline-7" class="outline-text-3">
<p>
Since go does not have generics, all types of generics are handled with interface{}.</p>
</div>
</div>
<div id="outline-container-headline-8" class="outline-3">
<h3 id="headline-8">
Dealing with Sets
</h3>
<div id="outline-text-headline-8" class="outline-text-3">
<p>
Since go doesn&#39;t have Set, we use Map instead.</p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-9" class="outline-2">
<h2 id="headline-9">
return multiple values
</h2>
<div id="outline-text-headline-9" class="outline-text-2">
<p>
Multi-value returns in go and LuneScript behave differently.</p>
<p>
When <code class="verbatim">hoge()</code> is a multi-value return function that returns x and y, the behavior is as follows.</p>
<table>
<thead>
<tr>
<th>code</th>
<th>LuneScript expansion result</th>
<th>go expansion result</th>
<th class="align-right"></th>
</tr>
</thead>
<tbody>
<tr>
<td>(hoge())</td>
<td>x</td>
<td>x, y</td>
<td class="align-right"></td>
</tr>
<tr>
<td>hoge(), val</td>
<td>x, val</td>
<td>x, y, val</td>
<td class="align-right"></td>
</tr>
</tbody>
</table>
<p>
To realize the above difference, go prepares the following conversion function.</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// 多値返却の先頭 int を返す
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">carInt</span><span class="p">(</span> <span class="nx">multi</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{}</span> <span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="nx">multi</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">panic</span><span class="p">(</span> <span class="s">&#34;nothing&#34;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">multi</span><span class="p">[</span><span class="mi">0</span><span class="p">].(</span><span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// 多値返却の先頭 int! を返す
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">carIntN</span><span class="p">(</span> <span class="nx">multi</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{}</span> <span class="p">)</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="nx">multi</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">multi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">nil</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">multi</span><span class="p">[</span><span class="mi">0</span><span class="p">].(</span><span class="kt">int</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-10" class="outline-2">
<h2 id="headline-10">
classes and inheritance
</h2>
<div id="outline-text-headline-10" class="outline-text-2">
<p>
Go has structs and receivers, but no inheritance.</p>
<p>
LuneScript has inheritance, so we need to implement inheritance in Go.</p>
<p>
Shows how to support the following LuneScript classes in Go.</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
interface IF {
  pub fn sub1():int;
}
class Parent {
   let val1:int;
   pub fn sub1():int {
      return self.val1;
   }
}
class Sub extend Parent {
   let val2:int;
   pub override fn sub1():int {
      return self.val2;
   }
   pub fn sub2():int {
      return self.val2;
   }
}
class SubSub extend Sub {
   let val3:int;
   pub override fn sub1():int {
      return self.val3;
   }
   pub fn sub3():int {
      return self.val3;
   }
}</code></pre>
</div>
<div id="outline-container-headline-11" class="outline-3">
<h3 id="headline-11">
Equivalent code in Go
</h3>
<div id="outline-text-headline-11" class="outline-text-3">
<p>
Show equivalent code in Go</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nx">main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">ParentMtd</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sub1</span> <span class="p">()</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Parent</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">val1</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="nx">FP</span> <span class="nx">ParentMtd</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">ParentDownCast</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ToParent</span><span class="p">()</span> <span class="o">*</span><span class="nx">Parent</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">)</span> <span class="nf">ToParent</span><span class="p">()</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">obj</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">Parent</span><span class="p">)</span> <span class="nf">sub1</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val1</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewParent</span><span class="p">(</span><span class="nx">val1</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">parent</span> <span class="o">:=</span> <span class="nx">Parent</span><span class="p">{</span> <span class="nx">val1</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">parent</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">parent</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">parent</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">SubMtd</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ParentMtd</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sub2</span> <span class="p">()</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Sub</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Parent</span>
</span></span><span class="line"><span class="cl">    <span class="nx">val2</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="nx">FP</span> <span class="nx">SubMtd</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">SubDownCast</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ToSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">Sub</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">)</span> <span class="nf">ToSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">obj</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">Sub</span><span class="p">)</span> <span class="nf">sub1</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val2</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">Sub</span><span class="p">)</span> <span class="nf">sub2</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val2</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">newSub</span><span class="p">(</span><span class="nx">val1</span><span class="p">,</span><span class="nx">val2</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sub</span> <span class="o">:=</span> <span class="nx">Sub</span><span class="p">{</span> <span class="nx">Parent</span><span class="p">{</span> <span class="nx">val1</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">},</span> <span class="nx">val2</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sub</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">sub</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sub</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">sub</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">sub</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">SubSubMtd</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">SubMtd</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sub3</span> <span class="p">()</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">SubSub</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Sub</span>
</span></span><span class="line"><span class="cl">    <span class="nx">val3</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="nx">FP</span> <span class="nx">SubSubMtd</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">SubSubDownCast</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ToSubSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">SubSub</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">)</span> <span class="nf">ToSubSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">obj</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">)</span> <span class="nf">ToSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">obj</span><span class="p">.</span><span class="nx">Sub</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">SubSub</span><span class="p">)</span> <span class="nf">sub1</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val3</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">SubSub</span><span class="p">)</span> <span class="nf">sub2</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">Sub</span><span class="p">.</span><span class="nf">sub2</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">SubSub</span><span class="p">)</span> <span class="nf">sub3</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val3</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">newSubSub</span><span class="p">(</span><span class="nx">val1</span><span class="p">,</span><span class="nx">val2</span><span class="p">,</span><span class="nx">val3</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">subsub</span> <span class="o">:=</span> <span class="nx">SubSub</span><span class="p">{</span> <span class="nx">Sub</span><span class="p">{</span> <span class="nx">Parent</span><span class="p">{</span> <span class="nx">val1</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">},</span> <span class="nx">val2</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">},</span> <span class="nx">val3</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">subsub</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">subsub</span>
</span></span><span class="line"><span class="cl">    <span class="nx">subsub</span><span class="p">.</span><span class="nx">Sub</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">subsub</span>
</span></span><span class="line"><span class="cl">    <span class="nx">subsub</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">subsub</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">subsub</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">testParent</span><span class="p">(</span> <span class="nx">obj</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub1</span><span class="p">()</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">testSub</span><span class="p">(</span> <span class="nx">mess</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">obj</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span> <span class="nx">mess</span><span class="p">,</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub1</span><span class="p">(),</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub2</span><span class="p">()</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">testCast</span><span class="p">(</span> <span class="nx">obj</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cast</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">FP</span><span class="p">.(</span><span class="nx">SubDownCast</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">testSub</span><span class="p">(</span> <span class="s">&#34;cast&#34;</span><span class="p">,</span> <span class="nx">cast</span><span class="p">.</span><span class="nf">ToSub</span><span class="p">()</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span> <span class="s">&#34;cast NG&#34;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">Lns_init</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">subsub</span> <span class="o">:=</span> <span class="nf">newSubSub</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span> <span class="nx">subsub</span><span class="p">.</span><span class="nx">val1</span><span class="p">,</span> <span class="nx">subsub</span><span class="p">.</span><span class="nx">val2</span><span class="p">,</span> <span class="nx">subsub</span><span class="p">.</span><span class="nx">val3</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span> <span class="nx">subsub</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub1</span><span class="p">(),</span> <span class="nx">subsub</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub2</span><span class="p">(),</span> <span class="nx">subsub</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub3</span><span class="p">()</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">testSub</span><span class="p">(</span> <span class="s">&#34;subsub.Sub&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">subsub</span><span class="p">.</span><span class="nx">Sub</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">testParent</span><span class="p">(</span> <span class="o">&amp;</span><span class="nx">subsub</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">testCast</span><span class="p">(</span> <span class="o">&amp;</span><span class="nx">subsub</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">sub</span> <span class="o">:=</span> <span class="nf">newSub</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">testSub</span><span class="p">(</span> <span class="s">&#34;sub&#34;</span><span class="p">,</span> <span class="nx">sub</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">testParent</span><span class="p">(</span> <span class="o">&amp;</span><span class="nx">sub</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">testCast</span><span class="p">(</span> <span class="o">&amp;</span><span class="nx">sub</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">testCast</span><span class="p">(</span> <span class="nf">NewParent</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-12" class="outline-3">
<h3 id="headline-12">
Inheritance implementation method
</h3>
<div id="outline-text-headline-12" class="outline-text-3">
<div id="outline-container-headline-13" class="outline-4">
<h4 id="headline-13">
Parent class
</h4>
<div id="outline-text-headline-13" class="outline-text-4">
<p>
First, we will explain the Parent class.</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Parent {
   let val1:int;
   pub fn sub1():int {
      return self.val1;
   }
}</code></pre>
</div>
<div id="outline-container-headline-14" class="outline-5">
<h5 id="headline-14">
data structure
</h5>
<div id="outline-text-headline-14" class="outline-text-5">
<p>
Define the following structure and interface to represent the Parent class.</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">ParentMtd</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sub1</span> <span class="p">()</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Parent</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">val1</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="nx">FP</span> <span class="nx">ParentMtd</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">ParentDownCast</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ToParent</span><span class="p">()</span> <span class="o">*</span><span class="nx">Parent</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">)</span> <span class="nf">ToParent</span><span class="p">()</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">obj</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<ul>
<li>
<p>The ParentMtd interface is responsible for</p>
<ul>
<li>Define a method in the Parent class</li>
<li>Express the morphism of the Parent class</li>
</ul>
</li>
<li>A Parent struct has a member and a ParentMtd</li>
<li>ParentDownCast is defined per class for downcasting</li>
</ul>
</div>
</div>
<div id="outline-container-headline-15" class="outline-5">
<h5 id="headline-15">
method
</h5>
<div id="outline-text-headline-15" class="outline-text-5">
<p>
Define the following receiver function to represent the method of the Parent class.</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">Parent</span><span class="p">)</span> <span class="nf">sub1</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val1</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-16" class="outline-5">
<h5 id="headline-16">
constructor
</h5>
<div id="outline-text-headline-16" class="outline-text-5">
<p>
Define the following as a constructor of Parent class.</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">NewParent</span><span class="p">(</span><span class="nx">val1</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">super</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Parent</span><span class="p">{</span> <span class="nx">val1</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">super</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="nx">super</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">super</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<p>
This constructor does the following:</p>
<ul>
<li>member initialization</li>
<li>FP settings</li>
</ul>
</div>
</div>
<div id="outline-container-headline-17" class="outline-5">
<h5 id="headline-17">
How to use the Parent class
</h5>
<div id="outline-text-headline-17" class="outline-text-5">
<p>
Parent is used like this:</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">parent</span> <span class="o">:=</span> <span class="nf">NewParent</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub1</span><span class="p">()</span> <span class="p">)</span></span></span></code></pre></div>
</div>
<p>
When calling a method, always call it through the FP interface.</p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-18" class="outline-4">
<h4 id="headline-18">
Sub class
</h4>
<div id="outline-text-headline-18" class="outline-text-4">
<p>
Describe the Sub class.</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: skip
class Sub extend Parent {
   let val2:int;
   pub override fn sub1():int {
      return self.val2;
   }
   pub fn sub2():int {
      return self.val2;
   }
}</code></pre>
</div>
<div id="outline-container-headline-19" class="outline-5">
<h5 id="headline-19">
data structure
</h5>
<div id="outline-text-headline-19" class="outline-text-5">
<p>
Define the following structure and interface to represent the Sub class.</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">SubMtd</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ParentMtd</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sub2</span> <span class="p">()</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Sub</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Parent</span>
</span></span><span class="line"><span class="cl">    <span class="nx">val2</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="nx">FP</span> <span class="nx">SubMtd</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">SubDownCast</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ToSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">Sub</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">)</span> <span class="nf">ToSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">obj</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">)</span> <span class="nf">ToParent</span><span class="p">()</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">obj</span><span class="p">.</span><span class="nx">Parent</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<ul>
<li>
<p>The SubMtd interface declares the methods defined in Sub.</p>
<ul>
<li>Do not include Parent methods</li>
</ul>
</li>
<li>The Sub structure declares the data of the Parent structure and the members defined in Sub.</li>
</ul>
</div>
</div>
<div id="outline-container-headline-20" class="outline-5">
<h5 id="headline-20">
method
</h5>
<div id="outline-text-headline-20" class="outline-text-5">
<p>
Define the following receiver function to represent the method of the Sub class.</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">Sub</span><span class="p">)</span> <span class="nf">sub1</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val2</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">Sub</span><span class="p">)</span> <span class="nf">sub2</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val2</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
</div>
</div>
<div id="outline-container-headline-21" class="outline-5">
<h5 id="headline-21">
constructor
</h5>
<div id="outline-text-headline-21" class="outline-text-5">
<p>
Define the following as a constructor of Sub class.</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">newSub</span><span class="p">(</span><span class="nx">val1</span><span class="p">,</span><span class="nx">val2</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sub</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Sub</span><span class="p">{</span> <span class="nx">Parent</span><span class="p">{</span> <span class="nx">val1</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">},</span> <span class="nx">val2</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sub</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="nx">sub</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sub</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="nx">sub</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">sub</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<p>
This constructor does the following:</p>
<ul>
<li>member initialization</li>
<li>
<p>FP settings</p>
<ul>
<li>FP of super is also set here</li>
<li>Set the FP of this super to &amp;sub instead of &amp;super to achieve polymorphism</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-22" class="outline-4">
<h4 id="headline-22">
SubSub class
</h4>
<div id="outline-text-headline-22" class="outline-text-4">
<p>
Describe the SubSub class.</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: skip
class SubSub extend Sub {
   let val3:int;
   pub override fn sub1():int {
      return self.val3;
   }
   pub fn sub3():int {
      return self.val3;
   }
}</code></pre>
</div>
<div id="outline-container-headline-23" class="outline-5">
<h5 id="headline-23">
data structure
</h5>
<div id="outline-text-headline-23" class="outline-text-5">
<p>
Define the following structure and interface to represent the SubSub class.</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">SubSubMtd</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">SubMtd</span>
</span></span><span class="line"><span class="cl">    <span class="nf">sub3</span> <span class="p">()</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">SubSub</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Sub</span>
</span></span><span class="line"><span class="cl">    <span class="nx">val3</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="nx">FP</span> <span class="nx">SubSubMtd</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">SubSubDownCast</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ToSubSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">SubSub</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">)</span> <span class="nf">ToSubSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">obj</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">)</span> <span class="nf">ToSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">obj</span><span class="p">.</span><span class="nx">Sub</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">)</span> <span class="nf">ToParent</span><span class="p">()</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">obj</span><span class="p">.</span><span class="nx">Parent</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<ul>
<li>
<p>The SubSubMtd interface declares the methods defined by SubSub.</p>
<ul>
<li>Do not include Sub methods</li>
</ul>
</li>
<li>The SubSub structure declares the data of the Sub structure and the members defined by SubSub.</li>
</ul>
</div>
</div>
<div id="outline-container-headline-24" class="outline-5">
<h5 id="headline-24">
method
</h5>
<div id="outline-text-headline-24" class="outline-text-5">
<p>
Define the following receiver function to represent the methods of the SubSub class.</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">SubSub</span><span class="p">)</span> <span class="nf">sub1</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val3</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">SubSub</span><span class="p">)</span> <span class="nf">sub2</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">Sub</span><span class="p">.</span><span class="nf">sub2</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">SubSub</span><span class="p">)</span> <span class="nf">sub3</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val3</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<div id="outline-container-headline-25" class="outline-6">
<h6 id="headline-25">
Method definition without overriding
</h6>
<div id="outline-text-headline-25" class="outline-text-6">
<p>
It should be noted that the sub2() method calls <code class="verbatim">self.Sub.sub2()</code>.</p>
<p>
The SubSub class does not override the sub2 method. In other words, the sub2 method of SubSub uses the method of the Sub class. So we are calling the Sub.sub2 method.</p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-26" class="outline-5">
<h5 id="headline-26">
constructor
</h5>
<div id="outline-text-headline-26" class="outline-text-5">
<p>
Define the following as a constructor of SubSub class.</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">newSubSub</span><span class="p">(</span><span class="nx">val1</span><span class="p">,</span><span class="nx">val2</span><span class="p">,</span><span class="nx">val3</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">subsub</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">SubSub</span><span class="p">{</span> <span class="nx">Sub</span><span class="p">{</span> <span class="nx">Parent</span><span class="p">{</span> <span class="nx">val1</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">},</span> <span class="nx">val2</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">},</span> <span class="nx">val3</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">subsub</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="nx">subsub</span>
</span></span><span class="line"><span class="cl">    <span class="nx">subsub</span><span class="p">.</span><span class="nx">Sub</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="nx">subsub</span>
</span></span><span class="line"><span class="cl">    <span class="nx">subsub</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="nx">subsub</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">subsub</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<p>
This constructor does the following:</p>
<ul>
<li>member initialization</li>
<li>
<p>FP settings</p>
<ul>
<li>Also set the FP of Parent and Sub here</li>
<li>Implement polymorphism by setting &amp;subsub to FP of Parent and Sub</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-27" class="outline-4">
<h4 id="headline-27">
IF interface
</h4>
<div id="outline-text-headline-27" class="outline-text-4">
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
interface IF {
  pub fn sub1():int;
}</code></pre>
</div>
<div id="outline-container-headline-28" class="outline-5">
<h5 id="headline-28">
data structure
</h5>
<div id="outline-text-headline-28" class="outline-text-5">
<p>
LuneScript&#39;s interface uses Go&#39;s interface as it is.</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">interface</span> <span class="nx">IF</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">pub</span> <span class="nx">fn</span> <span class="nf">sub1</span><span class="p">():</span><span class="kt">int</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-29" class="outline-4">
<h4 id="headline-29">
method call
</h4>
<div id="outline-text-headline-29" class="outline-text-4">
<p>
To call a method of the Parent class, do the following:</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">test</span><span class="p">(</span><span class="nx">parent</span> <span class="o">*</span><span class="nx">Parent</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">print</span><span class="p">(</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub1</span><span class="p">()</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nb">print</span><span class="p">(</span> <span class="nx">parent</span><span class="p">.</span><span class="nf">sub1</span><span class="p">()</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<div id="outline-container-headline-30" class="outline-5">
<h5 id="headline-30">
Difference between parent.FP.sub1() and parent.sub1()
</h5>
<div id="outline-text-headline-30" class="outline-text-5">
<p>
There are two patterns for method calls:</p>
<ul>
<li>
<p>parent.FP.sub1()</p>
<ul>
<li>Method calls that support polymorphism</li>
</ul>
</li>
<li>
<p>parent.sub1()</p>
<ul>
<li>
<p>Method call defined in Parent class</p>
<ul>
<li>No support for polymorphism</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-headline-31" class="outline-5">
<h5 id="headline-31">
overhead
</h5>
<div id="outline-text-headline-31" class="outline-text-5">
<ul>
<li>Method calls that support polymorphism have a large overhead.</li>
<li>Method calls that support polymorphism should be limited to cases where polymorphism is necessary.</li>
<li>
<p>Whether or not polymorphism is required is currently not defined in LuneScript.</p>
<ul>
<li>It is necessary to introduce final declarations for classes and methods so that polymorphism can be clearly stated.</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-32" class="outline-4">
<h4 id="headline-32">
up-cast / down-cast
</h4>
<div id="outline-text-headline-32" class="outline-text-4">
<ul>
<li>
<p>up-cast is achieved by accessing the embedded pointer</p>
<ul>
<li>up-casting to an interface uses the interface type held by the object</li>
</ul>
</li>
<li>
<p>A down-cast implements an interface with a type assertion.</p>
<ul>
<li>Define a DownCast interface for each class, cast to that interface, and then execute the cast function to the target class</li>
</ul>
</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">ifObj</span> <span class="nx">IF</span> <span class="p">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">FP</span> <span class="c1">// インタフェースをセットする
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">parent</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">obj</span><span class="p">.</span><span class="nx">Parent</span> <span class="c1">// アップキャスト
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">(</span><span class="nx">parent</span><span class="p">.</span><span class="nx">FP</span><span class="p">.(</span><span class="nx">SubDownCast</span><span class="p">)).</span><span class="nf">ToSub</span><span class="p">()</span> <span class="c1">// obj を Sub にダウンキャストする
</span></span></span></code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-33" class="outline-3">
<h3 id="headline-33">
Summary of Classes
</h3>
<div id="outline-text-headline-33" class="outline-text-3">
<ul>
<li>
<p>Declare an interface that defines the methods of the class</p>
<ul>
<li>Embed the interface of the method defined in the Super class</li>
</ul>
</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">TestMtd</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">SuperMtd</span>
</span></span><span class="line"><span class="cl">    <span class="nf">method</span><span class="p">()</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<ul>
<li>
<p>Declare a struct to hold the members of the class and the above interface</p>
<ul>
<li>Inheritance embeds the inheriting type</li>
</ul>
</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">Test</span> <span class="kd">struct</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">Super</span>
</span></span><span class="line"><span class="cl">    <span class="nx">val</span> <span class="kt">int</span>
</span></span><span class="line"><span class="cl">    <span class="nx">FP</span> <span class="nx">TestMtd</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<ul>
<li>Define interface for downcast</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">type</span> <span class="nx">TestDownCast</span> <span class="kd">interface</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">ToTest</span><span class="p">()</span> <span class="o">*</span><span class="nx">Test</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<ul>
<li>
<p>Define a method for downcasting</p>
<ul>
<li>This method declares everything for the Super class</li>
</ul>
</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">SubSub</span><span class="p">)</span> <span class="nf">ToSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">obj</span><span class="p">.</span><span class="nx">Sub</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<ul>
<li>
<p>Declare receivers that define the behavior of the methods of the class</p>
<ul>
<li>Declare the receiver including the methods of the Super class</li>
<li>A non-overridden function calls the method of the struct that defines it</li>
</ul>
</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">Test</span><span class="p">)</span> <span class="nf">method</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">super</span><span class="p">.</span><span class="nf">method</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<ul>
<li>
<p>Initialize members and interface FP in the constructor</p>
<ul>
<li>interface initializes including the interface FP of the Super class</li>
</ul>
</li>
<li>
<p>Method calls are called via interface FP</p>
<ul>
<li>Method calls without polymorphism call the struct&#39;s methods directly</li>
</ul>
</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="nx">obj</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">method</span><span class="p">()</span> <span class="c1">// ポリモーフィズム有効
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">obj</span><span class="p">.</span><span class="nf">method</span><span class="p">()</span>    <span class="c1">// ポリモーフィズム無効
</span></span></span></code></pre></div>
</div>
<ul>
<li>
<p>up-casting is accomplished by accessing the member&#39;s Super class pointer</p>
<ul>
<li>up-casting to an interface uses the interface type held by the object</li>
</ul>
</li>
<li>down-cast implements an interface with a type assertion and an interface for downcasting.</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">ifObj</span> <span class="nx">IF</span> <span class="p">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">FP</span> <span class="c1">// インタフェースをセットする
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">super</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">obj</span><span class="p">.</span><span class="nx">super</span> <span class="c1">// アップキャスト
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">(</span><span class="nx">parent</span><span class="p">.</span><span class="nx">FP</span><span class="p">.(</span><span class="nx">SubDownCast</span><span class="p">)).</span><span class="nf">ToSub</span><span class="p">()</span> <span class="c1">// obj を Sub にダウンキャストする
</span></span></span></code></pre></div>
</div>
<ul>
<li>
<p>The interface uses Go&#39;s interface as it is</p>
<ul>
<li>Use interface FP when up-casting from a class object to an interface</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-34" class="outline-2">
<h2 id="headline-34">
symbol name
</h2>
<div id="outline-text-headline-34" class="outline-text-2">
<p>
Symbol names in LuneScript and go differ significantly in the following ways.</p>
<ul>
<li>
<p>namespace</p>
<ul>
<li>LuneScript is in the same file (module)</li>
<li>go is in the same directory (package)</li>
</ul>
</li>
<li>
<p>Public/private control method</p>
<ul>
<li>LuneScript is controlled by pub/pro etc.</li>
<li>go controls the case of the first letter of a symbol</li>
</ul>
</li>
</ul>
<p>This difference causes the following problems:</p>
<ul>
<li>When defining a symbol sym with the same name in different files FileA.lns and FileB.lns in LuneScript, when converting this to go, if you define a symbol sym with the same name in FileA.go and FileB.go with the same configuration , the symbol sym will result in a duplicate definition error.</li>
<li>
<p>Symbols defined publicly in lowercase in LuneScript become private in go.</p>
<ul>
<li>Symbols defined privately in uppercase in LuneScript are public in go.</li>
</ul>
</li>
</ul>
<p>To work around this problem, handle symbol names as follows:</p>
<p>
Add the file name to the beginning of the symbol of the function or class that is subject to public/private control. Add G (G for GLOBAL) if it is public, and l (l for local) if it is private.</p>
<p>
In other words, if you convert the following LuneScript source to go,</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
fn func() {
}
pub class Class {
   let val1:int;
   pub let val2:int;
}</code></pre>
</div>
<p>
The relationship between LuneScript and go symbols is as follows.</p>
<table>
<thead>
<tr>
<th>public/private</th>
<th>lns</th>
<th>go</th>
<th class="align-right"></th>
</tr>
</thead>
<tbody>
<tr>
<td>private</td>
<td>func</td>
<td>lfile_func</td>
<td class="align-right"></td>
</tr>
<tr>
<td>Release</td>
<td>Class</td>
<td>Gfile_Class</td>
<td class="align-right"></td>
</tr>
<tr>
<td>private</td>
<td>val1</td>
<td>lval1</td>
<td class="align-right"></td>
</tr>
<tr>
<td>Release</td>
<td>val2</td>
<td>Gval2</td>
<td class="align-right"></td>
</tr>
</tbody>
</table>
<p>
Arguments and local variables are basically converted as they are because there is no difference in scope between LuneScript and go.</p>
</div>
</div>
<div id="outline-container-headline-35" class="outline-2">
<h2 id="headline-35">
Lua VM
</h2>
<div id="outline-text-headline-35" class="outline-text-2">
<p>
In the current LuneScript, Lua VM is used during Macro expansion. There are two ways to use the Lua VM with Go:</p>
<ul>
<li>Use gopher-lua, a port of Lua to Go</li>
<li>use liblua</li>
</ul>
<p>Using gopher-lua makes dealing with the Lua VM easier, but it has the following limitations:</p>
<ul>
<li>Lua VM version becomes Lua5.1</li>
<li>
<p>Slow compared to liblua</p>
<ul>
<li>
<p>According to the information on the official Wiki (&lt;<a href="https://github.com/yuin/gopher-lua/wiki/Benchmarks">https://github.com/yuin/gopher-lua/wiki/Benchmarks</a>&gt;), the execution time of fib(35) is next.</p>
<dl>
<dt>
lua5.1.4
</dt>
<dd>1.71sec</dd>
<dt>
Gopherlua
</dt>
<dd>5.40sec</dd>
</dl>
</li>
</ul>
</li>
</ul>
<p>From the above, the LuneScript transcompiler uses liblua.</p>
<div id="outline-container-headline-36" class="outline-3">
<h3 id="headline-36">
cgo
</h3>
<div id="outline-text-headline-36" class="outline-text-3">
<p>
Use cgo to use liblua from Go.</p>
<p>
cgo is a package for calling C language libraries from Go.</p>
<p>
The C code written in the comment before import &#34;C&#34; is parsed and expanded into a C package so that it can be accessed by Go, like this:</p>
<div class="src src-go">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// #include &lt;stdlib.h&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">// #cgo CFLAGS: -I/usr/include/lua
</span></span></span><span class="line"><span class="cl"><span class="c1">// #cgo LDFLAGS: -ldl -lm -llua
</span></span></span><span class="line"><span class="cl"><span class="c1">// #include &lt;lauxlib.h&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">// #include &lt;lualib.h&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kn">import</span> <span class="s">&#34;C&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="s">&#34;unsafe&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// lua のコードを実行する
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">func</span> <span class="nf">lua_runScript</span><span class="p">(</span> <span class="nx">script</span> <span class="kt">string</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">vm</span> <span class="o">*</span> <span class="nx">C</span><span class="p">.</span><span class="nx">lua_State</span> <span class="p">=</span> <span class="nx">C</span><span class="p">.</span><span class="nf">luaL_newstate</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nx">vm</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">defer</span> <span class="nx">C</span><span class="p">.</span><span class="nf">lua_close</span><span class="p">(</span> <span class="nx">vm</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nx">C</span><span class="p">.</span><span class="nf">luaL_openlibs</span><span class="p">(</span> <span class="nx">vm</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">block</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nf">CString</span><span class="p">(</span> <span class="nx">script</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">defer</span> <span class="nx">C</span><span class="p">.</span><span class="nf">free</span><span class="p">(</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span> <span class="nx">block</span> <span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nx">C</span><span class="p">.</span><span class="nf">luaL_loadstring</span><span class="p">(</span> <span class="nx">vm</span><span class="p">,</span> <span class="nx">block</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">C</span><span class="p">.</span><span class="nf">lua_pcallk</span><span class="p">(</span> <span class="nx">vm</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">C</span><span class="p">.</span><span class="nx">LUA_MULTRET</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nf">lua_runScript</span><span class="p">(</span> <span class="s">&#34;print( &#39;hello world&#39; )&#34;</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<p>
<strong>Since cgo does not support #define macro functions, functions with macro definitions such as the following must be expanded and processed by yourself.</strong></p>
<div class="src src-c">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#define luaL_dostring(L, s) \
</span></span></span><span class="line"><span class="cl"><span class="cp">	(luaL_loadstring(L, s) || lua_pcall(L, 0, LUA_MULTRET, 0))</span></span></span></code></pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="edit-meta">

<br></div><nav class="pagination"><a class="nav nav-prev-2" href="https://ifritjp.github.io/documents/en/lunescript/design-3/" title="Y.3 LuneScript Development (Scopes and Symbols)"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - Y.3 LuneScript Development (Scopes and Symbols)</a>
<a class="nav nav-next-2" href="https://ifritjp.github.io/documents/en/lunescript/tutorial2.setup/" title="01. Introduction">Next - 01. Introduction <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://themes.gohugo.io/hugo-theme-techdoc/">TechDoc</a>. Designed by <a href="https://github.com/thingsym/hugo-theme-techdoc">Thingsym</a>.</p>
</footer>
</main><div class="sidebar">

<nav class="slide-menu">
<ul>
<li class=""><a href="https://ifritjp.github.io/documents">Home</a></li>

<li class="parent has-sub-menu"><a href="https://ifritjp.github.io/documents/en/lunescript/">Easier Lua development with the transcompiler LuneScript!!<span class="mark opened">-</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/tutorial2.setup/">01. Introduction</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/tutorial3.hello/">02. Hello world</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/crosscompile/">03. Cross-compiling between Lua versions</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/value/">04. Values</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/set/">04.2. Set</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/tuple/">04.3 Tuples</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/enum/">05. enum</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/match/">06. match</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/variable/">07. Variables</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/branch/">08. General branch syntax</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/loop/">09. Repetition Syntax</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/func/">10. Functions</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/multipleretval/">10.2. Multi-value return values</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/defaultarg/">10.3. Omitting Arguments</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/arg/">10.4. Variadic Arguments and Return Values</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/closure/">10.5. Closures</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/error/">10.6. Error handling</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/nilable/">11. nilable</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/class1/">12. Class basics</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/class2accessor/">13. accessor</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classinherit/">14. Class Inheritance</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classadvertise/">15. Class advertise</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classoverride/">16. Class override</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/interface/">17. Interface</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classmapping/">18. mapping</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/generics/">19. generics</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/generics-go/">19.2. generics (two collection types)</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/nilcond/">20. nil conditional operator</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/import/">21. import/provide</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/require/">22. require/module</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/glue/">22.1. Semi-automatic generation of glue code</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lua/">22.2. Linking with Lua</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/make/">23. Build</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/macro/">24. Macro</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/cast/">25. Cast</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/subfile/">26. subfile</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lazyloading/">27. Lazy Loading</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/shebang_main/">28. shebang and command line arguments</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/dir/">29. Recommended directory structure for projects using LuneScript</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/go/">80. Transcompiling to Go Language</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/go_package/">80.2 Packages when transpiling to Go</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/go_wasm/">80.4 WebAssembly support for LuneScript</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/async/">81. Safe Asynchronous Processing</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/async_old/">81.1 Asynchronous processing (past information)</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/luago/">82. Linking with Lua</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/ebnf/">A. BNF</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/onweb/">A. LuneScript running on a web browser</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/reason/">A. Reason for developing Lua transcompiler LuneScript</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/recommend/">A. Recommendations for transcompiler development</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lnstags/">A. Tag jumping with lnstags (source code tagging system)</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/completion/">A.Let&#39;s have more fun in a modern development environment</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/box/">Box edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lua_runtime/">Lua runtime when transpiling to 80.3 Go</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/test/">X. The Importance of Self-Hosting and Test Design in Language Development Quality Control</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/design/">Y.1 How to develop LuneScript</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/design-2/">Y.2 Development of LuneScript (type information management)</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/design-3/">Y.3 LuneScript Development (Scopes and Symbols)</a></li>
<li class="active"><a href="https://ifritjp.github.io/documents/en/lunescript/go_study/">Z. Transcompile to Go language (exploratory stage)</a></li>
</ul>
  
</li>
</ul>
</nav>



<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
