<!DOCTYPE html>
<html lang="ja-jp">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Transcompile to Z. Go language (under consideration) - tech</title>
<meta name="generator" content="Hugo 0.68.3" />
<link href="https://ifritjp.github.io/documentsindex.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://ifritjp.github.io/documents/en/lunescript/go_study/">
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/theme.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/custom.css">
<script src="https://ifritjp.github.io/documents/js/bundle.js"></script>
<script src="https://ifritjp.github.io/documents/js/lnsSrcRun.js"></script>
<script src="https://ifritjp.github.io/documents/js/highlight_lns.js"></script>
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/highlight_lns.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-120218599-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-120218599-2');
</script>
<style>
:root {}
</style>
<meta property="og:title" content="Transcompile to Z. Go language (under consideration)" />
<meta property="og:description" content="For transcompiling support for Go language, refer to the following article. ../go The information here is out of date, but I&#39;ll leave it for reference only. Considering transcompiling from LuneScript to Go language. Here, the content under consideration is recorded. aim The aim of transcompiling from LuneScript to the Go language is as follows. Speed up LuneScript LuneScript supports code completion, but large code is heavy and unusable. By speeding" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ifritjp.github.io/documents/en/lunescript/go_study/" />
<meta property="og:site_name" content="tech" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Transcompile to Z. Go language (under consideration)"/>
<meta name="twitter:description" content="For transcompiling support for Go language, refer to the following article. ../go The information here is out of date, but I&#39;ll leave it for reference only. Considering transcompiling from LuneScript to Go language. Here, the content under consideration is recorded. aim The aim of transcompiling from LuneScript to the Go language is as follows. Speed up LuneScript LuneScript supports code completion, but large code is heavy and unusable. By speeding"/>
<meta itemprop="name" content="Transcompile to Z. Go language (under consideration)">
<meta itemprop="description" content="For transcompiling support for Go language, refer to the following article. ../go The information here is out of date, but I&#39;ll leave it for reference only. Considering transcompiling from LuneScript to Go language. Here, the content under consideration is recorded. aim The aim of transcompiling from LuneScript to the Go language is as follows. Speed up LuneScript LuneScript supports code completion, but large code is heavy and unusable. By speeding">

<meta itemprop="wordCount" content="2719">



<meta itemprop="keywords" content="" /></head>
<body><div class="container"><header>
<h1>tech</h1>


[<a href="https://ifritjp.github.io/documents/en/">English</a>]

[<a href="https://ifritjp.github.io/documents/">Japanese</a>]

</header>
<div class="global-menu">
<nav>
<ul>
<li><a href="/documents/">Home</a></li>
<li><a href="https://ifritjp.github.io/blog2/public/">blog</a></li>
<li><a href="https://ifritjp.github.io/LuneScript-webFront/contents/">LuneScript on Web</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1>Transcompile to Z. Go language (under consideration)</h1>

<p>
For transcompiling support for Go language, refer to the following article.
</p>
<p>
<a href="../go">../go</a>
</p>
<p>
<strong>The information here is out of date, but I&#39;ll leave it for reference only.</strong>
</p>
<p>
Considering transcompiling from LuneScript to Go language.
</p>
<p>
Here, the content under consideration is recorded.
</p>
<h2 id="headline-1">
aim
</h2>
<p>
The aim of transcompiling from LuneScript to the Go language is as follows.
</p>
<ul>
<li>
<p>
Speed up LuneScript
</p>
<ul>
<li>
<p>
LuneScript supports code completion, but large code is heavy and unusable.
</p>
</li>
<li>
<p>
By speeding up, the usability of LuneScript&#39;s code completion function will be improved.
</p>
</li>
</ul>
</li>
<li>
<p>
Upgrade work efficiency of LuneScript itself by speeding up
</p>
<ul>
<li>
<p>
LuneScript&#39;s self-hosted build and test time is currently less than 2 minutes.
</p>
</li>
<li>
<p>
It&#39;s painful to take 2 minutes for each change, so go for speed.
</p>
</li>
<li>
<p>
We were working on transcompiling to C, but the GC implementation in C didn&#39;t go as planned, so we&#39;ll go ahead with Go, which supports GC at the language level.
</p>
</li>
</ul>
</li>
</ul>
<h2 id="headline-2">
value
</h2>
<table>
<thead>
<tr>
<th>LuneScript type</th>
<th>Go type</th>
<th>Type in Lns lantern for Go</th>
<th class="align-right"></th>
</tr>
</thead>
<tbody>
<tr>
<td>nil, null</td>
<td>interface{}</td>
<td>nil</td>
<td class="align-right"></td>
</tr>
<tr>
<td>int</td>
<td>int</td>
<td>LnsInt (alias)</td>
<td class="align-right"></td>
</tr>
<tr>
<td>real</td>
<td>float64</td>
<td>LnsReal(alias)</td>
<td class="align-right"></td>
</tr>
<tr>
<td>str</td>
<td>string</td>
<td>LnsStr (alias)</td>
<td class="align-right"></td>
</tr>
<tr>
<td>bool</td>
<td>bool</td>
<td>LnsBool(alias)</td>
<td class="align-right"></td>
</tr>
<tr>
<td>List</td>
<td>Unique structure</td>
<td>LnsList</td>
<td class="align-right"></td>
</tr>
<tr>
<td>Array</td>
<td>arrangement</td>
<td>LnsArray</td>
<td class="align-right"></td>
</tr>
<tr>
<td>Map</td>
<td>map</td>
<td>LnsMap</td>
<td class="align-right"></td>
</tr>
<tr>
<td>Set</td>
<td>map (put item in key)</td>
<td>LnsSet</td>
<td class="align-right"></td>
</tr>
<tr>
<td>class</td>
<td>Structure</td>
<td></td>
<td class="align-right"></td>
</tr>
<tr>
<td>interface</td>
<td>interface</td>
<td></td>
<td class="align-right"></td>
</tr>
<tr>
<td>form</td>
<td>func</td>
<td>LnsForm</td>
<td class="align-right"></td>
</tr>
<tr>
<td>enum</td>
<td>int/float64/string</td>
<td>LnsEnum</td>
<td class="align-right"></td>
</tr>
<tr>
<td>stem</td>
<td>interface{}</td>
<td>LnsStem</td>
<td class="align-right"></td>
</tr>
<tr>
<td>nilable</td>
<td>interface{}</td>
<td></td>
<td class="align-right"></td>
</tr>
</tbody>
</table>
<h3 id="headline-3">
Handling of int / real
</h3>
<p>
LuneScript int / real is defined using go&#39;s type alias as follows:
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">LnsInt</span> <span class="p">=</span> <span class="kt">int</span>
<span class="kd">type</span> <span class="nx">LnsReal</span> <span class="p">=</span> <span class="kt">float64</span></code></pre></div>
</div>
<h3 id="headline-4">
Handling of nilable
</h3>
<p>
LuneScript nilable cannot be treated as the original value as it is. However, you can check if they are equal. This is the same as go and LuneScript.
</p>
<h3 id="headline-5">
Handling of false values
</h3>
<p>
LuneScript has nil and false false, otherwise true. Since go needs to be judged by true / false, prepare a conditional conversion function for LuneScript.
</p>
<h3 id="headline-6">
Handling of and / or
</h3>
<p>
LuneScript&#39;s and / or is not a logical operation, it controls the evaluation of expressions, and the evaluation result is not bool. The evaluation result of go is bool.
</p>
<h3 id="headline-7">
Handling of generics
</h3>
<p>
Since go does not have Generics, all Generics types are handled by interface {}.
</p>
<h3 id="headline-8">
Handling of Set
</h3>
<p>
Since go does not have Set, Map is used instead.
</p>
<h2 id="headline-9">
Multi-value return
</h2>
<p>
Multi-valued return of go and LuneScript behaves differently.
</p>
<p>
When <code class="verbatim">hoge()</code> is a multi-valued return function that returns x and y, the actions are as follows.
</p>
<table>
<thead>
<tr>
<th>code</th>
<th>LuneScript deployment result</th>
<th>go deployment result</th>
<th class="align-right"></th>
</tr>
</thead>
<tbody>
<tr>
<td>(hoge())</td>
<td>x</td>
<td>x, y</td>
<td class="align-right"></td>
</tr>
<tr>
<td>hoge(), val</td>
<td>x, val</td>
<td>x, y, val</td>
<td class="align-right"></td>
</tr>
</tbody>
</table>
<p>
To realize the above difference, go prepares the following conversion function.
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// 多値返却の先頭 int を返す
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">carInt</span><span class="p">(</span> <span class="nx">multi</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{}</span> <span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="nx">multi</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nb">panic</span><span class="p">(</span> <span class="s">&#34;nothing&#34;</span> <span class="p">)</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">multi</span><span class="p">[</span><span class="mi">0</span><span class="p">].(</span><span class="kt">int</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// 多値返却の先頭 int! を返す
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">carIntN</span><span class="p">(</span> <span class="nx">multi</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{}</span> <span class="p">)</span> <span class="kd">interface</span><span class="p">{}</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="nx">multi</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nx">multi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">multi</span><span class="p">[</span><span class="mi">0</span><span class="p">].(</span><span class="kt">int</span><span class="p">)</span>
<span class="p">}</span></code></pre></div>
</div>
<h2 id="headline-10">
Classes and inheritance
</h2>
<p>
Go has structs and receivers, but no inheritance.
</p>
<p>
LuneScript has inheritance, so you need to implement inheritance in Go.
</p>
<p>
Here&#39;s how to support the following LuneScript class in Go.
</p>
<div class="src src-lns">
<pre><code class="language-lns" data-lang="lns">// @lnsFront: ok
interface IF {
  pub fn sub1():int;
}
class Parent {
   let val1:int;
   pub fn sub1():int {
      return self.val1;
   }
}
class Sub extend Parent {
   let val2:int;
   pub override fn sub1():int {
      return self.val2;
   }
   pub fn sub2():int {
      return self.val2;
   }
}
class SubSub extend Sub {
   let val3:int;
   pub override fn sub1():int {
      return self.val3;
   }
   pub fn sub3():int {
      return self.val3;
   }
}</code></pre>
</div>
<h3 id="headline-11">
Equivalent code by Go
</h3>
<p>
Show the equivalent code by Go
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>

<span class="kd">type</span> <span class="nx">ParentMtd</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nf">sub1</span> <span class="p">()</span> <span class="kt">int</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">Parent</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">val1</span> <span class="kt">int</span>
    <span class="nx">FP</span> <span class="nx">ParentMtd</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">ParentDownCast</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nf">ToParent</span><span class="p">()</span> <span class="o">*</span><span class="nx">Parent</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">)</span> <span class="nf">ToParent</span><span class="p">()</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">obj</span>
<span class="p">}</span>


<span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">Parent</span><span class="p">)</span> <span class="nf">sub1</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val1</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewParent</span><span class="p">(</span><span class="nx">val1</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">{</span>
    <span class="nx">parent</span> <span class="o">:=</span> <span class="nx">Parent</span><span class="p">{</span> <span class="nx">val1</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">}</span>
    <span class="nx">parent</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">parent</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">parent</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">SubMtd</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nx">ParentMtd</span>
    <span class="nf">sub2</span> <span class="p">()</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Sub</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Parent</span>
    <span class="nx">val2</span> <span class="kt">int</span>
    <span class="nx">FP</span> <span class="nx">SubMtd</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">SubDownCast</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nf">ToSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">Sub</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">)</span> <span class="nf">ToSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">obj</span>
<span class="p">}</span>


<span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">Sub</span><span class="p">)</span> <span class="nf">sub1</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val2</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">Sub</span><span class="p">)</span> <span class="nf">sub2</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val2</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">newSub</span><span class="p">(</span><span class="nx">val1</span><span class="p">,</span><span class="nx">val2</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">{</span>
    <span class="nx">sub</span> <span class="o">:=</span> <span class="nx">Sub</span><span class="p">{</span> <span class="nx">Parent</span><span class="p">{</span> <span class="nx">val1</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">},</span> <span class="nx">val2</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">}</span>
    <span class="nx">sub</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">sub</span>
    <span class="nx">sub</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">sub</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">sub</span>
<span class="p">}</span>


<span class="kd">type</span> <span class="nx">SubSubMtd</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nx">SubMtd</span>
    <span class="nf">sub3</span> <span class="p">()</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">SubSub</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Sub</span>
    <span class="nx">val3</span> <span class="kt">int</span>
    <span class="nx">FP</span> <span class="nx">SubSubMtd</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">SubSubDownCast</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nf">ToSubSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">SubSub</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">)</span> <span class="nf">ToSubSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">obj</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">)</span> <span class="nf">ToSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">obj</span><span class="p">.</span><span class="nx">Sub</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">SubSub</span><span class="p">)</span> <span class="nf">sub1</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val3</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">SubSub</span><span class="p">)</span> <span class="nf">sub2</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">Sub</span><span class="p">.</span><span class="nf">sub2</span><span class="p">()</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">SubSub</span><span class="p">)</span> <span class="nf">sub3</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val3</span>
<span class="p">}</span>


<span class="kd">func</span> <span class="nf">newSubSub</span><span class="p">(</span><span class="nx">val1</span><span class="p">,</span><span class="nx">val2</span><span class="p">,</span><span class="nx">val3</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">{</span>
    <span class="nx">subsub</span> <span class="o">:=</span> <span class="nx">SubSub</span><span class="p">{</span> <span class="nx">Sub</span><span class="p">{</span> <span class="nx">Parent</span><span class="p">{</span> <span class="nx">val1</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">},</span> <span class="nx">val2</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">},</span> <span class="nx">val3</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">}</span>
    <span class="nx">subsub</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">subsub</span>
    <span class="nx">subsub</span><span class="p">.</span><span class="nx">Sub</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">subsub</span>
    <span class="nx">subsub</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">subsub</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">subsub</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">testParent</span><span class="p">(</span> <span class="nx">obj</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub1</span><span class="p">()</span> <span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">testSub</span><span class="p">(</span> <span class="nx">mess</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">obj</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span> <span class="nx">mess</span><span class="p">,</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub1</span><span class="p">(),</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub2</span><span class="p">()</span> <span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">testCast</span><span class="p">(</span> <span class="nx">obj</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nx">cast</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">FP</span><span class="p">.(</span><span class="nx">SubDownCast</span><span class="p">)</span>
    <span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span>
        <span class="nf">testSub</span><span class="p">(</span> <span class="s">&#34;cast&#34;</span><span class="p">,</span> <span class="nx">cast</span><span class="p">.</span><span class="nf">ToSub</span><span class="p">()</span> <span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span> <span class="s">&#34;cast NG&#34;</span> <span class="p">)</span>
    <span class="p">}</span>
    
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">Lns_init</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">subsub</span> <span class="o">:=</span> <span class="nf">newSubSub</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span> <span class="nx">subsub</span><span class="p">.</span><span class="nx">val1</span><span class="p">,</span> <span class="nx">subsub</span><span class="p">.</span><span class="nx">val2</span><span class="p">,</span> <span class="nx">subsub</span><span class="p">.</span><span class="nx">val3</span> <span class="p">)</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span> <span class="nx">subsub</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub1</span><span class="p">(),</span> <span class="nx">subsub</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub2</span><span class="p">(),</span> <span class="nx">subsub</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub3</span><span class="p">()</span> <span class="p">)</span>
    <span class="nf">testSub</span><span class="p">(</span> <span class="s">&#34;subsub.Sub&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">subsub</span><span class="p">.</span><span class="nx">Sub</span> <span class="p">)</span>
    <span class="nf">testParent</span><span class="p">(</span> <span class="o">&amp;</span><span class="nx">subsub</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">)</span>
    <span class="nf">testCast</span><span class="p">(</span> <span class="o">&amp;</span><span class="nx">subsub</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">)</span>

    <span class="nx">sub</span> <span class="o">:=</span> <span class="nf">newSub</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span>
    <span class="nf">testSub</span><span class="p">(</span> <span class="s">&#34;sub&#34;</span><span class="p">,</span> <span class="nx">sub</span> <span class="p">)</span>
    <span class="nf">testParent</span><span class="p">(</span> <span class="o">&amp;</span><span class="nx">sub</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">)</span>
    <span class="nf">testCast</span><span class="p">(</span> <span class="o">&amp;</span><span class="nx">sub</span><span class="p">.</span><span class="nx">Parent</span> <span class="p">)</span>

    <span class="nf">testCast</span><span class="p">(</span> <span class="nf">NewParent</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">)</span>
<span class="p">}</span></code></pre></div>
</div>
<h3 id="headline-12">
Inheritance realization method
</h3>
<h4 id="headline-13">
Parent class
</h4>
<p>
First, the Parent class will be described.
</p>
<div class="src src-lns">
<pre><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Parent {
   let val1:int;
   pub fn sub1():int {
      return self.val1;
   }
}</code></pre>
</div>
<h5 id="headline-14">
data structure
</h5>
<p>
To represent the Parent class, define the following structure and interface.
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">ParentMtd</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nf">sub1</span> <span class="p">()</span> <span class="kt">int</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">Parent</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">val1</span> <span class="kt">int</span>
    <span class="nx">FP</span> <span class="nx">ParentMtd</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">ParentDownCast</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nf">ToParent</span><span class="p">()</span> <span class="o">*</span><span class="nx">Parent</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">)</span> <span class="nf">ToParent</span><span class="p">()</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">obj</span>
<span class="p">}</span></code></pre></div>
</div>
<ul>
<li>
<p>
The ParentMtd interface has the following roles:
</p>
<ul>
<li>
<p>
Define methods for Parent class
</p>
</li>
<li>
<p>
Expressing the morimorphism of the Parent class
</p>
</li>
</ul>
</li>
<li>
<p>
Parent structure has members and ParentMtd
</p>
</li>
<li>
<p>
ParentDownCast is defined per class for downcast
</p>
</li>
</ul>
<h5 id="headline-15">
Method
</h5>
<p>
To represent the method of Parent class, define the following receiver function.
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">Parent</span><span class="p">)</span> <span class="nf">sub1</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val1</span>
<span class="p">}</span></code></pre></div>
</div>
<h5 id="headline-16">
constructor
</h5>
<p>
Define the following as the constructor of the Parent class.
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewParent</span><span class="p">(</span><span class="nx">val1</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">{</span>
    <span class="nx">super</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Parent</span><span class="p">{</span> <span class="nx">val1</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">}</span>
    <span class="nx">super</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="nx">super</span>
    <span class="k">return</span> <span class="nx">super</span>
<span class="p">}</span></code></pre></div>
</div>
<p>
This constructor does the following:
</p>
<ul>
<li>
<p>
Member initialization
</p>
</li>
<li>
<p>
FP settings
</p>
</li>
</ul>
<h5 id="headline-17">
How to use the Parent class
</h5>
<p>
Parent is used as follows.
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">parent</span> <span class="o">:=</span> <span class="nf">NewParent</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub1</span><span class="p">()</span> <span class="p">)</span></code></pre></div>
</div>
<p>
When calling a method, be sure to call it through the FP interface.
</p>
<h4 id="headline-18">
Sub class
</h4>
<p>
Describe the Sub class.
</p>
<div class="src src-lns">
<pre><code class="language-lns" data-lang="lns">// @lnsFront: skip
class Sub extend Parent {
   let val2:int;
   pub override fn sub1():int {
      return self.val2;
   }
   pub fn sub2():int {
      return self.val2;
   }
}</code></pre>
</div>
<h5 id="headline-19">
data structure
</h5>
<p>
To represent the Sub class, define the following structure and interface.
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">SubMtd</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nx">ParentMtd</span>
    <span class="nf">sub2</span> <span class="p">()</span> <span class="kt">int</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">Sub</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Parent</span>
    <span class="nx">val2</span> <span class="kt">int</span>
    <span class="nx">FP</span> <span class="nx">SubMtd</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">SubDownCast</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nf">ToSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">Sub</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">)</span> <span class="nf">ToSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">obj</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">)</span> <span class="nf">ToParent</span><span class="p">()</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">obj</span><span class="p">.</span><span class="nx">Parent</span>
<span class="p">}</span></code></pre></div>
</div>
<ul>
<li>
<p>
The SubMtd interface declares the methods defined in Sub.
</p>
<ul>
<li>
<p>
Do not include Parent methods
</p>
</li>
</ul>
</li>
<li>
<p>
The Sub structure declares the data of the Parent structure and the members defined in Sub.
</p>
</li>
</ul>
<h5 id="headline-20">
Method
</h5>
<p>
To represent the method of Sub class, define the following receiver function.
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">Sub</span><span class="p">)</span> <span class="nf">sub1</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val2</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">Sub</span><span class="p">)</span> <span class="nf">sub2</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val2</span>
<span class="p">}</span></code></pre></div>
</div>
<h5 id="headline-21">
constructor
</h5>
<p>
Define the following as the constructor of the Sub class.
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">newSub</span><span class="p">(</span><span class="nx">val1</span><span class="p">,</span><span class="nx">val2</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">{</span>
    <span class="nx">sub</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">Sub</span><span class="p">{</span> <span class="nx">Parent</span><span class="p">{</span> <span class="nx">val1</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">},</span> <span class="nx">val2</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">}</span>
    <span class="nx">sub</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="nx">sub</span>
    <span class="nx">sub</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="nx">sub</span>
    <span class="k">return</span> <span class="nx">sub</span>
<span class="p">}</span></code></pre></div>
</div>
<p>
This constructor does the following:
</p>
<ul>
<li>
<p>
Member initialization
</p>
</li>
<li>
<p>
FP settings
</p>
<ul>
<li>
<p>
The super FP is also set here
</p>
</li>
<li>
<p>
Achieve polymorphism by setting &amp; sub instead of &amp; super in the FP of this super
</p>
</li>
</ul>
</li>
</ul>
<h4 id="headline-22">
SubSub class
</h4>
<p>
Describes the SubSub class.
</p>
<div class="src src-lns">
<pre><code class="language-lns" data-lang="lns">// @lnsFront: skip
class SubSub extend Sub {
   let val3:int;
   pub override fn sub1():int {
      return self.val3;
   }
   pub fn sub3():int {
      return self.val3;
   }
}</code></pre>
</div>
<h5 id="headline-23">
data structure
</h5>
<p>
To represent the SubSub class, define the following structure and interface.
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">SubSubMtd</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nx">SubMtd</span>
    <span class="nf">sub3</span> <span class="p">()</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">SubSub</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Sub</span>
    <span class="nx">val3</span> <span class="kt">int</span>
    <span class="nx">FP</span> <span class="nx">SubSubMtd</span>
<span class="p">}</span>
<span class="kd">type</span> <span class="nx">SubSubDownCast</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nf">ToSubSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">SubSub</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">)</span> <span class="nf">ToSubSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">obj</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">)</span> <span class="nf">ToSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">obj</span><span class="p">.</span><span class="nx">Sub</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">)</span> <span class="nf">ToParent</span><span class="p">()</span> <span class="o">*</span><span class="nx">Parent</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">obj</span><span class="p">.</span><span class="nx">Parent</span>
<span class="p">}</span></code></pre></div>
</div>
<ul>
<li>
<p>
The SubSubMtd interface declares the methods defined in SubSub.
</p>
<ul>
<li>
<p>
Do not include Sub methods
</p>
</li>
</ul>
</li>
<li>
<p>
The SubSub structure declares the data of the Sub structure and the members defined in SubSub.
</p>
</li>
</ul>
<h5 id="headline-24">
Method
</h5>
<p>
To represent the method of SubSub class, define the following receiver function.
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">SubSub</span><span class="p">)</span> <span class="nf">sub1</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val3</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">SubSub</span><span class="p">)</span> <span class="nf">sub2</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">Sub</span><span class="p">.</span><span class="nf">sub2</span><span class="p">()</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">SubSub</span><span class="p">)</span> <span class="nf">sub3</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">val3</span>
<span class="p">}</span></code></pre></div>
</div>
<h6 id="headline-25">
Method definition not overridden
</h6>
<p>
Of note above is the fact that the sub2 () method calls <code class="verbatim">self.Sub.sub2()</code>.
</p>
<p>
The SubSub class does not override the sub2 method. In other words, the sub2 method of SubSub will use the method of the Sub class. Therefore, we are calling the Sub.sub2 method.
</p>
<h5 id="headline-26">
constructor
</h5>
<p>
Define the following as the constructor of the SubSub class.
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">newSubSub</span><span class="p">(</span><span class="nx">val1</span><span class="p">,</span><span class="nx">val2</span><span class="p">,</span><span class="nx">val3</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">SubSub</span> <span class="p">{</span>
    <span class="nx">subsub</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">SubSub</span><span class="p">{</span> <span class="nx">Sub</span><span class="p">{</span> <span class="nx">Parent</span><span class="p">{</span> <span class="nx">val1</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">},</span> <span class="nx">val2</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">},</span> <span class="nx">val3</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">}</span>
    <span class="nx">subsub</span><span class="p">.</span><span class="nx">Parent</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="nx">subsub</span>
    <span class="nx">subsub</span><span class="p">.</span><span class="nx">Sub</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="nx">subsub</span>
    <span class="nx">subsub</span><span class="p">.</span><span class="nx">FP</span> <span class="p">=</span> <span class="nx">subsub</span>
    <span class="k">return</span> <span class="nx">subsub</span>
<span class="p">}</span></code></pre></div>
</div>
<p>
This constructor does the following:
</p>
<ul>
<li>
<p>
Member initialization
</p>
</li>
<li>
<p>
FP settings
</p>
<ul>
<li>
<p>
Parent and Sub FPs are also set here
</p>
</li>
<li>
<p>
Achieve polymorphism by setting &amp; subsub in the FP of Parent and Sub
</p>
</li>
</ul>
</li>
</ul>
<h4 id="headline-27">
IF interface
</h4>
<div class="src src-lns">
<pre><code class="language-lns" data-lang="lns">// @lnsFront: ok
interface IF {
  pub fn sub1():int;
}</code></pre>
</div>
<h5 id="headline-28">
data structure
</h5>
<p>
The LuneScript interface uses the Go interface as it is.
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">interface</span> <span class="nx">IF</span> <span class="p">{</span>
  <span class="nx">pub</span> <span class="nx">fn</span> <span class="nf">sub1</span><span class="p">():</span><span class="kt">int</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>
</div>
<h4 id="headline-29">
Method call
</h4>
<p>
To call a method of the Parent class:
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">test</span><span class="p">(</span><span class="nx">parent</span> <span class="o">*</span><span class="nx">Parent</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
  <span class="nb">print</span><span class="p">(</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">sub1</span><span class="p">()</span> <span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span> <span class="nx">parent</span><span class="p">.</span><span class="nf">sub1</span><span class="p">()</span> <span class="p">)</span>
<span class="p">}</span></code></pre></div>
</div>
<h5 id="headline-30">
Difference between parent.FP.sub1 () and parent.sub1 ()
</h5>
<p>
There are two patterns of method calls:
</p>
<ul>
<li>
<p>
parent.FP.sub1()
</p>
<ul>
<li>
<p>
Method call corresponding to polymorphism
</p>
</li>
</ul>
</li>
<li>
<p>
parent.sub1()
</p>
<ul>
<li>
<p>
Method call defined in Parent class
</p>
<ul>
<li>
<p>
Not compatible with polymorphism
</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="headline-31">
overhead
</h5>
<ul>
<li>
<p>
Method calls that support polymorphism have a large overhead.
</p>
</li>
<li>
<p>
Method calls that support polymorphism should be limited to cases where polymorphism is required.
</p>
</li>
<li>
<p>
There is currently no definition in LuneScript as to whether polymorphism is needed.
</p>
<ul>
<li>
<p>
Need to introduce final declarations in classes and methods to make it clear that polymorphism is not needed
</p>
</li>
</ul>
</li>
</ul>
<h4 id="headline-32">
up-cast / down-cast
</h4>
<ul>
<li>
<p>
up-cast is achieved by accessing the embedded pointer
</p>
<ul>
<li>
<p>
Up-cast to an interface uses the interface type held by the object
</p>
</li>
</ul>
</li>
<li>
<p>
down-cast implements interface with type assertions.
</p>
<ul>
<li>
<p>
Define a DownCast interface for each class, cast to that interface, and then execute the cast function to the desired class.
</p>
</li>
</ul>
</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">ifObj</span> <span class="nx">IF</span> <span class="p">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">FP</span> <span class="c1">// インタフェースをセットする
</span><span class="c1"></span><span class="nx">parent</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">obj</span><span class="p">.</span><span class="nx">Parent</span> <span class="c1">// アップキャスト
</span><span class="c1"></span><span class="p">(</span><span class="nx">parent</span><span class="p">.</span><span class="nx">FP</span><span class="p">.(</span><span class="nx">SubDownCast</span><span class="p">)).</span><span class="nf">ToSub</span><span class="p">()</span> <span class="o">//</span> <span class="nx">obj</span> <span class="nx">を</span> <span class="nx">Sub</span> <span class="nx">にダウンキャストする</span></code></pre></div>
</div>
<h3 id="headline-33">
Class summary
</h3>
<ul>
<li>
<p>
Declare an interface that defines the methods of the class
</p>
<ul>
<li>
<p>
Embed the interface of the method defined in the Super class
</p>
</li>
</ul>
</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">TestMtd</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nx">SuperMtd</span>
    <span class="nf">method</span><span class="p">()</span> <span class="kt">int</span>
<span class="p">}</span></code></pre></div>
</div>
<ul>
<li>
<p>
Declare a structure that holds the members of the class and the interface above
</p>
<ul>
<li>
<p>
Inheritance embeds the inherited type
</p>
</li>
</ul>
</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Test</span> <span class="kd">struct</span> <span class="p">{</span>
    <span class="nx">Super</span>
    <span class="nx">val</span> <span class="kt">int</span>
    <span class="nx">FP</span> <span class="nx">TestMtd</span>
<span class="p">}</span></code></pre></div>
</div>
<ul>
<li>
<p>
Define an interface for downcasting
</p>
</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">TestDownCast</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nf">ToTest</span><span class="p">()</span> <span class="o">*</span><span class="nx">Test</span>
<span class="p">}</span></code></pre></div>
</div>
<ul>
<li>
<p>
Define a method for downcasting
</p>
<ul>
<li>
<p>
This method declares everything for the Super class
</p>
</li>
</ul>
</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">*</span><span class="nx">SubSub</span><span class="p">)</span> <span class="nf">ToSub</span><span class="p">()</span> <span class="o">*</span><span class="nx">Sub</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">obj</span><span class="p">.</span><span class="nx">Sub</span>
<span class="p">}</span></code></pre></div>
</div>
<ul>
<li>
<p>
Declare a receiver that defines the behavior of the methods in the class
</p>
<ul>
<li>
<p>
The receiver declares including the methods of the Super class
</p>
</li>
<li>
<p>
Functions that are not overridden call the methods of the structure that defines the method.
</p>
</li>
</ul>
</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">self</span> <span class="o">*</span><span class="nx">Test</span><span class="p">)</span> <span class="nf">method</span><span class="p">()</span> <span class="kt">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">super</span><span class="p">.</span><span class="nf">method</span><span class="p">()</span>
<span class="p">}</span></code></pre></div>
</div>
<ul>
<li>
<p>
Initialize the members and interface FP in the constructor
</p>
<ul>
<li>
<p>
The interface is initialized to include the interface FP of the Super class.
</p>
</li>
</ul>
</li>
<li>
<p>
Method calls are made via interface FP
</p>
<ul>
<li>
<p>
Polymorphism Invalid method call calls the method of the structure directly
</p>
</li>
</ul>
</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">obj</span><span class="p">.</span><span class="nx">FP</span><span class="p">.</span><span class="nf">method</span><span class="p">()</span> <span class="c1">// ポリモーフィズム有効
</span><span class="c1"></span><span class="nx">obj</span><span class="p">.</span><span class="nf">method</span><span class="p">()</span>    <span class="o">//</span> <span class="nx">ポリモーフィズム無効</span></code></pre></div>
</div>
<ul>
<li>
<p>
up-cast is realized by accessing the pointer of the member Super class.
</p>
<ul>
<li>
<p>
Up-cast to an interface uses the interface type held by the object
</p>
</li>
</ul>
</li>
<li>
<p>
down-cast implements an interface with a type assertion and an interface for downcasting.
</p>
</li>
</ul>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">var</span> <span class="nx">ifObj</span> <span class="nx">IF</span> <span class="p">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">FP</span> <span class="c1">// インタフェースをセットする
</span><span class="c1"></span><span class="nx">super</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">obj</span><span class="p">.</span><span class="nx">super</span> <span class="c1">// アップキャスト
</span><span class="c1"></span><span class="p">(</span><span class="nx">parent</span><span class="p">.</span><span class="nx">FP</span><span class="p">.(</span><span class="nx">SubDownCast</span><span class="p">)).</span><span class="nf">ToSub</span><span class="p">()</span> <span class="o">//</span> <span class="nx">obj</span> <span class="nx">を</span> <span class="nx">Sub</span> <span class="nx">にダウンキャストする</span></code></pre></div>
</div>
<ul>
<li>
<p>
The interface uses Go&#39;s interface as it is
</p>
<ul>
<li>
<p>
Use interface FP when up-casting from a class object to an interface
</p>
</li>
</ul>
</li>
</ul>
<h2 id="headline-34">
Symbol name
</h2>
<p>
The LuneScript and go symbol names differ significantly in the following ways:
</p>
<ul>
<li>
<p>
Namespace
</p>
<ul>
<li>
<p>
LuneScript is in the same file (module)
</p>
</li>
<li>
<p>
go is in the same directory (package)
</p>
</li>
</ul>
</li>
<li>
<p>
Public / private control method
</p>
<ul>
<li>
<p>
LuneScript is controlled by pub / pro etc.
</p>
</li>
<li>
<p>
go is controlled by the case of the first letter of the symbol
</p>
</li>
</ul>
</li>
</ul>
<p>
This difference causes the following problems.
</p>
<ul>
<li>
<p>
When different files FileA.lns and FileB.lns are defined with the same name symbol sym in LuneScript, when converting this to go, if the symbol sym with the same name is defined in FileA.go and FileB.go with the same configuration. , The symbol sym results in a duplicate definition error.
</p>
</li>
<li>
<p>
Symbols that are publicly defined in lowercase in LuneScript are private in go.
</p>
<ul>
<li>
<p>
Symbols that are defined privately in uppercase in LuneScript are made public in go.
</p>
</li>
</ul>
</li>
</ul>
<p>
To address this issue, we process symbol names as follows:
</p>
<p>
Add the file name to the beginning of the symbol of the function or class to be controlled as public or private. If it is public, add G (G of GLOBAL), and if it is private, add l (l of local).
</p>
<p>
So if you want to convert the following LuneScript source to go,
</p>
<div class="src src-lns">
<pre><code class="language-lns" data-lang="lns">// @lnsFront: ok
fn func() {
}
pub class Class {
   let val1:int;
   pub let val2:int;
}</code></pre>
</div>
<p>
The relationship between the LuneScript and go symbols is as follows.
</p>
<table>
<thead>
<tr>
<th>Public / Private</th>
<th>lns</th>
<th>go</th>
<th class="align-right"></th>
</tr>
</thead>
<tbody>
<tr>
<td>private</td>
<td>func</td>
<td>lfile_func</td>
<td class="align-right"></td>
</tr>
<tr>
<td>Release</td>
<td>Class</td>
<td>Gfile_Class</td>
<td class="align-right"></td>
</tr>
<tr>
<td>private</td>
<td>val1</td>
<td>lval1</td>
<td class="align-right"></td>
</tr>
<tr>
<td>Release</td>
<td>val2</td>
<td>Gval2</td>
<td class="align-right"></td>
</tr>
</tbody>
</table>
<p>
Since there is no difference in scope between LuneScript and go for arguments and local variables, they are basically converted as they are.
</p>
<h2 id="headline-35">
Lua VM
</h2>
<p>
The current LuneScript uses Lua VM when deploying Macro. There are two ways to use the Lua VM with Go:
</p>
<ul>
<li>
<p>
Use gopher-lua, a port of Lua to Go
</p>
</li>
<li>
<p>
Use liblua
</p>
</li>
</ul>
<p>
Using gopher-lua makes it easier to work with Lua VMs, but with the following limitations:
</p>
<ul>
<li>
<p>
Lua VM version becomes Lua5.1
</p>
</li>
<li>
<p>
Slow compared to liblua
</p>
<ul>
<li>
<p>
According to the information on the official Wiki (&lt;<a href="https://github.com/yuin/gopher-lua/wiki/Benchmarks">https://github.com/yuin/gopher-lua/wiki/Benchmarks</a>&gt;), the execution time of fib (35) is as follows.
</p>
<dl>
<dt>
lua5.1.4
</dt>
<dd>
<p>
1.71sec
</p>
</dd>
<dt>
Gopherlua
</dt>
<dd>
<p>
5.40sec
</p>
</dd>
</dl>
</li>
</ul>
</li>
</ul>
<p>
From the above, the LuneScript transcompiler uses liblua.
</p>
<h3 id="headline-36">
cgo
</h3>
<p>
Use cgo to use liblua from Go.
</p>
<p>
cgo is a package for calling C language libraries from Go.
</p>
<p>
The C code written in the comment before import &#34;C&#34; is parsed and extracted into the C package so that it can be accessed from Go as follows.
</p>
<div class="src src-go">
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// #include &lt;stdlib.h&gt;
</span><span class="c1">// #cgo CFLAGS: -I/usr/include/lua
</span><span class="c1">// #cgo LDFLAGS: -ldl -lm -llua
</span><span class="c1">// #include &lt;lauxlib.h&gt;
</span><span class="c1">// #include &lt;lualib.h&gt;
</span><span class="c1"></span><span class="kn">import</span> <span class="s">&#34;C&#34;</span>

<span class="kn">import</span> <span class="s">&#34;unsafe&#34;</span>

<span class="c1">// lua のコードを実行する
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">lua_runScript</span><span class="p">(</span> <span class="nx">script</span> <span class="kt">string</span> <span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">vm</span> <span class="o">*</span> <span class="nx">C</span><span class="p">.</span><span class="nx">lua_State</span> <span class="p">=</span> <span class="nx">C</span><span class="p">.</span><span class="nf">luaL_newstate</span><span class="p">()</span>
    <span class="k">if</span> <span class="nx">vm</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
        <span class="k">return</span>
    <span class="p">}</span>
    <span class="k">defer</span> <span class="nx">C</span><span class="p">.</span><span class="nf">lua_close</span><span class="p">(</span> <span class="nx">vm</span> <span class="p">)</span>
    
    <span class="nx">C</span><span class="p">.</span><span class="nf">luaL_openlibs</span><span class="p">(</span> <span class="nx">vm</span> <span class="p">)</span>

    <span class="nx">block</span> <span class="o">:=</span> <span class="nx">C</span><span class="p">.</span><span class="nf">CString</span><span class="p">(</span> <span class="nx">script</span> <span class="p">)</span>
    <span class="k">defer</span> <span class="nx">C</span><span class="p">.</span><span class="nf">free</span><span class="p">(</span> <span class="nx">unsafe</span><span class="p">.</span><span class="nf">Pointer</span><span class="p">(</span> <span class="nx">block</span> <span class="p">)</span> <span class="p">)</span>
    
    <span class="nx">C</span><span class="p">.</span><span class="nf">luaL_loadstring</span><span class="p">(</span> <span class="nx">vm</span><span class="p">,</span> <span class="nx">block</span> <span class="p">)</span>
    <span class="nx">C</span><span class="p">.</span><span class="nf">lua_pcallk</span><span class="p">(</span> <span class="nx">vm</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">C</span><span class="p">.</span><span class="nx">LUA_MULTRET</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">nil</span> <span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="nf">lua_runScript</span><span class="p">(</span> <span class="s">&#34;print( &#39;hello world&#39; )&#34;</span> <span class="p">)</span>
<span class="p">}</span></code></pre></div>
</div>
<p>
<strong>Since cgo does not support the #define macro function, the following macro-defined functions must be expanded and written by themselves.</strong>
</p>
<div class="src src-c">
<div class="highlight"><pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#define luaL_dostring(L, s) \
</span><span class="cp">	(luaL_loadstring(L, s) || lua_pcall(L, 0, LUA_MULTRET, 0))</span></code></pre></div>
</div>
<div class="edit-meta">

<br></div><nav class="pagination"><a class="nav nav-prev-2" href="https://ifritjp.github.io/documents/en/lunescript/box/" title="Box edition"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - Box edition</a>
<a class="nav nav-next-2" href="https://ifritjp.github.io/documents/en/lunescript/test/" title="X. Importance of self-hosting and test design in quality control of language development">Next - X. Importance of self-hosting and test design in quality control of language development <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://themes.gohugo.io/hugo-theme-techdoc/">TechDoc</a>. Designed by <a href="https://github.com/thingsym/hugo-theme-techdoc">Thingsym</a>.</p>
</footer>
</main><div class="sidebar">

<nav class="slide-menu">
<ul>
<li class=""><a href="https://ifritjp.github.io/documents">Home</a></li>

<li class="parent has-sub-menu"><a href="https://ifritjp.github.io/documents/en/lunescript/">Making Lua easier with the transcompiler LuneScript !!<span class="mark opened">-</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/tutorial2.setup/"></a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/tutorial3.hello/">02. Hello world</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/crosscompile/">03. Cross-compiling between Lua versions</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/value/">04. Value</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/set/">04.2. Set</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/enum/">05. enum edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/match/">06. match edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/variable/">07. Variables</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/branch/">08. General branch syntax</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/loop/">09. Repeated syntax</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/func/">10. Functions</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/multipleretval/">10.2. Multi-valued return value</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/defaultarg/">10.3. Omission of arguments</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/arg/">10.4. Variadic argument, return value</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/closure/">10.5. Closure</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/nilable/">11. nilable edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/class1/">12. Class Basics</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/class2accessor/">13. accessor edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classinherit/">14. Class inheritance</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classadvertise/">15. Class advertise</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classoverride/">16. Class override</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/interface/">17. Interface</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classmapping/">18. mapping</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/generics/">19. generics edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/nilcond/">20. nil conditional operator edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/import/">21. import / provide</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/require/">22. require / module edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/glue/">22.1. Semi-automatic generation of glue code</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lua/">22.2. Cooperation with Lua</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/make/">23. Build</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/macro/">24. Macro edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/cast/">25. Cast edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/subfile/">26. subfile edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lazyloading/">27. Delayed loading</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/shebang_main/">28. shebang and command line arguments</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/dir/">29. Recommended directory structure for projects that use LuneScript</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/go/">@ .1 Transcompile to Go language</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lua_runtime/">@ .1.3 Lua runtime when transcompiled to Go</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/async/">@ .2 Safe asynchronous processing</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/async_old/">@ .2.1 Asynchronous processing O (past information)</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/go_package/">@ 1.2 Package when transcompiling to Go language</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/luago/">@ 3. Collaboration with Lua</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/completion/">A. Let&#39;s have more fun in an exciting development environment</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/onweb/">A. LuneScript running on a web browser</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lnstags/">A. Tag jump by lnstags (source code tag system)</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/recommend/">A. Transcompiler development recommendations</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/reason/">A. Why Lua&#39;s transcompiler LuneScript was developed</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/box/">Box edition</a></li>
<li class="active"><a href="https://ifritjp.github.io/documents/en/lunescript/go_study/">Transcompile to Z. Go language (under consideration)</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/test/">X. Importance of self-hosting and test design in quality control of language development</a></li>
</ul>
  
</li>
</ul>
</nav>



<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
