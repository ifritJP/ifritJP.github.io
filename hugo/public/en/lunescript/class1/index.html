<!DOCTYPE html>
<html lang="ja-jp">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>12. Class basics - tech</title>
<meta name="generator" content="Hugo 0.109.0">
<link href="https://ifritjp.github.io/documentsindex.xml" rel="alternate" type="application/rss+xml">
<link rel="canonical" href="https://ifritjp.github.io/documents/en/lunescript/class1/">
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/theme.min.css">
<script src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/chroma.min.css">
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery.easing@1.4.1/jquery.easing.min.js"></script>
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/custom.css">
<script src="https://ifritjp.github.io/documents/js/bundle.js"></script>
<script src="https://ifritjp.github.io/documents/js/lnsSrcRun.js"></script>
<script src="https://ifritjp.github.io/documents/js/highlight_lns.js"></script>
<link rel="stylesheet" href="https://ifritjp.github.io/documents/css/highlight_lns.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script><style>
:root {}
</style>
<meta property="og:title" content="12. Class basics" />
<meta property="og:description" content="LuneScript supports object-oriented programming through classes.
Class specification Classes in LuneScript support:
access control accessor Inheritance abstract override advertise Mapping interface Here is a basic class definition.
minimal class definition A minimal class definition looks like this:
// @lnsFront: ok class Test { } This defines a class called Test.
Note that the class definition must be done in the highest scope.
(2019/6/24) Supported to define a class even in a function." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ifritjp.github.io/documents/en/lunescript/class1/" /><meta property="article:section" content="LuneScript" />

<meta property="og:site_name" content="tech" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="12. Class basics"/>
<meta name="twitter:description" content="LuneScript supports object-oriented programming through classes.
Class specification Classes in LuneScript support:
access control accessor Inheritance abstract override advertise Mapping interface Here is a basic class definition.
minimal class definition A minimal class definition looks like this:
// @lnsFront: ok class Test { } This defines a class called Test.
Note that the class definition must be done in the highest scope.
(2019/6/24) Supported to define a class even in a function."/>
<meta itemprop="name" content="12. Class basics">
<meta itemprop="description" content="LuneScript supports object-oriented programming through classes.
Class specification Classes in LuneScript support:
access control accessor Inheritance abstract override advertise Mapping interface Here is a basic class definition.
minimal class definition A minimal class definition looks like this:
// @lnsFront: ok class Test { } This defines a class called Test.
Note that the class definition must be done in the highest scope.
(2019/6/24) Supported to define a class even in a function.">

<meta itemprop="wordCount" content="2418">
<meta itemprop="keywords" content="" />
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4708B8S6ES"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-4708B8S6ES');
</script>
</head>
<body><div class="container"><header>
<h1>tech</h1>


[<a href="https://ifritjp.github.io/documents/en/">English</a>]

[<a href="https://ifritjp.github.io/documents/">Japanese</a>]

</header>
<div class="global-menu">
<nav>
<ul>
<li><a href="/documents/">Home</a></li>
<li><a href="https://ifritjp.github.io/blog2/public/">blog</a></li>
<li><a href="https://ifritjp.github.io/LuneScript-webFront/lnsc_web_frontend/for_wasm/">LuneScript on Web</a></li></ul>
</nav>
</div>
<div class="content-container">
<main><h1>12. Class basics</h1>

<p>
LuneScript supports object-oriented programming through classes.</p>
<div id="outline-container-headline-1" class="outline-2">
<h2 id="headline-1">
Class specification
</h2>
<div id="outline-text-headline-1" class="outline-text-2">
<p>
Classes in LuneScript support:</p>
<ul>
<li>access control</li>
<li>accessor</li>
<li>Inheritance</li>
<li>abstract</li>
<li>override</li>
<li>advertise</li>
<li>Mapping</li>
<li>interface  </li>
</ul>
<p>Here is a basic class definition.</p>
</div>
</div>
<div id="outline-container-headline-2" class="outline-2">
<h2 id="headline-2">
minimal class definition
</h2>
<div id="outline-text-headline-2" class="outline-text-2">
<p>
A minimal class definition looks like this:</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
}</code></pre>
</div>
<p>
This defines a class called Test.</p>
<p>
<del>Note that the class definition must be done in the highest scope.</del></p>
<p>
<strong>(2019/6/24) Supported to define a class even in a function. However, exposing classes must be declared at the highest scope.</strong></p>
<div id="outline-container-headline-3" class="outline-3">
<h3 id="headline-3">
Public disclosure
</h3>
<div id="outline-text-headline-3" class="outline-text-3">
<p>
To publish a class to an external module, append pub like this:</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
pub class Test {
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-4" class="outline-2">
<h2 id="headline-4">
instantiation
</h2>
<div id="outline-text-headline-4" class="outline-text-2">
<p>
Class instantiation uses the new operator as follows:</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
}
let test = new Test();</code></pre>
</div>
</div>
</div>
<div id="outline-container-headline-5" class="outline-2">
<h2 id="headline-5">
method definition
</h2>
<div id="outline-text-headline-5" class="outline-text-2">
<p>
A method definition is almost the same as a function definition.</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
   pub fn func() {
      print( __func__ );
   }
}
let test = new Test();
test.func();  // Test.func</code></pre>
</div>
<p>
Note that the method cannot be set on the form type.</p>
<p>
For example, <code>sub( test.func )</code> below will error.</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: error
class Test {
   pub fn func() {
      print( __func__ );
   }
}
fn sub( foo:form ) {
   foo();
}

let test = new Test();
sub( test.func );  // error</code></pre>
</div>
<p>
To avoid this error, create an anonymous function and pass it to <code class="verbatim">sub()</code> like this:</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
   pub fn func() {
      print( __func__ );
   }
}
fn sub( foo:form ) {
   foo();
}

let test = new Test();
sub( fn() { test.func(); } );</code></pre>
</div>
<div id="outline-container-headline-6" class="outline-3">
<h3 id="headline-6">
access control
</h3>
<div id="outline-text-headline-6" class="outline-text-3">
<p>
There are three types of access control:</p>
<table>
<thead>
<tr>
<th>kinds</th>
<th>meaning</th>
<th class="align-right"></th>
</tr>
</thead>
<tbody>
<tr>
<td>pub</td>
<td>Public disclosure</td>
<td class="align-right"></td>
</tr>
<tr>
<td>local</td>
<td>Published in the same module</td>
<td class="align-right"></td>
</tr>
<tr>
<td>pro</td>
<td>Exposed to subclasses</td>
<td class="align-right"></td>
</tr>
<tr>
<td>pri</td>
<td>private</td>
<td class="align-right"></td>
</tr>
</tbody>
</table>
<p>
If not specified, the default is pri.</p>
</div>
</div>
<div id="outline-container-headline-7" class="outline-3">
<h3 id="headline-7">
self symbol
</h3>
<div id="outline-text-headline-7" class="outline-text-3">
<p>
Inside the method, you can use the self symbol.</p>
<p>
The self symbol represents an instance of itself.</p>
<p>
In the following example, the public method sub calls the private method <code class="verbatim">func()</code> using self .</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
   fn func() {
      print( __func__ );
   }
   pub fn sub() {
      self.func();
   }
}
let test = new Test();
test.sub();  // Test.func</code></pre>
</div>
</div>
</div>
<div id="outline-container-headline-8" class="outline-3">
<h3 id="headline-8">
Separation definition
</h3>
<div id="outline-text-headline-8" class="outline-text-3">
<p>
Methods can be defined separately from the class definition.</p>
<p>
The method definition above can also be written as:</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
}
pub fn Test.func() {
   print( __func__ );
}
let test = new Test();
test.func();  // Test.func</code></pre>
</div>
<p>
However, it is not possible to define a method of a class defined in another module within the importing module.</p>
</div>
</div>
<div id="outline-container-headline-9" class="outline-3">
<h3 id="headline-9">
prototype declaration
</h3>
<div id="outline-text-headline-9" class="outline-text-3">
<p>
A method definition can also declare only the type within the class definition and separate the actual definition.</p>
<p>
The following example prototypes <code class="verbatim">func()</code> and separates the actual definition.</p>
<p>
By prototyping <code class="verbatim">func()</code>, it becomes possible to call <code class="verbatim">func()</code> within <code class="verbatim">sub()</code>.</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
   pub fn func();
   pub fn sub() {
      self.func();
   }
}
pub fn Test.func() {
   print( __func__ );
}
let test = new Test();
test.sub();  // Test.func</code></pre>
</div>
<p>
Naturally, the type of the prototype declaration and the actual definition of the method must match.</p>
</div>
</div>
<div id="outline-container-headline-10" class="outline-3">
<h3 id="headline-10">
class method definition
</h3>
<div id="outline-text-headline-10" class="outline-text-3">
<p>
A normal method is tied to an instance and cannot be executed without an instance, but a class method tied to a class can be executed without an instance.</p>
<p>
Defining a class method is as simple as adding static to the method definition.</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
   pub static fn sfunc() {
      print( __func__ );
   }
}
Test.sfunc(); // Test.sfunc</code></pre>
</div>
<p>
<strong>Class methods are only available in classes defined at the topmost scope.</strong></p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-11" class="outline-2">
<h2 id="headline-11">
member definition
</h2>
<div id="outline-text-headline-11" class="outline-text-2">
<p>
A member definition is almost the same as a variable definition, with the following differences.</p>
<ul>
<li>Can&#39;t set initial value when declaring</li>
<li>Added access control</li>
<li>accessor can be specified</li>
</ul>
<p>Here is an example member definition:</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
   pri let val1:int;
   pri let val2:int;
   pri let val3:int;
   pub fn func() {
      print( self.val1, self.val2, self.val3 );
   }

}
let test = new Test( 1, 2, 3 );
test.func(); // 1 2 3</code></pre>
</div>
<p>
Class Test has members val1, val2, val3.</p>
<p>
The definition of val1 is <code>pri let val1:int;</code>.</p>
<p>
I don&#39;t think this is a problem because it&#39;s just a normal variable declaration with pri attached.</p>
<p>
pri is access control and has the same meaning as the method definition.</p>
</div>
</div>
<div id="outline-container-headline-12" class="outline-2">
<h2 id="headline-12">
<code class="verbatim">mutable</code>
</h2>
<div id="outline-text-headline-12" class="outline-text-2">
<p>
Members and methods also have <code class="verbatim">mutable</code> and <code class="verbatim">immutable</code>.</p>
<p>
The differences between methods <code class="verbatim">mutable</code> and <code class="verbatim">immutable</code> are as follows:</p>
<ul>
<li><code class="verbatim">mutable</code> methods are methods whose members can be changed</li>
<li><code class="verbatim">immutable</code> methods are methods whose members are immutable</li>
</ul>
<p>Examples of <code class="verbatim">mutable</code> members and methods are shown below.</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
   pri let mut val1:int;
   pri let val2:int;
   pub fn func() {
      print( self.val1, self.val2 );
   }
   pub fn add( val:int ) mut {
      self.val1 = self.val1 + val;
   }
}
let mut test = new Test( 1, 2 );
test.func(); // 1 2
test.add( 10 );
test.func(); // 11 2</code></pre>
</div>
<p>
In this example, val1 is <code class="verbatim">mutable</code> and val2 is <code class="verbatim">immutable</code>. Also, <code class="verbatim">func()</code> is <code class="verbatim">immutable</code> and <code class="verbatim">add()</code> is <code class="verbatim">mutable</code>.</p>
<p>
<strong><code class="verbatim">mutable</code> methods declare mut after declaring arguments.</strong></p>
<p>
Method <code class="verbatim">add()</code> of <code class="verbatim">mutable</code> sets a value in member val1. This builds without errors.</p>
<p>
Then, what happens when the mut declaration of method <code class="verbatim">add()</code> is removed as follows.</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: error
class Test {
   pri let mut val1:int;
   pri let val2:int;
   pub fn func() {
      print( self.val1, self.val2 );
   }
   pub fn add( val:int ) {
      self.val1 = self.val1 + val;  // error
   }
}</code></pre>
</div>
<p>
The above example will result in an error.</p>
<p>
It is an error to attempt to change a member from within a method that is not <code class="verbatim">mutable</code>.</p>
<p>
I also get an error if:</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: error
class Test {
   pri let mut val:int;
   pub fn increment() mut {
      self.val = self.val + 1;
   }
   pub fn func() {
      self.increment(); // error
   }
}</code></pre>
</div>
<p>
In the above example, <code class="verbatim">func()</code> calls <code class="verbatim">increment()</code>, but <code class="verbatim">immutable</code> method cannot call <code class="verbatim">mutable</code> method.</p>
</div>
</div>
<div id="outline-container-headline-13" class="outline-2">
<h2 id="headline-13">
allmut member
</h2>
<div id="outline-text-headline-13" class="outline-text-2">
<p>
As mentioned above, if a member of a class is <code class="verbatim">mutable</code>, but an instance of that class is <code class="verbatim">immutable</code>, the member will be <code class="verbatim">immutable</code>.</p>
<p>
The following example accesses the member val of <code class="verbatim">mutable</code> from within the <code class="verbatim">func()</code> method, but since the <code class="verbatim">func()</code> method is <code class="verbatim">immutable</code>, val is also <code class="verbatim">immutable</code>, causing an error.</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: error
class Test {
   pri let mut val:int;
   pub fn func() {
      self.val = self.val + 1;  // error
   }
}</code></pre>
</div>
<p>
Mutablity is a necessary concept to prevent the value from changing at unintended timing. On the other hand, it&#39;s a very strict rule that you can&#39;t change any member from a <code class="verbatim">immutable</code> method.</p>
<p>
If this rule is applied, the design will become difficult in the following cases, for example.</p>
<ul>
<li>Consider a class Data that manages read-only data associated with a key</li>
<li>In the Data class, define a method <code class="verbatim">get()</code> that returns the associated data when a key is given as an argument.</li>
<li>Data instance that registers all data to be managed shall be <code class="verbatim">immutable</code> to prevent unnecessary changes.</li>
</ul>
<p>I think this is a common idea.</p>
<p>
Then, as development progresses, you add the following specification:</p>
<ul>
<li>In order to speed up the processing of the above <code class="verbatim">get()</code> method, cache the previous argument key and the data associated with that key</li>
</ul>
<p>This process of &#34;cache the previous argument key and the data associated with that key&#34; will rewrite the data. That is, it should be <code class="verbatim">mutable</code>, not <code class="verbatim">immutable</code>.</p>
<p>
On the other hand, the Data instance is already declared as <code class="verbatim">immutable</code> in many places. In other words, it cannot be cached.</p>
<p>
Allmut is used in such cases. allmut declares the member&#39;s mutability to always be <code class="verbatim">mutable</code>, independent of the instance&#39;s mutability.</p>
<p>
Here is an example of allmut.</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
   pri let allmut val:int;
   pub fn func() {
      self.val = self.val + 1;  // ok
   }
}</code></pre>
</div>
<p>
By declaring <code>pri let allmut val:int;</code> like this, val will always be <code class="verbatim">mutable</code>. This makes it possible to rewrite val from <code class="verbatim">immutable</code> and <code class="verbatim">func()</code> methods.</p>
<p>
<strong>However, allmut is only a remedy and should not be overused.</strong></p>
<p>
<strong>In particular, when doing asynchronous programming in go, which will be described later, safety cannot be guaranteed if allmut is present.</strong></p>
</div>
</div>
<div id="outline-container-headline-14" class="outline-2">
<h2 id="headline-14">
constructor definition
</h2>
<div id="outline-text-headline-14" class="outline-text-2">
<p>
Constructors can be defined in <code class="verbatim">__init</code>.</p>
<p>
Constructors differ from method definitions in the following ways:</p>
<ul>
<li>The constructor name must be <code class="verbatim">__init</code>.</li>
<li>A return type cannot be specified.</li>
<li>Constructor definitions must come after all member definitions.</li>
<li>
<p>If you inherit from a class, you must run the constructor for that class first.</p>
<ul>
<li>Execution of super class constructor uses <code class="verbatim">super()</code>.</li>
</ul>
</li>
<li>
<p>Constructor must initialize all members.</p>
<ul>
<li>If you don&#39;t explicitly initialize a member of a nilable type, it has the initial value nil.</li>
</ul>
</li>
<li>
<p>You cannot access the methods defined in the class unless all members are initialized in the constructor.</p>
<ul>
<li>However, static methods and super class methods are accessible.</li>
<li>Also, the method can be accessed from the function object defined in the constructor.</li>
</ul>
</li>
<li>A method with only a prototype declaration cannot be called from within the constructor.</li>
<li>You cannot return inside the constructor.</li>
</ul>
<p>Here is an example constructor:</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
   pri let val1:int;
   pri let val2:int;
   pub fn __init() {
      self.val1 = 0;
      self.val2 = 0;
   }
}
let test = new Test();</code></pre>
</div>
<p>
Note that the constructor can also set initial values for <code class="verbatim">immutable</code> members.</p>
<div id="outline-container-headline-15" class="outline-3">
<h3 id="headline-15">
constructor arguments
</h3>
<div id="outline-text-headline-15" class="outline-text-3">
<p>
Constructors can have arguments. This argument is given by the new operator.</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
   pri let val1:int;
   pri let val2:int;
   pub fn __init( val1:int, val2:int ) {
      self.val1 = val1 + 10;
      self.val2 = val2 + 10;
   }
   pub fn func() {
      print( self.val1, self.val2 );
   }
}
let test = new Test( 1, 2 );
test.func(); // 11 12</code></pre>
</div>
</div>
</div>
<div id="outline-container-headline-16" class="outline-3">
<h3 id="headline-16">
Default constructor
</h3>
<div id="outline-text-headline-16" class="outline-text-3">
<p>
If you don&#39;t define a constructor, a constructor is automatically generated to set all members. This constructor is called the default constructor.</p>
<p>
The default constructor has arguments to set all members. The order of the arguments is the order in which the members of the class are declared.</p>
<p>
The following class declaration does not declare a constructor, so a default constructor is generated internally.</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
   pri let val1:int;
   pri let val2:int;
}</code></pre>
</div>
<p>
Its default constructor is defined as:</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: skip
   pub fn __init( val1:int, val2:int ) {
      self.val1 = val1;
      self.val2 = val2;
   }</code></pre>
</div>
<p>
The access control of the default constructor is pub.</p>
<div id="outline-container-headline-17" class="outline-4">
<h4 id="headline-17">
Default constructor of derived class
</h4>
<div id="outline-text-headline-17" class="outline-text-4">
<p>
There are two types of default constructors for derived classes: the old style and the current style.</p>
<div id="outline-container-headline-18" class="outline-5">
<h5 id="headline-18">
present form
</h5>
<div id="outline-text-headline-18" class="outline-text-5">
<p>
The current form default constructor of the derived class Sub is</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
   pro let val:int;
}
class Sub extend Test {
   let val2:int;
   pub fn func() {
      print( self.val, self.val2 );
   }
}
let sub = new Sub( 1, 2 );
sub.func(); // 1, 2</code></pre>
</div>
<p>
Like <code>new Sub( 1, 2 )</code> above, it will be the argument of the constructor of the super class + all members of the derived class.</p>
</div>
</div>
<div id="outline-container-headline-19" class="outline-5">
<h5 id="headline-19">
old format
</h5>
<div id="outline-text-headline-19" class="outline-text-5">
<p>
An old-style default constructor for a derived class Sub such as</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
   pro let val:int!;
}
class Sub extend Test {
   let val2:int;
   _lune_control default__init_old;
   pub fn func() {
      print( self.val, self.val2 );
   }
}
let sub = new Sub( 2 );
sub.func(); // nil, 2</code></pre>
</div>
<p>
All members of the derived class, like <code>new Sub( 2 )</code> above.</p>
<p>
Note that in the old style, all arguments of the super class must be nilable. You also need to declare <code>_lune_control default__init_old;</code> to use the old-style default constructor. This declaration must be declared after all members have been declared.</p>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-20" class="outline-4">
<h4 id="headline-20">
Explicit default constructor
</h4>
<div id="outline-text-headline-20" class="outline-text-4">
<p>
A default constructor is generated internally if you don&#39;t define a constructor.</p>
<p>
But this behavior becomes a problem when you write something like this:</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: error
class Test {
   pri let mut val:int {pub};
   pub static fn create(): Test {
      return new Test( 1 );  // error
   }
}</code></pre>
</div>
<p>
The above creates an instance of the Test class within the <code class="verbatim">create()</code> method, but an error occurs because the constructor is not declared.</p>
<p>
Originally, the default constructor is generated because there is no constructor definition, but the timing of defining the default constructor is done at the end of the class definition, so there is no constructor in the <code class="verbatim">create()</code> method in the class definition.</p>
<p>
In such cases, explicitly declare to use the default constructor.</p>
<p>
For example:</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
   pri let mut val:int {pub};
   _lune_control default__init;
   pub static fn create(): Test {
      return new Test( 1 );
   }
}</code></pre>
</div>
<p>
By declaring <code>_lune_control default__init;</code>, you can specify the use of the default constructor, and the default constructor will be generated at this timing.</p>
<p>
Note that <code>_lune_control default__init;</code> must be declared after all members, just like a normal constructor.</p>
<p>
<strong>This old-style constructor declaration may be desupported in the future.</strong></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-21" class="outline-2">
<h2 id="headline-21">
destructor
</h2>
<div id="outline-text-headline-21" class="outline-text-2">
<p>
You can define what happens when an instance of your class is released.</p>
<div id="outline-container-headline-22" class="outline-3">
<h3 id="headline-22">
Definition method
</h3>
<div id="outline-text-headline-22" class="outline-text-3">
<p>
Define the destructor in the <code class="verbatim">__free()</code> method.</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: skip
class Hoge {
   fn __free() {
      print( __func__ );
   }
}
{
   let hoge = new Hoge();
}
collectgarbage(); // print Hoge</code></pre>
</div>
</div>
</div>
<div id="outline-container-headline-23" class="outline-3">
<h3 id="headline-23">
execution timing
</h3>
<div id="outline-text-headline-23" class="outline-text-3">
<p>
Destructors are automatically executed when an instance of the class is released.</p>
<p>
<strong>Conversely, destructors cannot be called explicitly.</strong></p>
</div>
</div>
<div id="outline-container-headline-24" class="outline-3">
<h3 id="headline-24">
important point
</h3>
<div id="outline-text-headline-24" class="outline-text-3">
<p>
<strong>Destructors have a few caveats.</strong></p>
<ul>
<li>When the instance is freed is up to GC</li>
<li>
<p>Limited Lua versions available</p>
<ul>
<li>lua5.1, not available in fengari</li>
<li>
<p>access control must be pri</p>
<ul>
<li>pri so <code class="verbatim">override</code> can&#39;t</li>
<li>cannot be called with <code class="verbatim">super()</code> from the derived destination</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-headline-25" class="outline-2">
<h2 id="headline-25">
class member
</h2>
<div id="outline-text-headline-25" class="outline-text-2">
<p>
Just like methods have class methods, members have class members.</p>
<p>
Just add static to the class member definition.</p>
<p>
Initialize class members in the __init block.</p>
<p>
Here is an example class member definition:</p>
<div class="src src-lns">
<pre tabindex="0"><code class="language-lns" data-lang="lns">// @lnsFront: ok
class Test {
   pri static let val1:int;
   pri static let val2:int;

   __init {
      Test.val1 = 1;
      Test.val2 = 1;
   }
}</code></pre>
</div>
<p>
The <code class="verbatim">__init</code> block has the following limitations:</p>
<ul>
<li>
<p>Definitions of <code class="verbatim">__init</code> blocks must follow all class member definitions.</p>
<ul>
<li>If you don&#39;t explicitly initialize a member of a nilable type, it has the initial value nil.</li>
</ul>
</li>
<li>The <code class="verbatim">__init</code> block must initialize all members.</li>
<li>Cannot return in <code class="verbatim">__init</code> block.</li>
<li>A class method can be called from a <code class="verbatim">__init</code> block, but the class method to be called must be declared before the <code class="verbatim">__init</code> block.</li>
</ul>
</div>
</div>
<div id="outline-container-headline-26" class="outline-2">
<h2 id="headline-26">
summary
</h2>
<div id="outline-text-headline-26" class="outline-text-2">
<p>
Class definitions in LuneScript support:</p>
<ul>
<li>Define a class with the keyword class</li>
<li>instantiation is new</li>
<li>Access controllable</li>
<li>access itself with the self symbol</li>
<li>Class definition and method definition can be separated</li>
<li>prototype declaration</li>
<li>Class methods, class members in static</li>
<li>Constructor is <code class="verbatim">__init</code></li>
<li>If you don&#39;t create a constructor, a default constructor will be created.</li>
</ul>
<p>Next time, I will explain how to create accessors.</p>
</div>
</div>
<div class="edit-meta">

<br></div><nav class="pagination"><a class="nav nav-prev-2" href="https://ifritjp.github.io/documents/en/lunescript/nilable/" title="11. nilable"><i class="fas fa-arrow-left" aria-hidden="true"></i> Prev - 11. nilable</a>
<a class="nav nav-next-2" href="https://ifritjp.github.io/documents/en/lunescript/class2accessor/" title="13. accessor">Next - 13. accessor <i class="fas fa-arrow-right" aria-hidden="true"></i></a>
</nav><footer><p class="powered">Powered by <a href="https://gohugo.io">Hugo</a>. Theme by <a href="https://themes.gohugo.io/hugo-theme-techdoc/">TechDoc</a>. Designed by <a href="https://github.com/thingsym/hugo-theme-techdoc">Thingsym</a>.</p>
</footer>
</main><div class="sidebar">

<nav class="slide-menu">
<ul>
<li class=""><a href="https://ifritjp.github.io/documents">Home</a></li>

<li class="parent has-sub-menu"><a href="https://ifritjp.github.io/documents/en/lunescript/">Easier Lua development with the transcompiler LuneScript!!<span class="mark opened">-</span></a>
  
<ul class="sub-menu">
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/tutorial2.setup/">01. Introduction</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/tutorial3.hello/">02. Hello world</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/crosscompile/">03. Cross-compiling between Lua versions</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/value/">04. Values</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/set/">04.2. Set</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/tuple/">04.3 Tuples</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/enum/">05. enum</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/match/">06. match</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/variable/">07. Variables</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/branch/">08. General branch syntax</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/loop/">09. Repetition Syntax</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/func/">10. Functions</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/multipleretval/">10.2. Multi-value return values</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/defaultarg/">10.3. Omitting Arguments</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/arg/">10.4. Variadic Arguments and Return Values</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/closure/">10.5. Closures</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/error/">10.6. Error handling</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/nilable/">11. nilable</a></li>
<li class="active"><a href="https://ifritjp.github.io/documents/en/lunescript/class1/">12. Class basics</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/class2accessor/">13. accessor</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classinherit/">14. Class Inheritance</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classadvertise/">15. Class advertise</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classoverride/">16. Class override</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/interface/">17. Interface</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/classmapping/">18. mapping</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/generics/">19. generics</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/generics-go/">19.2. generics (two collection types)</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/nilcond/">20. nil conditional operator</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/import/">21. import/provide</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/require/">22. require/module</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/glue/">22.1. Semi-automatic generation of glue code</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lua/">22.2. Linking with Lua</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/make/">23. Build</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/macro/">24. Macro</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/cast/">25. Cast</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/subfile/">26. subfile</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lazyloading/">27. Lazy Loading</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/shebang_main/">28. shebang and command line arguments</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/dir/">29. Recommended directory structure for projects using LuneScript</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/go/">80. Transcompiling to Go Language</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/go_package/">80.2 Packages when transpiling to Go</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/go_wasm/">80.4 WebAssembly support for LuneScript</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/async/">81. Safe Asynchronous Processing</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/async_old/">81.1 Asynchronous processing (past information)</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/luago/">82. Linking with Lua</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/ebnf/">A. BNF</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/onweb/">A. LuneScript running on a web browser</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/reason/">A. Reason for developing Lua transcompiler LuneScript</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/recommend/">A. Recommendations for transcompiler development</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lnstags/">A. Tag jumping with lnstags (source code tagging system)</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/completion/">A.Let&#39;s have more fun in a modern development environment</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/box/">Box edition</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/lua_runtime/">Lua runtime when transpiling to 80.3 Go</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/test/">X. The Importance of Self-Hosting and Test Design in Language Development Quality Control</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/design/">Y.1 How to develop LuneScript</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/design-2/">Y.2 Development of LuneScript (type information management)</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/design-3/">Y.3 LuneScript Development (Scopes and Symbols)</a></li>
<li class=""><a href="https://ifritjp.github.io/documents/en/lunescript/go_study/">Z. Transcompile to Go language (exploratory stage)</a></li>
</ul>
  
</li>
</ul>
</nav>



<div class="sidebar-footer"></div>
</div>
</div><a href="#" id="backtothetop-fixed" class="backtothetop"
 data-backtothetop-duration="600"
 data-backtothetop-easing="easeOutQuart"
 data-backtothetop-fixed-fadeIn="1000"
 data-backtothetop-fixed-fadeOut="1000"
 data-backtothetop-fixed-bottom="10"
 data-backtothetop-fixed-right="20">
<span class="fa-layers fa-fw">
<i class="fas fa-circle"></i>
<i class="fas fa-arrow-circle-up"></i>
</span></a>
</div>
</body>
</html>
